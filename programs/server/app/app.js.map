{"version":3,"sources":["meteor://ðŸ’»app/imports/message-read-receipt/server/lib/ReadReceipt.js","meteor://ðŸ’»app/imports/message-read-receipt/server/api/methods/getReadReceipts.js","meteor://ðŸ’»app/imports/message-read-receipt/server/models/ReadReceipts.js","meteor://ðŸ’»app/imports/message-read-receipt/server/dbIndexes.js","meteor://ðŸ’»app/imports/message-read-receipt/server/hooks.js","meteor://ðŸ’»app/imports/message-read-receipt/server/index.js","meteor://ðŸ’»app/imports/message-read-receipt/server/settings.js","meteor://ðŸ’»app/imports/startup/server/index.js","meteor://ðŸ’»app/server/lib/cordova/facebook-login.js","meteor://ðŸ’»app/server/lib/accounts.js","meteor://ðŸ’»app/server/lib/cordova.js","meteor://ðŸ’»app/server/startup/migrations/v001.js","meteor://ðŸ’»app/server/startup/migrations/v002.js","meteor://ðŸ’»app/server/startup/migrations/v003.js","meteor://ðŸ’»app/server/startup/migrations/v004.js","meteor://ðŸ’»app/server/startup/migrations/v005.js","meteor://ðŸ’»app/server/startup/migrations/v006.js","meteor://ðŸ’»app/server/startup/migrations/v007.js","meteor://ðŸ’»app/server/startup/migrations/v008.js","meteor://ðŸ’»app/server/startup/migrations/v009.js","meteor://ðŸ’»app/server/startup/migrations/v010.js","meteor://ðŸ’»app/server/startup/migrations/v011.js","meteor://ðŸ’»app/server/startup/migrations/v012.js","meteor://ðŸ’»app/server/startup/migrations/v013.js","meteor://ðŸ’»app/server/startup/migrations/v014.js","meteor://ðŸ’»app/server/startup/migrations/v015.js","meteor://ðŸ’»app/server/startup/migrations/v016.js","meteor://ðŸ’»app/server/startup/migrations/v017.js","meteor://ðŸ’»app/server/startup/migrations/v018.js","meteor://ðŸ’»app/server/startup/migrations/v019.js","meteor://ðŸ’»app/server/startup/migrations/v020.js","meteor://ðŸ’»app/server/startup/migrations/v021.js","meteor://ðŸ’»app/server/startup/migrations/v022.js","meteor://ðŸ’»app/server/startup/migrations/v023.js","meteor://ðŸ’»app/server/startup/migrations/v024.js","meteor://ðŸ’»app/server/startup/migrations/v025.js","meteor://ðŸ’»app/server/startup/migrations/v026.js","meteor://ðŸ’»app/server/startup/migrations/v027.js","meteor://ðŸ’»app/server/startup/migrations/v028.js","meteor://ðŸ’»app/server/startup/migrations/v029.js","meteor://ðŸ’»app/server/startup/migrations/v030.js","meteor://ðŸ’»app/server/startup/migrations/v031.js","meteor://ðŸ’»app/server/startup/migrations/v032.js","meteor://ðŸ’»app/server/startup/migrations/v033.js","meteor://ðŸ’»app/server/startup/migrations/v034.js","meteor://ðŸ’»app/server/startup/migrations/v035.js","meteor://ðŸ’»app/server/startup/migrations/v036.js","meteor://ðŸ’»app/server/startup/migrations/v037.js","meteor://ðŸ’»app/server/startup/migrations/v038.js","meteor://ðŸ’»app/server/startup/migrations/v039.js","meteor://ðŸ’»app/server/startup/migrations/v040.js","meteor://ðŸ’»app/server/startup/migrations/v041.js","meteor://ðŸ’»app/server/startup/migrations/v042.js","meteor://ðŸ’»app/server/startup/migrations/v043.js","meteor://ðŸ’»app/server/startup/migrations/v044.js","meteor://ðŸ’»app/server/startup/migrations/v045.js","meteor://ðŸ’»app/server/startup/migrations/v046.js","meteor://ðŸ’»app/server/startup/migrations/v047.js","meteor://ðŸ’»app/server/startup/migrations/v048.js","meteor://ðŸ’»app/server/startup/migrations/v049.js","meteor://ðŸ’»app/server/startup/migrations/v050.js","meteor://ðŸ’»app/server/startup/migrations/v051.js","meteor://ðŸ’»app/server/startup/migrations/v052.js","meteor://ðŸ’»app/server/startup/migrations/v053.js","meteor://ðŸ’»app/server/startup/migrations/v054.js","meteor://ðŸ’»app/server/startup/migrations/v055.js","meteor://ðŸ’»app/server/startup/migrations/v056.js","meteor://ðŸ’»app/server/startup/migrations/v057.js","meteor://ðŸ’»app/server/startup/migrations/v058.js","meteor://ðŸ’»app/server/startup/migrations/v059.js","meteor://ðŸ’»app/server/startup/migrations/v060.js","meteor://ðŸ’»app/server/startup/migrations/v061.js","meteor://ðŸ’»app/server/startup/migrations/v062.js","meteor://ðŸ’»app/server/startup/migrations/v063.js","meteor://ðŸ’»app/server/startup/migrations/v064.js","meteor://ðŸ’»app/server/startup/migrations/v065.js","meteor://ðŸ’»app/server/startup/migrations/v066.js","meteor://ðŸ’»app/server/startup/migrations/v067.js","meteor://ðŸ’»app/server/startup/migrations/v068.js","meteor://ðŸ’»app/server/startup/migrations/v069.js","meteor://ðŸ’»app/server/startup/migrations/v070.js","meteor://ðŸ’»app/server/startup/migrations/v071.js","meteor://ðŸ’»app/server/startup/migrations/v072.js","meteor://ðŸ’»app/server/startup/migrations/v073.js","meteor://ðŸ’»app/server/startup/migrations/v074.js","meteor://ðŸ’»app/server/startup/migrations/v075.js","meteor://ðŸ’»app/server/startup/migrations/v076.js","meteor://ðŸ’»app/server/startup/migrations/v077.js","meteor://ðŸ’»app/server/startup/migrations/v078.js","meteor://ðŸ’»app/server/startup/migrations/v079.js","meteor://ðŸ’»app/server/startup/migrations/v080.js","meteor://ðŸ’»app/server/startup/migrations/v081.js","meteor://ðŸ’»app/server/startup/migrations/v082.js","meteor://ðŸ’»app/server/startup/migrations/v083.js","meteor://ðŸ’»app/server/startup/migrations/v084.js","meteor://ðŸ’»app/server/startup/migrations/v085.js","meteor://ðŸ’»app/server/startup/migrations/v086.js","meteor://ðŸ’»app/server/startup/migrations/v087.js","meteor://ðŸ’»app/server/startup/migrations/v088.js","meteor://ðŸ’»app/server/startup/migrations/v089.js","meteor://ðŸ’»app/server/startup/migrations/v090.js","meteor://ðŸ’»app/server/startup/migrations/v091.js","meteor://ðŸ’»app/server/startup/migrations/v092.js","meteor://ðŸ’»app/server/startup/migrations/v093.js","meteor://ðŸ’»app/server/startup/migrations/v094.js","meteor://ðŸ’»app/server/startup/migrations/v095.js","meteor://ðŸ’»app/server/startup/migrations/v096.js","meteor://ðŸ’»app/server/startup/migrations/v097.js","meteor://ðŸ’»app/server/startup/migrations/v098.js","meteor://ðŸ’»app/server/startup/migrations/v099.js","meteor://ðŸ’»app/server/startup/migrations/v100.js","meteor://ðŸ’»app/server/startup/migrations/v101.js","meteor://ðŸ’»app/server/startup/migrations/v102.js","meteor://ðŸ’»app/server/startup/migrations/v103.js","meteor://ðŸ’»app/server/startup/migrations/v104.js","meteor://ðŸ’»app/server/startup/migrations/v105.js","meteor://ðŸ’»app/server/startup/migrations/v106.js","meteor://ðŸ’»app/server/startup/migrations/v107.js","meteor://ðŸ’»app/server/startup/migrations/v108.js","meteor://ðŸ’»app/server/startup/migrations/v109.js","meteor://ðŸ’»app/server/startup/migrations/v110.js","meteor://ðŸ’»app/server/startup/migrations/v111.js","meteor://ðŸ’»app/server/startup/migrations/v112.js","meteor://ðŸ’»app/server/startup/migrations/v113.js","meteor://ðŸ’»app/server/startup/migrations/v114.js","meteor://ðŸ’»app/server/startup/migrations/v115.js","meteor://ðŸ’»app/server/startup/migrations/xrun.js","meteor://ðŸ’»app/server/startup/appcache.js","meteor://ðŸ’»app/server/startup/avatar.js","meteor://ðŸ’»app/server/startup/cron.js","meteor://ðŸ’»app/server/startup/i18n-validation.js","meteor://ðŸ’»app/server/startup/initialData.js","meteor://ðŸ’»app/server/startup/presence.js","meteor://ðŸ’»app/server/startup/roomPublishes.js","meteor://ðŸ’»app/server/startup/serverRunning.js","meteor://ðŸ’»app/server/configuration/accounts_meld.js","meteor://ðŸ’»app/server/configuration/grant.js","meteor://ðŸ’»app/server/methods/OEmbedCacheCleanup.js","meteor://ðŸ’»app/server/methods/addAllUserToRoom.js","meteor://ðŸ’»app/server/methods/addRoomLeader.js","meteor://ðŸ’»app/server/methods/addRoomModerator.js","meteor://ðŸ’»app/server/methods/addRoomOwner.js","meteor://ðŸ’»app/server/methods/afterVerifyEmail.js","meteor://ðŸ’»app/server/methods/browseChannels.js","meteor://ðŸ’»app/server/methods/canAccessRoom.js","meteor://ðŸ’»app/server/methods/channelsList.js","meteor://ðŸ’»app/server/methods/createDirectMessage.js","meteor://ðŸ’»app/server/methods/deleteFileMessage.js","meteor://ðŸ’»app/server/methods/deleteUser.js","meteor://ðŸ’»app/server/methods/eraseRoom.js","meteor://ðŸ’»app/server/methods/getAvatarSuggestion.js","meteor://ðŸ’»app/server/methods/getRoomIdByNameOrId.js","meteor://ðŸ’»app/server/methods/getRoomNameById.js","meteor://ðŸ’»app/server/methods/getTotalChannels.js","meteor://ðŸ’»app/server/methods/getUsernameSuggestion.js","meteor://ðŸ’»app/server/methods/getUsersOfRoom.js","meteor://ðŸ’»app/server/methods/groupsList.js","meteor://ðŸ’»app/server/methods/hideRoom.js","meteor://ðŸ’»app/server/methods/ignoreUser.js","meteor://ðŸ’»app/server/methods/loadHistory.js","meteor://ðŸ’»app/server/methods/loadLocale.js","meteor://ðŸ’»app/server/methods/loadMissedMessages.js","meteor://ðŸ’»app/server/methods/loadNextMessages.js","meteor://ðŸ’»app/server/methods/loadSurroundingMessages.js","meteor://ðŸ’»app/server/methods/logoutCleanUp.js","meteor://ðŸ’»app/server/methods/messageSearch.js","meteor://ðŸ’»app/server/methods/migrate.js","meteor://ðŸ’»app/server/methods/muteUserInRoom.js","meteor://ðŸ’»app/server/methods/openRoom.js","meteor://ðŸ’»app/server/methods/readMessages.js","meteor://ðŸ’»app/server/methods/registerUser.js","meteor://ðŸ’»app/server/methods/removeRoomLeader.js","meteor://ðŸ’»app/server/methods/removeRoomModerator.js","meteor://ðŸ’»app/server/methods/removeRoomOwner.js","meteor://ðŸ’»app/server/methods/removeUserFromRoom.js","meteor://ðŸ’»app/server/methods/reportMessage.js","meteor://ðŸ’»app/server/methods/requestDataDownload.js","meteor://ðŸ’»app/server/methods/resetAvatar.js","meteor://ðŸ’»app/server/methods/roomNameExists.js","meteor://ðŸ’»app/server/methods/saveUserPreferences.js","meteor://ðŸ’»app/server/methods/saveUserProfile.js","meteor://ðŸ’»app/server/methods/sendConfirmationEmail.js","meteor://ðŸ’»app/server/methods/sendForgotPasswordEmail.js","meteor://ðŸ’»app/server/methods/setAvatarFromService.js","meteor://ðŸ’»app/server/methods/setUserActiveStatus.js","meteor://ðŸ’»app/server/methods/setUserPassword.js","meteor://ðŸ’»app/server/methods/toogleFavorite.js","meteor://ðŸ’»app/server/methods/unmuteUserInRoom.js","meteor://ðŸ’»app/server/methods/userSetUtcOffset.js","meteor://ðŸ’»app/server/publications/activeUsers.js","meteor://ðŸ’»app/server/publications/channelAndPrivateAutocomplete.js","meteor://ðŸ’»app/server/publications/fullUserData.js","meteor://ðŸ’»app/server/publications/messages.js","meteor://ðŸ’»app/server/publications/room.js","meteor://ðŸ’»app/server/publications/roomFiles.js","meteor://ðŸ’»app/server/publications/roomSubscriptionsByRole.js","meteor://ðŸ’»app/server/publications/spotlight.js","meteor://ðŸ’»app/server/publications/subscription.js","meteor://ðŸ’»app/server/publications/userAutocomplete.js","meteor://ðŸ’»app/server/publications/userChannels.js","meteor://ðŸ’»app/server/publications/userData.js","meteor://ðŸ’»app/server/stream/messages.js","meteor://ðŸ’»app/server/stream/streamBroadcast.js","meteor://ðŸ’»app/server/main.js","meteor://ðŸ’»app/lib/RegExp.js","meteor://ðŸ’»app/lib/francocatena_fix.js"],"names":["module","export","ReadReceipt","Random","watch","require","v","ModelReadReceipts","default","rawReadReceipts","model","rawCollection","list","debounceByRoomId","fn","roomId","args","clearTimeout","setTimeout","call","updateMessages","Meteor","bindEnvironment","firstSubscription","RocketChat","models","Subscriptions","getMinimumLastSeenByRoomId","Messages","setAsRead","ls","markMessagesAsRead","userId","userLastSeen","settings","get","room","Rooms","findOneById","fields","lm","storeReadReceipts","findUnreadMessagesByRoomAndDate","markMessageAsReadBySender","message","unread","ts","setAsReadById","_id","messages","Date","receipts","map","id","messageId","length","insertMany","e","console","error","getReceipts","findByMessageId","receipt","user","Users","username","name","methods","getReadReceipts","Error","method","rid","_Base","constructor","arguments","tryEnsureIndex","unique","find","exportDefault","sparse","callbacks","add","editedAt","setAsReadByRoomIdAndUserId","u","group","type","public","enableQuery","value","_","getIdentity","accessToken","HTTP","params","access_token","data","extend","response","Accounts","registerLoginHandler","loginRequest","cordova","authResponse","identity","serviceData","expiresAt","now","expiresIn","whitelisted","pick","options","profile","updateOrCreateUserFromExternalService","s","accountsConfig","forbidClientAccountCreation","loginExpirationInDays","config","emailTemplates","siteName","from","userToActivate","subject","TAPi18n","__","html","header","placeholders","replace","footer","email","reason","userActivated","active","action","verifyEmailHtml","verifyEmail","text","url","absoluteUrl","resetPasswordHtml","resetPassword","enrollAccount","lng","language","emails","address","onCreateUser","run","status","firstName","lastName","services","service","Object","values","verified","destinations","Roles","findUsersInRole","forEach","adminUser","Array","isArray","push","to","defer","Email","send","insertUserDoc","wrap","roles","Match","test","globalRoles","String","concat","password","defaultAuthServiceRoles","split","trim","users","findOne","joinDefaultChannels","runAsUser","joinDefaultChannelsSilenced","hasAdmin","authz","addUserRoles","validateLoginAttempt","login","allowed","includes","validEmail","filter","updateLastLoginById","validateNewUser","domainWhiteList","isEmpty","domain","inWhiteList","some","match","RegExp","escape","push_test","hasRole","Push","enabled","query","$and","$or","$exists","tokens","appCollection","count","title","apn","sound","sendPush","token","tries","post","statusCode","log","remove","SystemLogger","milli","Math","pow","configurePush","debug","allow","gcm","apiKey","projectNumber","passphrase","keyData","certData","gateway","undefined","Configure","production","sendInterval","sendBatchSize","serverSend","badge","app","topic","appName","startup","Migrations","version","up","lastLogin","generateUsernameSuggestion","setUsername","JSON","stringify","avatarOrigin","avatars","getAvatarSuggestionForUser","keys","dataURI","blob","image","contentType","RocketChatFile","dataURIParse","rs","bufferToStream","Buffer","fileStore","FileUpload","getStore","deleteByName","file","insert","setAvatarOrigin","tryDropIndex","uid","nonreactive","sub","update","$set","$unset","$in","uids","usernames","t","k","oldId","sort","join","removeById","multi","rn","$rename","item","toLowerCase","setNameById","$ne","msgs","$lt","removeByRoomId","$size","newUserName","findOneByUsername","floor","random","findByType","newId","id0","id1","ids","by","findOneByName","upsert","index","urls","isString","OEmbed","rocketUrlParser","Settings","CDN_PREFIX","ENV","MAIL_URL","denyUnverifiedEmails","avatarStore","path","toMigrate","source","Mongo","Collection","target","OEmbedCache","collection","collectionName","doc","rawSource","wrapAsync","drop","err","errmsg","newUsernames","uniq","admin","findOneAdmin","oldestUser","createdAt","setAllUsersActive","metaKeys","old","new","oldAndNew","oldSetting","oldValue","newSetting","newValue","oldFilesCollection","oldGridFSCollection","oldChunkCollection","newFilesCollection","Uploads","newGridFSCollection","newChunkCollection","cfsRecord","nameParts","original","extension","pop","record","size","complete","uploading","store","uploadedAt","updatedAt","oldGridFsFile","ObjectID","copies","files","key","filename","chunkSize","uploadDate","aliases","metadata","md5","files_id","oldChunk","n","urlsItem","parsedUrl","pathname","msg","_hidden","changes","Accounts_Facebook","Accounts_Facebook_id","Accounts_Facebook_secret","Accounts_Google","Accounts_Google_id","Accounts_Google_secret","Accounts_Github","Accounts_Github_id","Accounts_Github_secret","Accounts_Gitlab","Accounts_Gitlab_id","Accounts_Gitlab_secret","Accounts_Linkedin","Accounts_Linkedin_id","Accounts_Linkedin_secret","Accounts_Meteor","Accounts_Meteor_id","Accounts_Meteor_secret","Accounts_Twitter","Accounts_Twitter_id","Accounts_Twitter_secret","ServiceConfiguration","configurations","admins","fetch","pluck","green","rooms","findByTypes","creator","msgQuery","msgOptions","cursorFileMessages","$multi","i18nLabel","upgradeEtsToEditAt","Permissions","persistent","hidden","mentions","_roles","scope","addRole","LDAP_Url","LDAP_TLS","LDAP_DN","LDAP_Bind_Search","$setOnInsert","WebRTC_STUN_Server","WebRTC_TURN_Server","WebRTC_TURN_Username","WebRTC_TURN_Password","servers","encodeURIComponent","API_Analytics","scriptAlert","integrations","Integrations","script","processIncomingRequestScript","prepareOutgoingRequestScript","processOutgoingResponseScript","integration","loginHeader","requestUrl","resolve","result","npmRequestOptions","encoding","Assets","setAsset","content","headers","addUserPermission","allowPinning","$addToSet","footerValue","packageValue","customOauth","parts","bot","__migration_assets_files","chunks","__migration_assets_chunks","oldFile","mime","updateById","defaultUrl","assets","newRoomNotification","preferences","disableNewRoomNotification","newMessageNotification","disableNewMessageNotification","optOut","i18nDescription","favoriteRooms","lastVisitor","limit","lastNumber","parseInt","autolinkerUrls","RocketBot_Enabled","RocketBot_Name","code","label","escapeHTML","Statistics","installedAt","subscriptions","$not","$type","subscription","setArchivedByUsername","forward","timeout","replace1","replace2","replace3","replace4","replace5","replace6","oldColor","LivechatDepartment","showOnRegistration","GoogleSiteVerification_id","setting","reactions","visitor","visitorEmails","oauth","athorizedClients","section","channel","OAuthApps","redirectUri","getUsersInRole","removeUserFromRoles","oldPermission","down","newPermission","rids","outgoingIntegrations","i","event","retryFailedCalls","retryCount","retryDelay","linkedin","setName","runOnEdits","emailAddress","existingUser","emailHeader","emailFooter","startWithHTML","endsWithHTML","fs","logError","insertAvatar","details","avatarsFileStore","stream","callback","Promise","batch","arr","all","splice","then","s3","direct","AmazonS3","GoogleStorage","googleCloudStorage","avatarOrigins","avatarsPathRecord","avatarStoreTypeRecord","avatarsPath","process","env","AVATARS_PATH","avatarStoreType","oldAvatarGridFS","GridFS","countSync","Number","error_box","usersTotal","current","gridFSAvatar","getFileWithReadStream","readStream","deleteFile","filePath","stat","statSync","isFile","createReadStream","unlinkSync","avatarsFiles","avatarsChunks","audioNotification","lastActivity","LDAP_Domain_Base","LDAP_Domain_Search_User_ID","LDAP_Use_Custom_Domain_Search","LDAP_Custom_Domain_Search","LDAP_Domain_Search_User","LDAP_Domain_Search_Password","LDAP_Domain_Search_Filter","LDAP_Domain_Search_Object_Class","LDAP_Domain_Search_Object_Category","Custom_Domain_Search","parse","userDN","LDAP_Sync_User_Data","LDAP_Import_Users","majorColors","newvariables","lightenDarkenColor","col","amt","usePound","slice","num","r","b","g","toString","color","editor","newPreference","unreadRoomsMode","settingsMap","newSettingKey","LivechatVisitors","visitors","total","deparment","userAgent","ip","host","phone","role","createOrUpdate","FileUpload_GoogleStorage_Proxy","FileUpload_S3_Proxy","idleTimeLimit","fileQuery","filesToUpdate","messageQuery","announcement","getVersion","migrateTo","MIGRATION_VERSION","control","_getControl","last","_list","_setControl","AppCache","onlineOnly","sharp","WebApp","connectHandlers","use","req","res","decodeURIComponent","writeHead","write","end","exec","sandstorm","picture","setHeader","Avatars","reqModifiedHeader","toUTCString","initials","getAvatarColor","substr","toUpperCase","viewSize","fontSize","svg","format","toFormat","pipe","logger","Logger","SyncedCron","opts","level","generateStatistics","statistics","save","warn","cleanupOEmbedCache","schedule","parser","cron","getMinutes","job","getHours","start","flat","obj","newObj","isObject","i18nValidation","l","errors","langs","TAPi18next","resStore","lang","len","present","difference","red","white","rpad","createWithIdTypeAndName","db","create","statusDefault","utcOffset","getBinary","ADMIN_PASS","ADMIN_NAME","ADMIN_EMAIL","re","findOneByEmailAddress","ADMIN_USERNAME","nameValidation","checkUsernameAvailability","setPassword","INITIAL_USER","initialUser","TEST_MODE","addUserToDefaultChannels","instance","port","PORT","INSTANCE_IP","InstanceStatus","registerInstance","UserPresence","UserPresenceMonitor","roomTypes","setPublish","identifier","cl","muted","archived","ro","reactWhenReadOnly","jitsiTimeout","description","sysMes","joinCodeRequired","streamingOptions","hasPermission","findByTypeAndName","findByTypeNameAndUserId","findById","ready","tokenpass","findByTypeAndNameContainingUsername","hasAtLeastOnePermission","findByTypeContainingUsernames","semver","oplogState","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","desiredNodeVersion","clean","readFileSync","cwd","desiredNodeVersionMajor","major","Info","versions","node","arch","platform","commit","hash","branch","satisfies","startup_box","exit","orig_updateOrCreateUserFromExternalService","serviceName","_OAuthCustom","primaryEmail","a","primary","findQuery","findWhere","resetPasswordAndSetRequirePasswordChange","setServiceId","setEmailVerified","apply","provider","secret","apps","redirectUrl","errorUrl","OEmbedCacheCleanup","date","expirationDays","setDate","getDate","removeAfterDate","addAllUserToRoom","activeUsersOnly","check","Boolean","userCount","userFilter","findOneByRoomIdAndUserId","addUsernameById","createWithRoomAndUser","open","alert","userMentions","groupMentions","createUserJoinWithRoomIdAndUser","addRoomLeader","addRoleById","fromUser","createSubscriptionRoleAddedWithRoomIdAndUser","Notifications","notifyLogged","addRoomModerator","addRoomOwner","afterVerifyEmail","verifiedEmail","removeUserRoles","sortChannels","field","direction","sortUsers","browseChannels","sortBy","sortDirection","page","regex","escapeRegExp","skip","findByNameAndType","findByActiveUsersExcept","DDPRateLimiter","addRule","canAccessRoom","extraData","Maybe","channelsList","channelType","unblock","Optional","isNumber","roomIds","findByTypeAndUserId","userPref","getUserPreference","globalPref","mergeChannels","channels","findByNameContainingTypesWithUsername","findContainingTypesWithUsername","createDirectMessage","me","upsertSubscription","customFields","RateLimiter","limitMethod","deleteFileMessage","fileID","getMessageByFileId","deleteById","deleteUser","adminCount","userIsAdmin","indexOf","eraseRoom","canBeDeleted","facebook","google","github","pictureUrl","twitter","profile_image_url_https","gitlab","avatar_url","Gravatar","imageUrl","secure","validAvatars","avatar","getAvatarSuggestion","getRoomIdByNameOrId","getRoomNameById","getTotalChannels","slug","slugify","usernameIsAvaliable","generateSuggestion","preferredHandle","first","flatten","compact","getUsernameSuggestion","getUsersOfRoom","showAll","_user","records","findByRoomId","groupsList","nameFilter","groups","findByIds","hideRoom","hideByRoomIdAndUserId","ignoreUser","ignoredUser","ignore","subscriptionIgnoredUser","hideMessagesOfType","types","loadHistory","fromId","canAnonymous","canPreview","loadMessageHistory","loadLocale","locale","getText","shift","loadMissedMessages","findVisibleByRoomIdAfterTimestamp","loadNextMessages","findVisibleByRoomId","starred","loadSurroundingMessages","ceil","recordsBefore","findVisibleByRoomIdBeforeTimestamp","moreBefore","recordsAfter","afterMessages","moreAfter","logoutCleanUp","messageSearch","docs","currentUserId","currentUserName","currentUserTimezoneOffset","filterStarred","filterUrl","filterPinned","pinned","filterLocation","location","$exist","filterBeforeDate","day","month","year","beforeDate","setHours","getUTCHours","getTimezoneOffset","$lte","filterAfterDate","afterDate","setUTCHours","$gte","filterOnDate","dayAfter","filterLabel","tag","sortByTimestamp","startsWith","$regex","$options","mention","$text","$search","score","$meta","findByUserId","getMigrationVersion","muteUserInRoom","ObjectIncluding","mutedUser","muteUsernameByRoomId","createUserMutedWithRoomIdAndUser","openRoom","openByRoomIdAndUserId","readMessages","userSubscription","assign","registerUser","formData","AllowAnonymousRead","AllowAnonymousWrite","manuallyApproveNewUsers","_loginUser","pass","secretURL","validateEmailDomain","userData","importedUser","importIds","createUser","setReason","saveCustomFields","userModel","sendVerificationEmail","removeRoomLeader","removeRoleById","createSubscriptionRoleRemovedWithRoomIdAndUser","removeRoomModerator","removeRoomOwner","numOwners","removeUserFromRoom","removedUser","removeUsernameById","removeByRoomIdAndUserId","createUserRemovedWithRoomIdAndUser","reportMessage","Reports","createWithMessageDescriptionAndUserId","tempFolder","requestDataDownload","fullExport","currentUserData","lastOperation","ExportOperations","findLastOperationByUser","yesterday","setUTCDate","getUTCDate","requested","exportOperation","subFolderName","baseFolder","existsSync","mkdirSync","folderName","assetsFolder","roomList","exportPath","assetsPath","fileList","generatedFile","resetAvatar","unsetAvatarOrigin","roomNameExists","saveUserPreferences","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","autoImageLoad","emailNotificationMode","roomsListExhibitionMode","unreadAlert","notificationsSoundVolume","desktopNotifications","mobileNotifications","enableAutoAway","highlights","desktopNotificationDuration","messageViewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","sendOnEnter","roomCounterSidebar","sidebarShowFavorites","sidebarShowUnread","sidebarSortby","sidebarViewMode","sidebarHideAvatar","muteFocusedConversations","OneOf","clearSettings","setLanguage","setPreferences","saveUserProfile","checkPassword","typedPassword","bcrypt","passCheck","_checkPassword","digest","algorithm","realname","setRealName","newPassword","logout","setProfile","sendConfirmationEmail","sendForgotPasswordEmail","userEmail","sendResetPasswordEmail","setAvatarFromService","setUserAvatar","setUserActiveStatus","setUserActive","unsetLoginTokens","unsetReason","setUserPassword","requirePasswordChange","unsetRequirePasswordChange","toggleFavorite","f","setFavoriteByRoomIdAndUserId","unmuteUserInRoom","unmutedUser","unmuteUsernameByRoomId","createUserUnmutedWithRoomIdAndUser","userSetUtcOffset","setUtcOffset","publish","findUsersNotOffline","selector","pub","cursorHandle","findByNameStartingAndTypes","observeChanges","added","changed","removed","onStop","stop","getFullUserData","publication","cursor","cursorDelete","findInvisibleByRoomId","cursorDeleteHandle","lastUpdate","latestDate","oldestDate","inclusive","unreads","updated","findForUpdates","deleted","trashFindDeletedAfter","_deletedAt","latest","oldest","fname","announcementDetails","_updatedAt","lastMessage","livechatData","tags","sms","sentiment","broadcast","roomMap","_room","findByDefaultAndTypes","findBySubscriptionUserIdUpdatedAfter","findBySubscriptionUserId","getRoomByTypeAndName","roomFind","getRoomFind","cache","on","notifyUserInThisInstance","cursorFileListHandle","findNotHiddenFilesOfRoom","findByRoomIdAndRoles","fetchRooms","spotlight","searchForChannels","searchForDMs","roomOptions","findByNameAndTypeNotDefault","userOptions","searchableRoomTypes","entries","roomType","includeInRoomSearch","findByNameAndTypesNotContainingUsername","$nin","audioNotifications","audioNotificationValue","mobilePushNotifications","emailNotifications","blocked","blocker","autoTranslate","autoTranslateLanguage","disableNotifications","hideUnreadStatus","muteGroupMentions","ignored","processQueryOptionsOnResult","exceptions","findActiveByUsernameOrNameRegexWithExceptions","term","statusConnection","defaultRoom","requirePasswordChangeReason","statusLivechat","banners","msgStream","Streamer","allowWrite","allowRead","eventName","allowEmit","roomParticipant","publishMessage","imported","UI_Use_Real_Name","emitWithoutBroadcast","_db","DDPCommon","connections","sections","connection","auth","_authorizeConnection","info","instanceId","ok","broadcastAuth","authorizeConnection","getCollection","startMatrixBroadcast","_createdAt","observe","extraInformation","isDocker","instanceRecord","disconnect","DDP","connect","_dontPrintErrors","LoggerManager","logLevel","onReconnect","remoteId","selfId","streamName","StreamerCentral","instances","serverOnly","emitWithScope","_emit","startStreamCastBroadcast","_stream","raw_msg","parseDDP","subscribe","startStreamBroadcast","fromInstance","results","connected","endpoint","conn","currentStatus","i18n_status_func"],"mappings":"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","file":"/app.js","sourcesContent":["import { Random } from 'meteor/random';\nimport ModelReadReceipts from '../models/ReadReceipts';\n\nconst rawReadReceipts = ModelReadReceipts.model.rawCollection();\n\n// debounced function by roomId, so multiple calls within 2 seconds to same roomId runs only once\nconst list = {};\nconst debounceByRoomId = function(fn) {\n\treturn function(roomId, ...args) {\n\t\tclearTimeout(list[roomId]);\n\t\tlist[roomId] = setTimeout(() => { fn.call(this, roomId, ...args); }, 2000);\n\t};\n};\n\nconst updateMessages = debounceByRoomId(Meteor.bindEnvironment((roomId) => {\n\t// @TODO maybe store firstSubscription in room object so we don't need to call the above update method\n\tconst firstSubscription = RocketChat.models.Subscriptions.getMinimumLastSeenByRoomId(roomId);\n\tRocketChat.models.Messages.setAsRead(roomId, firstSubscription.ls);\n}));\n\nexport const ReadReceipt = {\n\tmarkMessagesAsRead(roomId, userId, userLastSeen) {\n\t\tif (!RocketChat.settings.get('Message_Read_Receipt_Enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId, { fields: { lm: 1 } });\n\n\t\t// if users last seen is greadebounceByRoomIdter than room's last message, it means the user already have this room marked as read\n\t\tif (userLastSeen > room.lm) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (userLastSeen) {\n\t\t\tthis.storeReadReceipts(RocketChat.models.Messages.findUnreadMessagesByRoomAndDate(roomId, userLastSeen), roomId, userId);\n\t\t}\n\n\t\tupdateMessages(roomId);\n\t},\n\n\tmarkMessageAsReadBySender(message, roomId, userId) {\n\t\tif (!RocketChat.settings.get('Message_Read_Receipt_Enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\t// this will usually happens if the message sender is the only one on the room\n\t\tconst firstSubscription = RocketChat.models.Subscriptions.getMinimumLastSeenByRoomId(roomId);\n\t\tif (message.unread && message.ts < firstSubscription.ls) {\n\t\t\tRocketChat.models.Messages.setAsReadById(message._id, firstSubscription.ls);\n\t\t}\n\n\t\tthis.storeReadReceipts([{ _id: message._id }], roomId, userId);\n\t},\n\n\tstoreReadReceipts(messages, roomId, userId) {\n\t\tif (RocketChat.settings.get('Message_Read_Receipt_Store_Users')) {\n\t\t\tconst ts = new Date();\n\t\t\tconst receipts = messages.map(message => {\n\t\t\t\treturn {\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\troomId,\n\t\t\t\t\tuserId,\n\t\t\t\t\tmessageId: message._id,\n\t\t\t\t\tts\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tif (receipts.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\trawReadReceipts.insertMany(receipts);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Error inserting read receipts per user');\n\t\t\t}\n\t\t}\n\t},\n\n\tgetReceipts(message) {\n\t\treturn ModelReadReceipts.findByMessageId(message._id).map(receipt => ({\n\t\t\t...receipt,\n\t\t\tuser: RocketChat.models.Users.findOneById(receipt.userId, { fields: { username: 1, name: 1 }})\n\t\t}));\n\t}\n};\n","import { Meteor } from 'meteor/meteor';\n\nimport { ReadReceipt } from '../../lib/ReadReceipt';\n\nMeteor.methods({\n\tgetReadReceipts({ messageId }) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tif (!messageId) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'The required \\'messageId\\' param is missing.', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'Invalid message', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', message.rid, Meteor.userId());\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getReadReceipts' });\n\t\t}\n\n\t\treturn ReadReceipt.getReceipts(message);\n\t}\n});\n","class ModelReadReceipts extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({\n\t\t\troomId: 1,\n\t\t\tuserId: 1,\n\t\t\tmessageId: 1\n\t\t}, {\n\t\t\tunique: 1\n\t\t});\n\t}\n\n\tfindByMessageId(messageId) {\n\t\treturn this.find({ messageId });\n\t}\n}\n\nexport default new ModelReadReceipts('message_read_receipt');\n","RocketChat.models.Messages.tryEnsureIndex({\n\tunread: 1\n}, {\n\tsparse: true\n});\n","import { ReadReceipt } from './lib/ReadReceipt';\n\nRocketChat.callbacks.add('afterSaveMessage', (message, room) => {\n\n\t// skips this callback if the message was edited\n\tif (message.editedAt) {\n\t\treturn message;\n\t}\n\n\t// set subscription as read right after message was sent\n\tRocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(room._id, message.u._id);\n\n\t// mark message as read as well\n\tReadReceipt.markMessageAsReadBySender(message, room._id, message.u._id);\n});\n","import './dbIndexes';\nimport './hooks';\nimport './settings';\n\nimport './api/methods/getReadReceipts';\n","RocketChat.settings.add('Message_Read_Receipt_Enabled', false, {\n\tgroup: 'Message',\n\ttype: 'boolean',\n\tpublic: true\n});\n\nRocketChat.settings.add('Message_Read_Receipt_Store_Users', false, {\n\tgroup: 'Message',\n\ttype: 'boolean',\n\tpublic: true,\n\tenableQuery: { _id: 'Message_Read_Receipt_Enabled', value: true }\n});\n","import '../../message-read-receipt/server';\n","import _ from 'underscore';\n\nfunction getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get('https://graph.facebook.com/me', {\n\t\t\tparams: {\n\t\t\t\taccess_token: accessToken\n\t\t\t}\n\t\t}).data;\n\t} catch (error) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Facebook. ${ error.message }`), {\n\t\t\tresponse: error.response\n\t\t});\n\t}\n}\n\nAccounts.registerLoginHandler(function(loginRequest) {\n\tif (!loginRequest.cordova) {\n\t\treturn;\n\t}\n\n\tloginRequest = loginRequest.authResponse;\n\n\tconst identity = getIdentity(loginRequest.accessToken);\n\tconst serviceData = {\n\t\taccessToken: loginRequest.accessToken,\n\t\texpiresAt: Date.now() + 1000 * loginRequest.expiresIn\n\t};\n\n\tconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'username', 'gender', 'locale', 'age_range'];\n\tconst fields = _.pick(identity, whitelisted);\n\tconst options = {\n\t\tprofile: {}\n\t};\n\n\t_.extend(serviceData, fields);\n\t_.extend(options.profile, fields);\n\n\treturn Accounts.updateOrCreateUserFromExternalService('facebook', serviceData, options);\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nconst accountsConfig = {\n\tforbidClientAccountCreation: true,\n\tloginExpirationInDays: RocketChat.settings.get('Accounts_LoginExpiration')\n};\n\nAccounts.config(accountsConfig);\n\nAccounts.emailTemplates.siteName = RocketChat.settings.get('Site_Name');\n\nAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\nAccounts.emailTemplates.userToActivate = {\n\tsubject() {\n\t\tconst subject = TAPi18n.__('Accounts_Admin_Email_Approval_Needed_Subject_Default');\n\t\tconst siteName = RocketChat.settings.get('Site_Name');\n\n\t\treturn `[${ siteName }] ${ subject }`;\n\t},\n\n\thtml(options = {}) {\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\t\tconst email = options.reason ? 'Accounts_Admin_Email_Approval_Needed_With_Reason_Default' : 'Accounts_Admin_Email_Approval_Needed_Default';\n\n\t\tconst html = RocketChat.placeholders.replace(TAPi18n.__(email), {\n\t\t\tname: options.name,\n\t\t\temail: options.email,\n\t\t\treason: options.reason\n\t\t});\n\n\t\treturn header + html + footer;\n\t}\n};\n\nAccounts.emailTemplates.userActivated = {\n\tsubject({active, username}) {\n\t\tconst action = active ? (username ? 'Activated' : 'Approved') : 'Deactivated';\n\t\tconst subject = `Accounts_Email_${ action }_Subject`;\n\t\tconst siteName = RocketChat.settings.get('Site_Name');\n\n\t\treturn `[${ siteName }] ${ TAPi18n.__(subject) }`;\n\t},\n\n\thtml({active, name, username}) {\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\t\tconst action = active ? (username ? 'Activated' : 'Approved') : 'Deactivated';\n\n\t\tconst html = RocketChat.placeholders.replace(TAPi18n.__(`Accounts_Email_${ action }`), {\n\t\t\tname\n\t\t});\n\n\t\treturn header + html + footer;\n\t}\n};\n\n\nconst verifyEmailHtml = Accounts.emailTemplates.verifyEmail.text;\n\nAccounts.emailTemplates.verifyEmail.html = function(user, url) {\n\turl = url.replace(Meteor.absoluteUrl(), `${ Meteor.absoluteUrl() }login/`);\n\treturn verifyEmailHtml(user, url);\n};\n\nconst resetPasswordHtml = Accounts.emailTemplates.resetPassword.text;\n\nAccounts.emailTemplates.resetPassword.html = function(user, url) {\n\turl = url.replace(/\\/#\\//, '/');\n\treturn resetPasswordHtml(user, url);\n};\n\nAccounts.emailTemplates.enrollAccount.subject = function(user = {}) {\n\tlet subject;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\tsubject = RocketChat.settings.get('Accounts_Enrollment_Email_Subject');\n\t} else {\n\t\tsubject = TAPi18n.__('Accounts_Enrollment_Email_Subject_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\treturn RocketChat.placeholders.replace(subject);\n};\n\nAccounts.emailTemplates.enrollAccount.html = function(user = {}/*, url*/) {\n\tlet html;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\thtml = RocketChat.settings.get('Accounts_Enrollment_Email');\n\t} else {\n\t\thtml = TAPi18n.__('Accounts_Enrollment_Email_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\n\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\thtml = RocketChat.placeholders.replace(html, {\n\t\tname: user.name,\n\t\temail: user.emails && user.emails[0] && user.emails[0].address\n\t});\n\n\treturn header + html + footer;\n};\n\nAccounts.onCreateUser(function(options, user = {}) {\n\tRocketChat.callbacks.run('beforeCreateUser', options, user);\n\n\tuser.status = 'offline';\n\tuser.active = !RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\n\tif (!user.name) {\n\t\tif (options.profile) {\n\t\t\tif (options.profile.name) {\n\t\t\t\tuser.name = options.profile.name;\n\t\t\t} else if (options.profile.firstName && options.profile.lastName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = `${ options.profile.firstName } ${ options.profile.lastName }`;\n\t\t\t} else if (options.profile.firstName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = options.profile.firstName;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.services) {\n\t\tfor (const service of Object.values(user.services)) {\n\t\t\tif (!user.name) {\n\t\t\t\tuser.name = service.name || service.username;\n\t\t\t}\n\n\t\t\tif (!user.emails && service.email) {\n\t\t\t\tuser.emails = [{\n\t\t\t\t\taddress: service.email,\n\t\t\t\t\tverified: true\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!user.active) {\n\t\tconst destinations = [];\n\n\t\tRocketChat.models.Roles.findUsersInRole('admin').forEach(adminUser => {\n\t\t\tif (Array.isArray(adminUser.emails)) {\n\t\t\t\tadminUser.emails.forEach(email => {\n\t\t\t\t\tdestinations.push(`${ adminUser.name }<${ email.address }>`);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconst email = {\n\t\t\tto: destinations,\n\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\tsubject: Accounts.emailTemplates.userToActivate.subject(),\n\t\t\thtml: Accounts.emailTemplates.userToActivate.html(options)\n\t\t};\n\n\t\tMeteor.defer(() => Email.send(email));\n\t}\n\n\treturn user;\n});\n\nAccounts.insertUserDoc = _.wrap(Accounts.insertUserDoc, function(insertUserDoc, options, user) {\n\tlet roles = [];\n\n\tif (Match.test(user.globalRoles, [String]) && user.globalRoles.length > 0) {\n\t\troles = roles.concat(user.globalRoles);\n\t}\n\n\tdelete user.globalRoles;\n\n\tif (user.services && !user.services.password) {\n\t\tconst defaultAuthServiceRoles = String(RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Default_Roles')).split(',');\n\t\tif (defaultAuthServiceRoles.length > 0) {\n\t\t\troles = roles.concat(defaultAuthServiceRoles.map(s => s.trim()));\n\t\t}\n\t}\n\n\tif (!user.type) {\n\t\tuser.type = 'user';\n\t}\n\n\tconst _id = insertUserDoc.call(Accounts, options, user);\n\n\tuser = Meteor.users.findOne({\n\t\t_id\n\t});\n\n\tif (user.username) {\n\t\tif (options.joinDefaultChannels !== false && user.joinDefaultChannels !== false) {\n\t\t\tMeteor.runAsUser(_id, function() {\n\t\t\t\treturn Meteor.call('joinDefaultChannels', options.joinDefaultChannelsSilenced);\n\t\t\t});\n\t\t}\n\n\t\tif (user.type !== 'visitor') {\n\t\t\tMeteor.defer(function() {\n\t\t\t\treturn RocketChat.callbacks.run('afterCreateUser', user);\n\t\t\t});\n\t\t}\n\t}\n\n\tif (roles.length === 0) {\n\t\tconst hasAdmin = RocketChat.models.Users.findOne({\n\t\t\troles: 'admin',\n\t\t\ttype: 'user'\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (hasAdmin) {\n\t\t\troles.push('user');\n\t\t} else {\n\t\t\troles.push('admin');\n\t\t}\n\t}\n\n\tRocketChat.authz.addUserRoles(_id, roles);\n\n\treturn _id;\n});\n\nAccounts.validateLoginAttempt(function(login) {\n\tlogin = RocketChat.callbacks.run('beforeValidateLogin', login);\n\n\tif (login.allowed !== true) {\n\t\treturn login.allowed;\n\t}\n\n\tif (login.user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (!!login.user.active !== true) {\n\t\tthrow new Meteor.Error('error-user-is-not-activated', 'User is not activated', {\n\t\t\t'function': 'Accounts.validateLoginAttempt'\n\t\t});\n\t}\n\n\tif (!login.user.roles || !Array.isArray(login.user.roles)) {\n\t\tthrow new Meteor.Error('error-user-has-no-roles', 'User has no roles', {\n\t\t\t'function': 'Accounts.validateLoginAttempt'\n\t\t});\n\t}\n\n\tif (login.user.roles.includes('admin') === false && login.type === 'password' && RocketChat.settings.get('Accounts_EmailVerification') === true) {\n\t\tconst validEmail = login.user.emails.filter(email => email.verified === true);\n\t\tif (validEmail.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email __email__');\n\t\t}\n\t}\n\n\tlogin = RocketChat.callbacks.run('onValidateLogin', login);\n\n\tRocketChat.models.Users.updateLastLoginById(login.user._id);\n\tMeteor.defer(function() {\n\t\treturn RocketChat.callbacks.run('afterValidateLogin', login);\n\t});\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Enabled') === false && RocketChat.settings.get('LDAP_Enable') === false && !(user.services && user.services.password)) {\n\t\tthrow new Meteor.Error('registration-disabled-authentication-services', 'User registration is disabled for authentication services');\n\t}\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tlet domainWhiteList = RocketChat.settings.get('Accounts_AllowedDomainsList');\n\tif (_.isEmpty(s.trim(domainWhiteList))) {\n\t\treturn true;\n\t}\n\n\tdomainWhiteList = domainWhiteList.split(',').map(domain => domain.trim());\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tconst email = user.emails[0].address;\n\t\tconst inWhiteList = domainWhiteList.some(domain => email.match(`@${ RegExp.escape(domain) }$`));\n\n\t\tif (inWhiteList === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain');\n\t\t}\n\t}\n\n\treturn true;\n});\n","/* global Push, SystemLogger */\n\nMeteor.methods({\n\t// log() {\n\t// \treturn console.log(...arguments);\n\t// },\n\n\tpush_test() {\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (Push.enabled !== true) {\n\t\t\tthrow new Meteor.Error('error-push-disabled', 'Push is disabled', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\t$and: [{\n\t\t\t\tuserId: user._id\n\t\t\t}, {\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}]\n\t\t};\n\n\t\tconst tokens = Push.appCollection.find(query).count();\n\n\t\tif (tokens === 0) {\n\t\t\tthrow new Meteor.Error('error-no-tokens-for-this-user', 'There are no tokens for this user', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tPush.send({\n\t\t\tfrom: 'push',\n\t\t\ttitle: `@${ user.username }`,\n\t\t\ttext: TAPi18n.__('This_is_a_push_test_messsage'),\n\t\t\tapn: {\n\t\t\t\ttext: `@${ user.username }:\\n${ TAPi18n.__('This_is_a_push_test_messsage') }`\n\t\t\t},\n\t\t\tsound: 'default',\n\t\t\tquery: {\n\t\t\t\tuserId: user._id\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tmessage: 'Your_push_was_sent_to_s_devices',\n\t\t\tparams: [tokens]\n\t\t};\n\t}\n});\n\nfunction sendPush(service, token, options, tries = 0) {\n\tconst data = {\n\t\tdata: {\n\t\t\ttoken,\n\t\t\toptions\n\t\t}\n\t};\n\n\treturn HTTP.post(`${ RocketChat.settings.get('Push_gateway') }/push/${ service }/send`, data, function(error, response) {\n\t\tif (response && response.statusCode === 406) {\n\t\t\tconsole.log('removing push token', token);\n\t\t\tPush.appCollection.remove({\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': token\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': token\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!error) {\n\t\t\treturn;\n\t\t}\n\n\t\tSystemLogger.error(`Error sending push to gateway (${ tries } try) ->`, error);\n\n\t\tif (tries <= 6) {\n\t\t\tconst milli = Math.pow(10, tries + 2);\n\n\t\t\tSystemLogger.log('Trying sending push to gateway again in', milli, 'milliseconds');\n\n\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\treturn sendPush(service, token, options, tries + 1);\n\t\t\t}, milli);\n\t\t}\n\t});\n}\n\nfunction configurePush() {\n\tif (RocketChat.settings.get('Push_debug')) {\n\t\tPush.debug = true;\n\t\tconsole.log('Push: configuring...');\n\t}\n\n\tif (RocketChat.settings.get('Push_enable') === true) {\n\t\tPush.allow({\n\t\t\tsend(userId/*, notification*/) {\n\t\t\t\treturn RocketChat.authz.hasRole(userId, 'admin');\n\t\t\t}\n\t\t});\n\n\t\tlet apn;\n\t\tlet gcm;\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === false) {\n\t\t\tgcm = {\n\t\t\t\tapiKey: RocketChat.settings.get('Push_gcm_api_key'),\n\t\t\t\tprojectNumber: RocketChat.settings.get('Push_gcm_project_number')\n\t\t\t};\n\n\t\t\tapn = {\n\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_passphrase'),\n\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_key'),\n\t\t\t\tcertData: RocketChat.settings.get('Push_apn_cert')\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('Push_production') !== true) {\n\t\t\t\tapn = {\n\t\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_dev_passphrase'),\n\t\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_dev_key'),\n\t\t\t\t\tcertData: RocketChat.settings.get('Push_apn_dev_cert'),\n\t\t\t\t\tgateway: 'gateway.sandbox.push.apple.com'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!apn.keyData || apn.keyData.trim() === '' || !apn.certData || apn.certData.trim() === '') {\n\t\t\t\tapn = undefined;\n\t\t\t}\n\n\t\t\tif (!gcm.apiKey || gcm.apiKey.trim() === '' || !gcm.projectNumber || gcm.projectNumber.trim() === '') {\n\t\t\t\tgcm = undefined;\n\t\t\t}\n\t\t}\n\n\t\tPush.Configure({\n\t\t\tapn,\n\t\t\tgcm,\n\t\t\tproduction: RocketChat.settings.get('Push_production'),\n\t\t\tsendInterval: 1000,\n\t\t\tsendBatchSize: 10\n\t\t});\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === true) {\n\t\t\tPush.serverSend = function(options = {badge: 0}) {\n\t\t\t\tif (options.from !== String(options.from)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"from\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.title !== String(options.title)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"title\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.text !== String(options.text)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"text\" not a string');\n\t\t\t\t}\n\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\tconsole.log(`Push: send message \"${ options.title }\" via query`, options.query);\n\t\t\t\t}\n\n\t\t\t\tconst query = {\n\t\t\t\t\t$and: [options.query, {\n\t\t\t\t\t\t$or: [{\n\t\t\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\n\t\t\t\treturn Push.appCollection.find(query).forEach((app) => {\n\t\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\t\tconsole.log('Push: send to token', app.token);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.apn) {\n\t\t\t\t\t\toptions.topic = app.appName;\n\t\t\t\t\t\treturn sendPush('apn', app.token.apn, options);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.gcm) {\n\t\t\t\t\t\treturn sendPush('gcm', app.token.gcm, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\treturn Push.enabled = true;\n\t}\n}\n\nMeteor.startup(function() {\n\treturn configurePush();\n});\n","RocketChat.Migrations.add({\n\tversion: 1,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tlastLogin: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst username = RocketChat.generateUsernameSuggestion(user);\n\t\t\tif (username && username.trim() !== '') {\n\t\t\t\treturn RocketChat.models.Users.setUsername(user._id, username);\n\t\t\t} else {\n\t\t\t\treturn console.log('User without username', JSON.stringify(user, null, ' '));\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals getAvatarSuggestionForUser */\n\nRocketChat.Migrations.add({\n\tversion: 2,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tavatarOrigin: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tusername: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst avatars = getAvatarSuggestionForUser(user);\n\t\t\tconst services = Object.keys(avatars);\n\n\t\t\tif (services.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst service = services[0];\n\n\t\t\tconsole.log(user.username, '->', service);\n\n\t\t\tconst dataURI = avatars[service].blob;\n\t\t\tconst {image, contentType} = RocketChatFile.dataURIParse(dataURI);\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(image, 'base64'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName(user.username);\n\n\t\t\tconst file = {\n\t\t\t\tuserId: user._id,\n\t\t\t\ttype: contentType\n\t\t\t};\n\n\t\t\tfileStore.insert(file, rs, () => {\n\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 3,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('uid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('rid_1_uid_1');\n\n\t\tconsole.log('Fixing ChatSubscription uid');\n\n\t\tRocketChat.models.Subscriptions.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((sub) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(sub.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Subscriptions.update(sub._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatRoom uids');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'uids.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach(function(room) {\n\t\t\tconst update = {};\n\t\t\tconst users = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: room.uids\n\t\t\t\t},\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst usernames = users.map(function(user) {\n\t\t\t\treturn user.username;\n\t\t\t});\n\n\t\t\tif (!update.$set) {\n\t\t\t\tupdate.$set = {};\n\t\t\t}\n\n\t\t\tif (!update.$unset) {\n\t\t\t\tupdate.$unset = {};\n\t\t\t}\n\n\t\t\tupdate.$set.usernames = usernames;\n\t\t\tupdate.$unset.uids = 1;\n\n\t\t\tconst user = RocketChat.models.Users.findOneById(room.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (room.t === 'd' && usernames.length === 2) {\n\t\t\t\tfor (const k of Object.keys(update.$set)) {\n\t\t\t\t\tconst v = update.$set[k];\n\t\t\t\t\troom[k] = v;\n\t\t\t\t}\n\n\t\t\t\tfor (const k of Object.keys(update.$unset)) {\n\t\t\t\t\tdelete room[k];\n\t\t\t\t}\n\n\t\t\t\tconst oldId = room._id;\n\n\t\t\t\troom._id = usernames.sort().join(',');\n\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t\tRocketChat.models.Rooms.removeById(oldId);\n\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.models.Messages.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn RocketChat.models.Rooms.update(room._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatMessage uid');\n\n\t\tRocketChat.models.Messages.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((message) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Messages.update(message._id, update);\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 4,\n\tup() {\n\t\tRocketChat.models.Messages.tryDropIndex('rid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1');\n\n\t\tconsole.log('Rename rn to name');\n\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\trn: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\trn: 'name'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconsole.log('Adding names to rooms without name');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tname: ''\n\t\t}).forEach((item) => {\n\t\t\tconst name = Random.id().toLowerCase();\n\n\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: item._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: true\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Making room names unique');\n\n\t\tRocketChat.models.Rooms.find().forEach(function(room) {\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\tname: room.name,\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: room._id\n\t\t\t\t}\n\t\t\t}).forEach((item) => {\n\t\t\t\tconst name = `${ room.name }-${ Random.id(2).toLowerCase() }`;\n\n\t\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: item._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 5,\n\tup() {\n\t\tconsole.log('Dropping test rooms with less than 2 messages');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tmsgs: {\n\t\t\t\t$lt: 2\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Dropping test rooms with less than 2 user');\n\t\tRocketChat.models.Rooms.find({\n\t\t\tusernames: {\n\t\t\t\t$size: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Adding username to all users');\n\t\tRocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: 0\n\t\t\t},\n\t\t\temails: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tlet newUserName = user.emails[0].address.split('@')[0];\n\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(`Adding: username ${ newUserName } to all user ${ user._id }`);\n\t\t\treturn RocketChat.models.Users.setUsername(user._id, newUserName);\n\t\t});\n\n\t\tconsole.log('Fixing _id of direct messages rooms');\n\t\tRocketChat.models.Rooms.findByType('d').forEach(function(room) {\n\t\t\tlet newId = '';\n\t\t\tconst id0 = RocketChat.models.Users.findOneByUsername(room.usernames[0])._id;\n\t\t\tconst id1 = RocketChat.models.Users.findOneByUsername(room.usernames[1])._id;\n\t\t\tconst ids = [id0, id1];\n\n\t\t\tnewId = ids.sort().join('');\n\t\t\tif (newId !== room._id) {\n\t\t\t\tconsole.log(`Fixing: _id ${ room._id } to ${ newId }`);\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\t\troom._id = newId;\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id0\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[1]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id1\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[0]\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Adding u.username to all documents');\n\t\tRocketChat.models.Users.find({}, {\n\t\t\tusername: 1\n\t\t}).forEach((user) => {\n\t\t\tconsole.log(`Adding: u.username ${ user.username } to all document`);\n\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tby: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: {\n\t\t\t\t\t$exists: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$unset: {\n\t\t\t\t\tuid: 1,\n\t\t\t\t\tby: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 6,\n\tup() {\n\t\tconsole.log('Changing _id of #general channel room from XXX to GENERAL');\n\n\t\tconst room = RocketChat.models.Rooms.findOneByName('general');\n\n\t\tif (room && room._id !== 'GENERAL') {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\n\t\t\tdelete room._id;\n\n\t\t\tRocketChat.models.Rooms.upsert({\n\t\t\t\t_id: 'GENERAL'\n\t\t\t}, {\n\t\t\t\t$set: room\n\t\t\t});\n\t\t}\n\n\t\treturn console.log('End');\n\t}\n});\n","/* globals OEmbed */\nimport _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 7,\n\tup() {\n\t\tconsole.log('Populate urls in messages');\n\n\t\tconst query = RocketChat.models.Messages.find({\n\t\t\t'urls.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t});\n\n\t\tconst count = query.count();\n\n\t\tquery.forEach((message, index) => {\n\t\t\tconsole.log(`${ index + 1 } / ${ count }`);\n\n\t\t\tmessage.urls = message.urls.map((url) => {\n\t\t\t\tif (_.isString(url)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\t\treturn OEmbed.rocketUrlParser(message);\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 8,\n\tup() {\n\t\tconsole.log('Load old settings record');\n\t\tconst settings = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'settings'\n\t\t});\n\n\t\tif (settings) {\n\t\t\tif (settings.CDN_PREFIX) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'CDN_PREFIX', value: settings.CDN_PREFIX, type: 'string', group: 'General'});\n\t\t\t}\n\n\t\t\tif (settings.ENV && settings.ENV.MAIL_URL) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'MAIL_URL', value: settings.ENV.MAIL_URL, type: 'string', group: 'SMTP'});\n\t\t\t}\n\n\t\t\tif (settings.denyUnverifiedEmails) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'Accounts_denyUnverifiedEmails', value: settings.denyUnverifiedEmails, type: 'boolean', group: 'Accounts'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.type) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_type', value: settings.public.avatarStore.type, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.path) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_path', value: settings.public.avatarStore.path, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Settings.remove({\n\t\t\t\t_id: 'settings'\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 9,\n\tup() {\n\t\t// Migrate existing source collection data to target collection\n\t\t// target collection is defined in collections.coffee using the new collection name\n\t\t// source collection is dropped after data migration\n\t\tconst toMigrate = [\n\t\t\t{\n\t\t\t\tsource: new Mongo.Collection('data.ChatRoom'),\n\t\t\t\ttarget: RocketChat.models.Rooms.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatSubscription'),\n\t\t\t\ttarget: RocketChat.models.Subscriptions.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatMessage'),\n\t\t\t\ttarget: RocketChat.models.Messages.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('settings'),\n\t\t\t\ttarget: RocketChat.models.Settings.model\n\t\t\t}, {\n\t\t\t\t// this collection may not exit\n\t\t\t\tsource: new Mongo.Collection('oembed_cache'),\n\t\t\t\ttarget: RocketChat.models.OEmbedCache.model\n\t\t\t}\n\t\t];\n\n\t\treturn toMigrate.forEach((collection) => {\n\t\t\tconst {target, source} = collection;\n\n\t\t\t// rawCollection available as of Meteor 1.0.4\n\t\t\tconsole.log(`Migrating data from: ${ source.rawCollection().collectionName } to: ${ target.rawCollection().collectionName }`);\n\n\t\t\tsource.find().forEach((doc) => {\n\t\t\t\t// use upsert to account for GENERAL room created by initialData\n\t\t\t\treturn target.upsert({\n\t\t\t\t\t_id: doc._id\n\t\t\t\t}, doc);\n\t\t\t});\n\n\t\t\tconst rawSource = source.rawCollection();\n\n\t\t\treturn Meteor.wrapAsync(rawSource.drop, rawSource)(function(err/*, res*/) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn console.log(`Error dropping ${ rawSource.collectionName } collection due to: ${ err.errmsg }`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Note: the following would have been much easier, but didn't work.  The serverside\n\t\t\t// data was not published to the client for some reason.\n\t\t\t// newName = target.rawCollection().collectionName\n\t\t\t// Meteor.wrapAsync(rawSource.rename, rawSource )(newName, {dropTarget:true})\n\t\t});\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 10,\n\tup() {\n\t\t/*\n\t\t * Remove duplicated usernames from rooms\n\t\t */\n\t\tlet count = 0;\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'usernames.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusernames: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconst newUsernames = _.uniq(room.usernames);\n\t\t\tif (newUsernames.length !== room.usernames.length) {\n\t\t\t\tcount++;\n\t\t\t\treturn RocketChat.models.Rooms.update({\n\t\t\t\t\t_id: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusernames: newUsernames\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn console.log(`Removed duplicated usernames from ${ count } rooms`);\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 11,\n\tup() {\n\t\t/*\n\t\t * Set GENERAL room to be default\n\t\t */\n\t\tRocketChat.models.Rooms.update({\n\t\t\t_id: 'GENERAL'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'default': true\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('Set GENERAL room to be default');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 12,\n\tup() {\n\t\t// Set oldest user as admin, if none exists yet\n\t\tconst admin = RocketChat.models.Users.findOneAdmin(true, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (!admin) {\n\t\t\t// get oldest user\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: oldestUser._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tadmin: true\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn console.log(`Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 13,\n\tup() {\n\t\t// Set all current users as active\n\t\tRocketChat.models.Users.setAllUsersActive(true);\n\t\treturn console.log('Set all users as active');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 14,\n\tup() {\n\t\t// Remove unused settings\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_URL'});\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_ID'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Edit'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Delete'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_KeepStatusHistory'});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowEditedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowDeletedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\n\t\tconst metaKeys = [\n\t\t\t{\n\t\t\t\told: 'Meta:language',\n\t\t\t\tnew: 'Meta_language'\n\t\t\t}, {\n\t\t\t\told: 'Meta:fb:app_id',\n\t\t\t\tnew: 'Meta_fb_app_id'\n\t\t\t}, {\n\t\t\t\told: 'Meta:robots',\n\t\t\t\tnew: 'Meta_robots'\n\t\t\t}, {\n\t\t\t\told: 'Meta:google-site-verification',\n\t\t\t\tnew: 'Meta_google-site-verification'\n\t\t\t}, {\n\t\t\t\told: 'Meta:msvalidate.01',\n\t\t\t\tnew: 'Meta_msvalidate01'\n\t\t\t}\n\t\t];\n\n\t\tfor (const oldAndNew of metaKeys) {\n\t\t\tconst oldSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.old});\n\t\t\tconst oldValue = oldSetting && oldSetting.value;\n\n\t\t\tconst newSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.new});\n\t\t\tconst newValue = newSetting && newSetting.value;\n\n\t\t\tif (oldValue && newValue) {\n\t\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t\t_id: oldAndNew.new\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: newValue\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: oldAndNew.old\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'SMTP_Security'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 15,\n\tup() {\n\t\tconsole.log('Starting file migration');\n\t\tconst oldFilesCollection = new Mongo.Collection('cfs.Files.filerecord');\n\t\tconst oldGridFSCollection = new Mongo.Collection('cfs_gridfs.files.files');\n\t\tconst oldChunkCollection = new Mongo.Collection('cfs_gridfs.files.chunks');\n\t\tconst newFilesCollection = RocketChat.models.Uploads;\n\t\tconst newGridFSCollection = new Mongo.Collection('rocketchat_uploads.files');\n\t\tconst newChunkCollection = new Mongo.Collection('rocketchat_uploads.chunks');\n\n\t\toldFilesCollection.find({\n\t\t\t'copies.files.key': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((cfsRecord) => {\n\t\t\tconst nameParts = cfsRecord.original.name && cfsRecord.original.name.split('.');\n\t\t\tlet extension = '';\n\t\t\tlet url = `ufs/rocketchat_uploads/${ cfsRecord._id }`;\n\n\t\t\tconsole.log('migrating file', url);\n\n\t\t\tif (nameParts && nameParts.length > 1) {\n\t\t\t\textension = nameParts.pop();\n\t\t\t\turl = `${ url }.${ extension }`;\n\t\t\t}\n\n\t\t\tconst record = {\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tname: cfsRecord.original.name || '',\n\t\t\t\tsize: cfsRecord.original.size,\n\t\t\t\ttype: cfsRecord.original.type,\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tstore: 'rocketchat_uploads',\n\t\t\t\textension,\n\t\t\t\tuserId: cfsRecord.userId,\n\t\t\t\tuploadedAt: cfsRecord.updatedAt,\n\t\t\t\turl: Meteor.absoluteUrl() + url\n\t\t\t};\n\n\t\t\tnewFilesCollection.insert(record);\n\n\t\t\tconst oldGridFsFile = oldGridFSCollection.findOne({\n\t\t\t\t_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t});\n\n\t\t\tnewGridFSCollection.insert({\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tfilename: cfsRecord._id,\n\t\t\t\tcontentType: oldGridFsFile.contentType,\n\t\t\t\tlength: oldGridFsFile.length,\n\t\t\t\tchunkSize: oldGridFsFile.chunkSize,\n\t\t\t\tuploadDate: oldGridFsFile.uploadDate,\n\t\t\t\taliases: null,\n\t\t\t\tmetadata: null,\n\t\t\t\tmd5: oldGridFsFile.md5\n\t\t\t});\n\n\t\t\toldChunkCollection.find({\n\t\t\t\tfiles_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t}).forEach((oldChunk) => {\n\t\t\t\tnewChunkCollection.insert({\n\t\t\t\t\t_id: oldChunk._id,\n\t\t\t\t\tfiles_id: cfsRecord._id,\n\t\t\t\t\tn: oldChunk.n,\n\t\t\t\t\tdata: oldChunk.data\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.find({\n\t\t\t\t$or: [{\n\t\t\t\t\t'urls.url': `https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}, {\n\t\t\t\t\t'urls.url': `https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}]\n\t\t\t}).forEach((message) => {\n\t\t\t\tfor (const urlsItem of message.urls) {\n\t\t\t\t\tif (urlsItem.url === (`https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`) || urlsItem.url === (`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`)) {\n\t\t\t\t\t\turlsItem.url = Meteor.absoluteUrl() + url;\n\t\t\t\t\t\tif (urlsItem.parsedUrl && urlsItem.parsedUrl.pathname) {\n\t\t\t\t\t\t\turlsItem.parsedUrl.pathname = `/${ url }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Messages.update({_id: message._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\turls: message.urls,\n\t\t\t\t\t\tmsg: message.msg\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\toldFilesCollection.remove({_id: cfsRecord._id});\n\t\t\toldGridFSCollection.remove({_id: oldGridFsFile._id});\n\t\t\toldChunkCollection.remove({files_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)});\n\t\t});\n\n\t\treturn console.log('End of file migration');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 16,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 17,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 18,\n\tup() {\n\t\tconst changes = {\n\t\t\tAccounts_Facebook: 'Accounts_OAuth_Facebook',\n\t\t\tAccounts_Facebook_id: 'Accounts_OAuth_Facebook_id',\n\t\t\tAccounts_Facebook_secret: 'Accounts_OAuth_Facebook_secret',\n\t\t\tAccounts_Google: 'Accounts_OAuth_Google',\n\t\t\tAccounts_Google_id: 'Accounts_OAuth_Google_id',\n\t\t\tAccounts_Google_secret: 'Accounts_OAuth_Google_secret',\n\t\t\tAccounts_Github: 'Accounts_OAuth_Github',\n\t\t\tAccounts_Github_id: 'Accounts_OAuth_Github_id',\n\t\t\tAccounts_Github_secret: 'Accounts_OAuth_Github_secret',\n\t\t\tAccounts_Gitlab: 'Accounts_OAuth_Gitlab',\n\t\t\tAccounts_Gitlab_id: 'Accounts_OAuth_Gitlab_id',\n\t\t\tAccounts_Gitlab_secret: 'Accounts_OAuth_Gitlab_secret',\n\t\t\tAccounts_Linkedin: 'Accounts_OAuth_Linkedin',\n\t\t\tAccounts_Linkedin_id: 'Accounts_OAuth_Linkedin_id',\n\t\t\tAccounts_Linkedin_secret: 'Accounts_OAuth_Linkedin_secret',\n\t\t\tAccounts_Meteor: 'Accounts_OAuth_Meteor',\n\t\t\tAccounts_Meteor_id: 'Accounts_OAuth_Meteor_id',\n\t\t\tAccounts_Meteor_secret: 'Accounts_OAuth_Meteor_secret',\n\t\t\tAccounts_Twitter: 'Accounts_OAuth_Twitter',\n\t\t\tAccounts_Twitter_id: 'Accounts_OAuth_Twitter_id',\n\t\t\tAccounts_Twitter_secret: 'Accounts_OAuth_Twitter_secret'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\n\t\treturn ServiceConfiguration.configurations.remove({});\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 19,\n\tup() {\n\t\t/*\n\t\t * Migrate existing admin users to Role based admin functionality\n\t\t * 'admin' role applies to global scope\n\t\t */\n\n\t\tconst admins = Meteor.users.find({\n\t\t\tadmin: true\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tadmins.forEach((admin) => {\n\t\t\tRocketChat.authz.addUserRoles(admin._id, ['admin']);\n\t\t});\n\n\t\tMeteor.users.update({}, {\n\t\t\t$unset: {\n\t\t\t\tadmin: ''\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tlet usernames = _.pluck(admins, 'username').join(', ');\n\n\t\tconsole.log((`Migrate ${ usernames } from admin field to 'admin' role`).green);\n\n\t\t// Add 'user' role to all users\n\t\tconst users = Meteor.users.find().fetch();\n\t\tusers.forEach((user) => {\n\t\t\tRocketChat.authz.addUserRoles(user._id, ['user']);\n\t\t});\n\n\t\tusernames = _.pluck(users, 'username').join(', ');\n\t\tconsole.log((`Add ${ usernames } to 'user' role`).green);\n\n\t\t// Add 'moderator' role to channel/group creators\n\t\tconst rooms = RocketChat.models.Rooms.findByTypes(['c', 'p']).fetch();\n\t\treturn rooms.forEach((room) => {\n\t\t\tconst creator = room && room.u && room.u._id;\n\n\t\t\tif (creator) {\n\t\t\t\tif (Meteor.users.findOne({\n\t\t\t\t\t_id: creator\n\t\t\t\t})) {\n\t\t\t\t\treturn RocketChat.authz.addUserRoles(creator, ['moderator'], room._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\t\t\treturn RocketChat.models.Rooms.removeById(room._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 20,\n\tup() {\n\t\t/*\n\t\t * Migrate existing `rocketchat_uploads` documents to include the room Id\n\t\t * where the file was uploaded to. The room Id is retrieved from the message\n\t\t * document created after the file upload.\n\t\t */\n\n\t\t// list of channel messages which were created after uploading a file\n\t\tconst msgQuery = {\n\t\t\trid: {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t};\n\n\t\tconst msgOptions = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\trid: 1,\n\t\t\t\t'file._id': 1\n\t\t\t}\n\t\t};\n\n\t\tconst cursorFileMessages = RocketChat.models.Messages.find(msgQuery, msgOptions);\n\t\tif (!cursorFileMessages.count()) {\n\t\t\treturn;\n\t\t}\n\n\t\tcursorFileMessages.fetch().forEach((msg) => {\n\t\t\treturn RocketChat.models.Uploads.update({\n\t\t\t\t_id: msg.file && msg.file._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: msg.rid\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$multi: true\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('Updated rocketchat_uploads documents to include the room Id in which they were sent.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 21,\n\tup() {\n\t\t/*\n\t\t * Remove any i18nLabel from rocketchat_settings\n\t\t * They will be added again where necessary on next restart\n\t\t */\n\t\tRocketChat.models.Settings.update({\n\t\t\ti18nLabel: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\ti18nLabel: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\treturn console.log('Removed i18nLabel from Settings. New labels will be added on next restart! Please restart your server.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 22,\n\tup() {\n\t\t/*\n\t\t * Update message edit field\n\t\t */\n\t\tRocketChat.models.Messages.upgradeEtsToEditAt();\n\n\t\treturn console.log('Updated old messages\\' ets edited timestamp to new editedAt timestamp.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 23,\n\tup() {\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'Accounts_denyUnverifiedEmails'\n\t\t});\n\n\t\treturn console.log('Deleting not used setting Accounts_denyUnverifiedEmails');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 24,\n\tup() {\n\t\treturn RocketChat.models.Permissions.remove({\n\t\t\t_id: 'access-rocket-permissions'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 25,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tpersistent: true\n\t\t\t},\n\t\t\t$unset: {\n\t\t\t\thidden: true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 26,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\tt: 'rm'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmentions: []\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 27,\n\tup() {\n\n\t\tRocketChat.models.Users.update({}, {\n\t\t\t$rename: {\n\t\t\t\troles: '_roles'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tRocketChat.models.Users.find({\n\t\t\t_roles: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tfor (const scope of Object.keys(user._roles)) {\n\t\t\t\tconst roles = user._roles[scope];\n\t\t\t\tRocketChat.models.Roles.addUserRoles(user._id, roles, scope);\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Users.update({}, {\n\t\t\t$unset: {\n\t\t\t\t_roles: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 28,\n\tup() {\n\t\treturn RocketChat.models.Permissions.addRole('view-c-room', 'bot');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 29,\n\tup() {\n\t\tlet LDAP_Url = (RocketChat.models.Settings.findOne('LDAP_Url') || {}).value;\n\t\tconst LDAP_TLS = (RocketChat.models.Settings.findOne('LDAP_TLS') || {}).value;\n\t\tconst LDAP_DN = (RocketChat.models.Settings.findOne('LDAP_DN') || {}).value;\n\t\tconst LDAP_Bind_Search = (RocketChat.models.Settings.findOne('LDAP_Bind_Search') || {}).value;\n\n\t\tif (LDAP_Url && LDAP_Url.trim() !== '') {\n\t\t\tLDAP_Url = LDAP_Url.replace(/ldaps?:\\/\\//i, '');\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Host'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Url\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_TLS === true) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Encryption'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'tls'\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_DN && LDAP_DN.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Domain_Base'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_DN\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Username_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Unique_Identifier_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_Bind_Search && LDAP_Bind_Search.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Bind_Search\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Use_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: true\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Url'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_TLS'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_DN'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Bind_Search'});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 30,\n\tup() {\n\t\tconst WebRTC_STUN_Server = (RocketChat.models.Settings.findOne('WebRTC_STUN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Server = (RocketChat.models.Settings.findOne('WebRTC_TURN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Username = (RocketChat.models.Settings.findOne('WebRTC_TURN_Username') || {}).value;\n\t\tconst WebRTC_TURN_Password = (RocketChat.models.Settings.findOne('WebRTC_TURN_Password') || {}).value;\n\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_STUN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Username'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Password'});\n\n\t\tif (WebRTC_STUN_Server === 'stun:stun.l.google.com:19302' && WebRTC_TURN_Server === 'turn:numb.viagenie.ca:3478' && WebRTC_TURN_Username === 'team@rocket.chat' && WebRTC_TURN_Password === 'demo') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet servers = '';\n\t\tif (WebRTC_STUN_Server) {\n\t\t\tservers += WebRTC_STUN_Server;\n\t\t}\n\n\t\tif (WebRTC_TURN_Server) {\n\t\t\tservers += ', ';\n\t\t\tif (WebRTC_TURN_Username != null) {\n\t\t\t\tservers += `${ encodeURIComponent(WebRTC_TURN_Username) }:${ encodeURIComponent(WebRTC_TURN_Password) }@`;\n\t\t\t}\n\t\t\tservers += WebRTC_TURN_Server;\n\t\t}\n\n\t\tif (servers !== '') {\n\t\t\treturn RocketChat.models.Settings.upsert({_id: 'WebRTC_Servers'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: servers\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 31,\n\tup() {\n\t\tconst changes = {\n\t\t\tAPI_Analytics: 'GoogleTagManager_id'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 32,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom_/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tgroup: 'OAuth'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 33,\n\tup() {\n\t\tconst scriptAlert = '/**\\n * This script is out-of-date, convert to the new format\\n * (https://rocket.chat/docs/administrator-guides/integrations)\\n**/\\n\\n';\n\n\t\tconst integrations = RocketChat.models.Integrations.find({\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessIncomingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprepareOutgoingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessOutgoingResponseScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}).fetch();\n\n\t\tintegrations.forEach(function(integration) {\n\t\t\tlet script = '';\n\t\t\tif (integration.processIncomingRequestScript) {\n\t\t\t\tscript += `${ integration.processIncomingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.prepareOutgoingRequestScript) {\n\t\t\t\tscript += `${ integration.prepareOutgoingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.processOutgoingResponseScript) {\n\t\t\t\tscript += `${ integration.processOutgoingResponseScript }\\n\\n`;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Integrations.update(integration._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tscript: scriptAlert + script.replace(/^/gm, '// ')\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tlet update = {\n\t\t\t$unset: {\n\t\t\t\tprocessIncomingRequestScript: 1,\n\t\t\t\tprepareOutgoingRequestScript: 1,\n\t\t\t\tprocessOutgoingResponseScript: 1\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({}, update, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tupdate = {\n\t\t\t$set: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({\n\t\t\tenabled: {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, update, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 34,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo/logo.svg?v=3\" /></a>'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo?v=3\" /></a>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 35,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link_download': {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'attachments.$.title_link_download': true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","import url from 'url';\n\nRocketChat.Migrations.add({\n\tversion: 36,\n\tup() {\n\t\tconst loginHeader = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\n\t\tif (!loginHeader || !loginHeader.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = loginHeader.value.match(/<img\\ssrc=['\"]([^'\"]+)/);\n\n\t\tif (match && match.length === 2) {\n\t\t\tlet requestUrl = match[1];\n\t\t\tif (requestUrl[0] === '/') {\n\t\t\t\trequestUrl = url.resolve(Meteor.absoluteUrl(), requestUrl);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tMeteor.startup(function() {\n\t\t\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\t\t\tconst result = HTTP.get(requestUrl, {\n\t\t\t\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\t\t\t\tencoding: 'binary'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\t\treturn RocketChat.Assets.setAsset(result.content, result.headers['content-type'], 'logo');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 30000);\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.Settings.remove({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 37,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Find permission add-user (changed it to create-user)\n\t\t\tconst addUserPermission = RocketChat.models.Permissions.findOne('add-user');\n\n\t\t\tif (addUserPermission) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'create-user' }, { $set: { roles: addUserPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 38,\n\tup() {\n\t\tif (RocketChat && RocketChat.settings && RocketChat.settings.get) {\n\t\t\tconst allowPinning = RocketChat.settings.get('Message_AllowPinningByAnyone');\n\n\t\t\t// If public pinning was allowed, add pinning permissions to 'users', else leave it to 'owners' and 'moderators'\n\t\t\tif (allowPinning) {\n\t\t\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'user' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 39,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst footer = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\n\t\t\t// Replace footer octicons with icons\n\t\t\tif (footer && footer.value !== '') {\n\t\t\t\tlet footerValue = footer.value.replace('octicon octicon-pencil', 'icon-pencil');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-heart', 'icon-heart');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-mark-github', 'icon-github-circled');\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: footerValue, packageValue: footerValue } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 40,\n\tup() {\n\t\tRocketChat.models.Settings.find({ _id: /Accounts_OAuth_Custom_/, i18nLabel: 'Accounts_OAuth_Custom_Enable' }).forEach(function(customOauth) {\n\t\t\tconst parts = customOauth._id.split('_');\n\t\t\tconst name = parts[3];\n\t\t\tconst id = `Accounts_OAuth_Custom_${ name }_token_sent_via`;\n\t\t\tif (!RocketChat.models.Settings.findOne({ _id: id })) {\n\t\t\t\tRocketChat.models.Settings.insert({\n\t\t\t\t\t'_id': id,\n\t\t\t\t\t'type': 'select',\n\t\t\t\t\t'group': 'OAuth',\n\t\t\t\t\t'section': `Custom OAuth: ${ name }`,\n\t\t\t\t\t'i18nLabel': 'Accounts_OAuth_Custom_Token_Sent_Via',\n\t\t\t\t\t'persistent': true,\n\t\t\t\t\t'values': [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'header',\n\t\t\t\t\t\t\t'i18nLabel': 'Header'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'payload',\n\t\t\t\t\t\t\t'i18nLabel': 'Payload'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t'packageValue': 'payload',\n\t\t\t\t\t'valueSource': 'packageValue',\n\t\t\t\t\t'ts': new Date(),\n\t\t\t\t\t'hidden': false,\n\t\t\t\t\t'blocked': false,\n\t\t\t\t\t'sorter': 255,\n\t\t\t\t\t'i18nDescription': `Accounts_OAuth_Custom_${ name }_token_sent_via_Description`,\n\t\t\t\t\t'createdAt': new Date(),\n\t\t\t\t\t'value': 'payload'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 41,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ bot: true }, { $set: { type: 'bot' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'profile.guest': true }, { $set: { type: 'visitor' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 42,\n\tup() {\n\t\tconst files = RocketChat.__migration_assets_files = new Mongo.Collection('assets.files');\n\t\tconst chunks = RocketChat.__migration_assets_chunks = new Mongo.Collection('assets.chunks');\n\t\tconst list = {\n\t\t\t'favicon.ico': 'favicon_ico',\n\t\t\t'favicon.svg': 'favicon',\n\t\t\t'favicon_64.png': 'favicon_64',\n\t\t\t'favicon_96.png': 'favicon_96',\n\t\t\t'favicon_128.png': 'favicon_128',\n\t\t\t'favicon_192.png': 'favicon_192',\n\t\t\t'favicon_256.png': 'favicon_256'\n\t\t};\n\n\t\tfor (const from of Object.keys(list)) {\n\t\t\tconst to = list[from];\n\n\t\t\tconst query = {\n\t\t\t\t_id: to\n\t\t\t};\n\n\t\t\tif (!files.findOne(query)) {\n\t\t\t\tconst oldFile = files.findOne({\n\t\t\t\t\t_id: from\n\t\t\t\t});\n\n\t\t\t\tif (oldFile) {\n\t\t\t\t\tconst extension = RocketChat.Assets.mime.extension(oldFile.contentType);\n\t\t\t\t\tRocketChat.settings.removeById(`Assets_${ from }`);\n\t\t\t\t\tRocketChat.settings.updateById(`Assets_${ to }`, {\n\t\t\t\t\t\turl: `/assets/${ to }.${ extension }`,\n\t\t\t\t\t\tdefaultUrl: RocketChat.Assets.assets[to].defaultUrl\n\t\t\t\t\t});\n\n\t\t\t\t\toldFile._id = to;\n\t\t\t\t\toldFile.filename = to;\n\t\t\t\t\tfiles.insert(oldFile);\n\t\t\t\t\tfiles.remove({\n\t\t\t\t\t\t_id: from\n\t\t\t\t\t});\n\n\t\t\t\t\tchunks.update({\n\t\t\t\t\t\tfiles_id: from\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfiles_id: to\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\tmulti: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 43,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'admin' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 44,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.find({ $or: [ { 'settings.preferences.disableNewRoomNotification': { $exists: 1 } }, { 'settings.preferences.disableNewMessageNotification': { $exists: 1 } } ] }).forEach(function(user) {\n\t\t\t\tconst newRoomNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewRoomNotification);\n\t\t\t\tconst newMessageNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewMessageNotification);\n\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.disableNewRoomNotification': 1, 'settings.preferences.disableNewMessageNotification': 1 }, $set: { 'settings.preferences.newRoomNotification': newRoomNotification, 'settings.preferences.newMessageNotification': newMessageNotification } });\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst optOut = RocketChat.models.Settings.findOne({ _id: 'Statistics_opt_out' });\n\t\t\tif (optOut) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Statistics_opt_out' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Statistics_reporting' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !optOut.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Statistics_reporting_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Statistics_reporting'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst favoriteRooms = RocketChat.models.Settings.findOne({ _id: 'Disable_Favorite_Rooms' });\n\t\t\tif (favoriteRooms) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Disable_Favorite_Rooms' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Favorite_Rooms' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !favoriteRooms.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Favorite_Rooms_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Favorite_Rooms'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 45,\n\tup() {\n\n\t\t// finds the latest created visitor\n\t\tconst lastVisitor = RocketChat.models.Users.find({ type: 'visitor' }, { fields: { username: 1 }, sort: { createdAt: -1 }, limit: 1 }).fetch();\n\n\t\tif (lastVisitor && lastVisitor.length > 0) {\n\t\t\tconst lastNumber = lastVisitor[0].username.replace(/^guest\\-/, '');\n\n\t\t\tRocketChat.settings.add('Livechat_guest_count', (parseInt(lastNumber) + 1), { type: 'int', group: 'Livechat' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 46,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 47,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst autolinkerUrls = RocketChat.models.Settings.findOne({ _id: 'AutoLinker_Urls' });\n\t\t\tif (autolinkerUrls) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'AutoLinker_Urls' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_Scheme' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_Scheme'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_www' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_www'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_TLD' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_TLD'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 48,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\tconst RocketBot_Enabled = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t});\n\t\t\tif (RocketBot_Enabled) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Enabled'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Enabled.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst RocketBot_Name = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t});\n\t\t\tif (RocketBot_Name) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Username'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Name.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 49,\n\tup() {\n\n\t\tlet count = 1;\n\n\t\tRocketChat.models.Rooms.find({ t: 'l' }, { sort: { ts: 1 }, fields: { _id: 1 } }).forEach(function(room) {\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { code: count } });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, { $set: { code: count } }, { multi: true });\n\t\t\tcount++;\n\t\t});\n\n\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_Room_Count' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: count,\n\t\t\t\ttype: 'int',\n\t\t\t\tgroup: 'Livechat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 50,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1');\n\t\tRocketChat.models.Subscriptions.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1 });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 51,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ t: 'l', 'v.token': { $exists: true }, label: { $exists: false }}).forEach(function(room) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ 'profile.token': room.v.token });\n\t\t\tif (user) {\n\t\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tlabel: user.name || user.username,\n\t\t\t\t\t\t'v._id': user._id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname: user.name || user.username\n\t\t\t\t\t}\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 52,\n\tup() {\n\t\tRocketChat.models.Users.update({ _id: 'rocket.cat' }, { $addToSet: { roles: 'bot' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 53,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Header', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:callapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">'\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Footer', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 54,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\t// Set default message viewMode to 'normal' or 'cozy' depending on the users' current settings and remove the field 'compactView'\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.compactView': true }, { $set: { 'settings.preferences.viewMode': 1 }, $unset: { 'settings.preferences.compactView': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.viewMode': { $ne: 1 } }, { $set: { 'settings.preferences.viewMode': 0 } }, { multi: true });\n\t\t}\n\t}\n});\n","import s from 'underscore.string';\n\nRocketChat.Migrations.add({\n\tversion: 55,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ 'topic': { $exists: 1, $ne: '' } }, { topic: 1 }).forEach(function(room) {\n\t\t\tconst topic = s.escapeHTML(room.topic);\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { topic }});\n\t\t\tRocketChat.models.Messages.update({ t: 'room_changed_topic', rid: room._id }, { $set: { msg: topic }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 56,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.S?(.*)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 57,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /slack-slack/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace('slack-slack', 'slack');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.?S(.*)/, 'slack-$1-$2');\n\t\t\tmessage._id = message._id.replace(/\\./g, '-');\n\t\t\tRocketChat.models.Messages.remove({ _id: message._id });\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 58,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Push_gateway', value: 'https://rocket.chat' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'https://gateway.rocket.chat',\n\t\t\t\tpackageValue: 'https://gateway.rocket.chat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 59,\n\tup() {\n\t\tconst users = RocketChat.models.Users.find({}, { sort: { createdAt: 1 }, limit: 1 }).fetch();\n\t\tif (users && users.length > 0) {\n\t\t\tconst createdAt = users[0].createdAt;\n\t\t\tRocketChat.models.Settings.update({ createdAt: { $exists: 0 } }, { $set: { createdAt } }, { multi: true });\n\t\t\tRocketChat.models.Statistics.update({ installedAt: { $exists: 0 } }, { $set: { installedAt: createdAt } }, { multi: true });\n\t\t}\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 60,\n\tup() {\n\t\tlet subscriptions = RocketChat.models.Subscriptions.find({ $or: [ { name: { $exists: 0 } }, { name: { $not: { $type: 2 } } } ] }).fetch();\n\t\tif (subscriptions && subscriptions.length > 0) {\n\t\t\tRocketChat.models.Subscriptions.remove({ _id: { $in: _.pluck(subscriptions, '_id') } });\n\t\t}\n\n\t\tsubscriptions = RocketChat.models.Subscriptions.find().forEach(function(subscription) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ _id: subscription && subscription.u && subscription.u._id });\n\t\t\tif (!user) {\n\t\t\t\tRocketChat.models.Subscriptions.remove({ _id: subscription._id });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 61,\n\tup() {\n\t\tRocketChat.models.Users.find({ active: false }).forEach(function(user) {\n\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, true);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 62,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Atlassian Crowd', type: 'group' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 63,\n\tup() {\n\t\tconst forward = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats' });\n\t\tconst timeout = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats_timeout' });\n\n\t\tif (forward && forward.value) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'forward',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (timeout && timeout.value !== 60) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action_timeout' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: timeout.value,\n\t\t\t\t\ttype: 'int',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats_timeout' });\n\t}\n});\n","import s from 'underscore.string';\n\nRocketChat.Migrations.add({\n\tversion: 64,\n\tup() {\n\t\tRocketChat.models.Messages.find({ 't': 'room_changed_topic', 'msg': /</ }, { msg: 1 }).forEach(function(message) {\n\t\t\tconst msg = s.escapeHTML(message.msg);\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { msg }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 65,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tconst replace2 = RocketChat.models.Settings.findOne({ _id: 'theme-color-input-font-color' });\n\t\t\tconst replace3 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-online' });\n\t\t\tconst replace4 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-away' });\n\t\t\tconst replace5 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-busy' });\n\t\t\tconst replace6 = RocketChat.models.Settings.findOne({ _id: 'theme-color-info-active-font-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-secondary-action-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t\tif (replace2) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace2.value } });\n\t\t\t}\n\t\t\tif (replace3) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-success-color' }, { $set: { value: replace3.value } });\n\t\t\t}\n\t\t\tif (replace4) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-pending-color' }, { $set: { value: replace4.value } });\n\t\t\t}\n\t\t\tif (replace5) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-error-color' }, { $set: { value: replace5.value } });\n\t\t\t}\n\t\t\tif (replace6) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-selection-color' }, { $set: { value: replace6.value } });\n\t\t\t}\n\n\t\t\t// Renamed color settings\n\t\t\tconst oldColor = RocketChat.models.Settings.findOne({ _id: 'theme-color-action-buttons-color' });\n\t\t\tif (oldColor) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-action-buttons-color' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-primary-action-color' }, { $set: { value: oldColor.value } });\n\t\t\t}\n\n\t\t\t// Removed color settings\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-blockquote-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-clean-buttons-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-border' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-info-active-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-input-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-message-hover-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-hover-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-unread-notification-color' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 66,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-tertiary-background-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 67,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.LivechatDepartment) {\n\t\t\tRocketChat.models.LivechatDepartment.model.update({}, {\n\t\t\t\t$set: {\n\t\t\t\t\tshowOnRegistration: true\n\t\t\t\t}\n\t\t\t}, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 68,\n\tup() {\n\t\tconst GoogleSiteVerification_id = RocketChat.models.Settings.findOne({ _id: 'GoogleSiteVerification_id' });\n\n\t\tif (GoogleSiteVerification_id && GoogleSiteVerification_id.value) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'Meta_google-site-verification' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: GoogleSiteVerification_id.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'GoogleSiteVerification_id' });\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 69,\n\tup() {\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-custom-scrollbar-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.05)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-info-font-color',\n\t\t\t'value': '#aaaaaa'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@secondary-font-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-link-font-color',\n\t\t\t'value': '#008ce3'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@primary-action-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-away',\n\t\t\t'value': '#fcb316'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@pending-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-busy',\n\t\t\t'value': '#d30230'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@error-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-offline',\n\t\t\t'value': 'rgba(150, 150, 150, 0.50)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-online',\n\t\t\t'value': '#35ac19'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@success-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-background-color',\n\t\t\t'value': '#eaeaea'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@component-color'\n\t\t\t}\n\t\t});\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-font-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.6)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-lightest'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 70,\n\tup() {\n\t\tconst settings = RocketChat.models.Settings.find({ _id: /^Accounts_OAuth_Custom_.+/ }).fetch();\n\t\tfor (const setting of settings) {\n\t\t\tconst _id = setting._id;\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)_(.+)/, 'Accounts_OAuth_Custom-$1-$2');\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)/, 'Accounts_OAuth_Custom-$1');\n\n\t\t\tRocketChat.models.Settings.remove({ _id });\n\t\t\tRocketChat.models.Settings.insert(setting);\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71,\n\tup() {\n\t\t//Removes the reactions on messages which are the system type \"rm\" ;)\n\t\tRocketChat.models.Messages.find({ 't': 'rm', 'reactions': { $exists: true, $not: {$size: 0} } }, { t: 1 }).forEach(function(message) {\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { reactions: [] }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 72,\n\tup() {\n\t\tRocketChat.models.Users.find({ type: 'visitor', 'emails.address': { $exists: true } }, { emails: 1 }).forEach(function(visitor) {\n\t\t\tRocketChat.models.Users.update({ _id: visitor._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvisitorEmails: visitor.emails\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\temails: 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 73,\n\tup() {\n\t\tRocketChat.models.Users.find({ 'oauth.athorizedClients': { $exists: true } }, { oauth: 1 }).forEach(function(user) {\n\t\t\tRocketChat.models.Users.update({ _id: user._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\t'oauth.authorizedClients': user.oauth.athorizedClients\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\t'oauth.athorizedClients': 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 74,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_64'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_96'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_128'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_256'});\n\t\t\tRocketChat.models.Settings.update({_id: 'Assets_favicon_192'}, {\n\t\t\t\t$set: {\n\t\t\t\t\ti18nLabel: 'android-chrome 192x192 (png)'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71.1,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\nRocketChat.Migrations.add({\n\tversion: 75,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 76,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.find({section: 'Colors (alphas)'}).forEach((setting) => {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: setting._id });\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 77,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Rooms) {\n\t\t\tRocketChat.models.Rooms.find({\n\t\t\t\tt: 'l',\n\t\t\t\t'v._id': { $exists: true },\n\t\t\t\t'v.username': { $exists: false }\n\t\t\t}, { fields: { 'v._id': 1 } }).forEach(function(room) {\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ _id: room.v._id }, { username: 1 });\n\n\t\t\t\tif (user && user.username) {\n\t\t\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t\t\t_id: room._id\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t'v.username': user.username\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 78,\n\tup() {\n\t\tRocketChat.models.Permissions.update({ _id: { $in: ['create-c', 'create-d', 'create-p'] }}, { $addToSet: { roles: 'bot' }}, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 79,\n\tup() {\n\t\tconst integrations = RocketChat.models.Integrations.find({type: 'webhook-incoming'}).fetch();\n\n\t\tfor (const integration of integrations) {\n\t\t\tif (typeof integration.channel === 'string') {\n\t\t\t\tRocketChat.models.Integrations.update({_id: integration._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tchannel: integration.channel.split(',').map(channel => channel.trim())\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 80,\n\tup() {\n\t\tconst query = {\n\t\t\ttype: 'webhook-outgoing',\n\t\t\t$or: [{\n\t\t\t\tchannel: []\n\t\t\t}, {\n\t\t\t\tchannel: ''\n\t\t\t}, {\n\t\t\t\tchannel: {\n\t\t\t\t\t$exists: false\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tchannel: ['all_public_channels']\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update(query, update, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 81,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tactive: true,\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/App32270API/'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 82,\n\tup() {\n\t\tconst admins = RocketChat.authz.getUsersInRole('admin').fetch();\n\t\tif (admins.length === 1 && admins[0]._id === 'rocket.cat') {\n\t\t\tRocketChat.authz.removeUserFromRoles('rocket.cat', 'admin');\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 83,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings && RocketChat.models.Users) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'InternalHubot_Username' });\n\t\t\tif (setting && setting.value) {\n\t\t\t\tconst username = setting.value;\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ username });\n\t\t\t\tif (!user && setting.value === 'Rocket.Cat') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_Username' }, { $set: { value: 'rocket.cat', packageValue: 'rocket.cat' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 84,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Update permission name, copy values from old name\n\t\t\tconst oldPermission = RocketChat.models.Permissions.findOne('add-user-to-room');\n\t\t\tif (oldPermission && oldPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-joined-room' }, { $set: { roles: oldPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-room' });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission name, copy values from updated name\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('add-user-to-joined-room');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-room' }, { $set: { roles: newPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-joined-room' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 85,\n\tup() {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tusernames: {$size: 2},\n\t\t\tu: {$exists: false},\n\t\t\tname: {$exists: false}\n\t\t};\n\n\t\tconst rooms = RocketChat.models.Rooms.find(query).fetch();\n\n\t\tif (rooms.length > 0) {\n\t\t\tconst rids = rooms.map(room => room._id);\n\t\t\tRocketChat.models.Rooms.update({_id: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t\tRocketChat.models.Subscriptions.update({rid: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 86,\n\tup() {\n\t\t// Disabled this migration for it was not updating any user\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 87,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': false }, { $set: { 'settings.preferences.newMessageNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': true }, { $unset: { 'settings.preferences.newMessageNotification': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': false }, { $set: { 'settings.preferences.newRoomNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': true }, { $unset: { 'settings.preferences.newRoomNotification': 1 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 88,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\t\t\tif (setting && setting.value && setting.packageValue) {\n\t\t\t\tif (setting.value === '<img style=\"left: 10px; position: absolute;\" src=\"/assets/logo.png\" />') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: setting.packageValue } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 89,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { event: 'sendMessage', retryFailedCalls: true, retryCount: 6, retryDelay: 'powers-of-ten' }});\n\t\t});\n\t},\n\tdown() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: { $ne: 'sendMessage' }}, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { enabled: false }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 90,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Piwik', type: 'group' });\n\n\t\tconst settings = RocketChat.models.Settings.find({$or: [{_id: 'PiwikAnalytics_url', value: {$ne: null}}, {_id: 'PiwikAnalytics_siteId', value: {$ne: null}}]}).fetch();\n\n\t\tif (settings && settings.length === 2) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'PiwikAnalytics_enabled'}, {$set: {value: true}});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 91,\n\tup() {\n\t\tconst query = {\n\t\t\t'services.linkedin': {\n\t\t\t\t$exists: 1\n\t\t\t},\n\t\t\t$or: [{\n\t\t\t\tname: {\n\t\t\t\t\t$exists: 0\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tname: null\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'services.linkedin.firstName': 1, username: 1}).forEach((user) => {\n\t\t\tconst name = `${ user.services.linkedin.firstName } ${ user.services.linkedin.lastName }`;\n\n\t\t\tRocketChat.models.Users.setName(user._id, name);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 92,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', 'event': 'sendMessage' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { runOnEdits: true }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 93,\n\tup() {\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_AllowAnonymousAccess' });\n\t\t\tif (setting && setting.value === true) {\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Accounts_AllowAnonymousRead' }, { $set: { value: setting.value } });\n\t\t\t}\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: [\n\t\t\t\t\t'view-c-room',\n\t\t\t\t\t'view-history',\n\t\t\t\t\t'view-joined-room',\n\t\t\t\t\t'view-p-room',\n\t\t\t\t\t'preview-c-room'\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: 'anonymous'\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Permissions.update(query, update, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 94,\n\tup() {\n\t\tconst query = {\n\t\t\t'emails.address.address': { $exists: true }\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'emails.address.address': 1}).forEach((user) => {\n\t\t\tlet emailAddress;\n\t\t\tuser.emails.some(email => {\n\t\t\t\tif (email.address && email.address.address) {\n\t\t\t\t\temailAddress = email.address.address;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst existingUser = RocketChat.models.Users.findOne({ 'emails.address': emailAddress }, { fields: { _id: 1 } });\n\t\t\tif (existingUser) {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress\n\t\t\t\t}, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t'emails.$': 1\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'emails.$.address': emailAddress\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 95,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst emailHeader = RocketChat.models.Settings.findOne({ _id: 'Email_Header' });\n\t\t\tconst emailFooter = RocketChat.models.Settings.findOne({ _id: 'Email_Footer' });\n\t\t\tconst startWithHTML = emailHeader.value.match(/^<html>/);\n\t\t\tconst endsWithHTML = emailFooter.value.match(/<\\/html>$/);\n\n\t\t\tif (!startWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Header' },\n\t\t\t\t\t{ $set: { value: `<html>${ emailHeader.value }`} }\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!endsWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Footer' },\n\t\t\t\t\t{ $set: { value: `${ emailFooter.value }</html>`} }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 96,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_ScriptsToLoad' }, { $set: { value: '' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 97,\n\tup() {\n\t\t// Migration moved to 099.js to fix a bug\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 98,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/RocketChatDevAPI/'\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\n\nfunction log(...args) {\n\tconsole.log('[AVATAR]', ...args);\n}\n\nfunction logError(...args) {\n\tconsole.error('[AVATAR]', ...args);\n}\n\nfunction insertAvatar({ details, avatarsFileStore, stream, callback = () => {} }) {\n\treturn new Promise((resolve) => {\n\t\tMeteor.defer(() => {\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tavatarsFileStore.insert(details, stream, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tlogError({err});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction batch(arr, limit, fn) {\n\tif (!arr.length) {\n\t\treturn Promise.resolve();\n\t}\n\treturn Promise.all(arr.splice(0, limit).map((item) => {\n\t\treturn fn(item);\n\t})).then(() => { return batch(arr, limit, fn); });\n}\n\nRocketChat.Migrations.add({\n\tversion: 99,\n\tup() {\n\t\tlog('Migrating avatars. This might take a while.');\n\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\t's3.path': {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t'googleCloudStorage.path': {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Uploads.find(query).forEach((record) => {\n\t\t\tif (record.s3) {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({_id: record._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'store': 'AmazonS3:Uploads',\n\t\t\t\t\t\tAmazonS3: {\n\t\t\t\t\t\t\tpath: record.s3.path + record._id\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\ts3: 1\n\t\t\t\t\t}\n\t\t\t\t}, {multi: true});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({_id: record._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tstore: 'GoogleCloudStorage:Uploads',\n\t\t\t\t\t\tGoogleStorage: {\n\t\t\t\t\t\t\tpath: record.googleCloudStorage.path + record._id\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\tgoogleCloudStorage: 1\n\t\t\t\t\t}\n\t\t\t\t}, {multi: true});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'fileSystem'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'FileSystem:Uploads'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'rocketchat_uploads'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'GridFS:Uploads'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconst avatarOrigins = [\n\t\t\t'upload',\n\t\t\t'gravatar',\n\t\t\t'facebook',\n\t\t\t'twitter',\n\t\t\t'github',\n\t\t\t'google',\n\t\t\t'url',\n\t\t\t'gitlab',\n\t\t\t'linkedin'\n\t\t];\n\n\t\tconst avatarsPathRecord = RocketChat.models.Settings.findOne({_id: 'Accounts_AvatarStorePath'});\n\t\tconst avatarStoreTypeRecord = RocketChat.models.Settings.findOne({_id: 'Accounts_AvatarStoreType'});\n\n\t\tconst avatarsPath = avatarsPathRecord ? avatarsPathRecord.value : process.env.AVATARS_PATH;\n\t\tlet avatarStoreType = avatarStoreTypeRecord && avatarStoreTypeRecord.value;\n\n\t\tconst oldAvatarGridFS = new RocketChatFile.GridFS({\n\t\t\tname: 'avatars'\n\t\t});\n\n\t\tif (avatarStoreType == null) {\n\t\t\tconst count = oldAvatarGridFS.countSync();\n\t\t\tif (Match.test(count, Number) && count > 0) {\n\t\t\t\tavatarStoreType = 'GridFS';\n\t\t\t} else if (Match.test(avatarsPath, String) && avatarsPath.length > 0) {\n\t\t\t\tavatarStoreType = 'FileSystem';\n\t\t\t} else {\n\t\t\t\tSystemLogger.error_box('Can\\'t define the avatar\\'s storage type.\\nIf you have avatars missing and they was stored in your file system\\nrun the process including the following environment variables: \\n  AVATARS_PATH=\\'YOUR AVATAR\\'S DIRECTORY\\'\\n  MIGRATION_VERSION=99,rerun', 'WARNING');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tMeteor.startup(function() {\n\t\t\tMeteor.setTimeout(function() {\n\t\t\t\tconst avatarsFileStore = FileUpload.getStore('Avatars');\n\n\t\t\t\tconst users = RocketChat.models.Users.find({avatarOrigin: {$in: avatarOrigins}}, {avatarOrigin: 1, username: 1}).fetch();\n\n\t\t\t\tconst usersTotal = users.length;\n\n\t\t\t\tlog('Total users to migrate avatars ->', usersTotal);\n\n\t\t\t\tlet current = 0;\n\n\t\t\t\tbatch(users, 300, (user) => {\n\t\t\t\t\tconst id = `${ user.username }.jpg`;\n\n\t\t\t\t\tconst gridFSAvatar = oldAvatarGridFS.getFileWithReadStream(id);\n\n\t\t\t\t\tlog('Migrating', ++current, 'of', usersTotal);\n\n\t\t\t\t\tif (gridFSAvatar) {\n\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\ttype: gridFSAvatar.contentType,\n\t\t\t\t\t\t\tsize: gridFSAvatar.length\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\tstream: gridFSAvatar.readStream,\n\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\toldAvatarGridFS.deleteFile(id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (avatarStoreType === 'FileSystem' && avatarsPath && avatarsPath.trim()) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst filePath = path.join(avatarsPath, id);\n\t\t\t\t\t\t\tconst stat = fs.statSync(filePath);\n\t\t\t\t\t\t\tif (stat && stat.isFile()) {\n\t\t\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\t\t\ttype: 'image/jpeg',\n\t\t\t\t\t\t\t\t\tsize: stat.size\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\t\t\tstream: fs.createReadStream(filePath),\n\t\t\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\t\t\tfs.unlinkSync(filePath);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tlogError('Error migrating old avatar', e);\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tconst avatarsFiles = new Mongo.Collection('avatars.files');\n\t\t\t\t\tconst avatarsChunks = new Mongo.Collection('avatars.chunks');\n\t\t\t\t\tavatarsFiles.rawCollection().drop();\n\t\t\t\t\tavatarsChunks.rawCollection().drop();\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: 'Accounts_AvatarStoreType'});\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: 'Accounts_AvatarStorePath'});\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 100,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({audioNotification:{$exists:1}}, { $rename: { 'audioNotification': 'audioNotifications' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 101,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({lastActivity:{$exists:1}}, { $unset: { 'lastActivity': '' } }, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 102,\n\tup() {\n\t\tif (!RocketChat || !RocketChat.models || !RocketChat.models.Settings) {\n\t\t\treturn;\n\t\t}\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Connect_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Idle_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tconst LDAP_Domain_Base = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Base' });\n\t\tif (LDAP_Domain_Base) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_BaseDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Base.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Base' });\n\n\t\tconst LDAP_Domain_Search_User_ID = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User_ID' });\n\t\tif (LDAP_Domain_Search_User_ID) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Field' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User_ID.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User_ID' });\n\n\t\tconst LDAP_Use_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tconst LDAP_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Custom_Domain_Search' });\n\n\t\tconst LDAP_Domain_Search_User = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User' });\n\t\tconst LDAP_Domain_Search_Password = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Password' });\n\t\tconst LDAP_Domain_Search_Filter = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tconst LDAP_Domain_Search_Object_Class = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tconst LDAP_Domain_Search_Object_Category = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Category' });\n\n\t\tif (LDAP_Use_Custom_Domain_Search) {\n\t\t\tif (LDAP_Use_Custom_Domain_Search.value === true) {\n\t\t\t\tlet Custom_Domain_Search;\n\t\t\t\ttry {\n\t\t\t\t\tCustom_Domain_Search = JSON.parse(LDAP_Custom_Domain_Search.value);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new Error('Invalid Custom Domain Search JSON');\n\t\t\t\t}\n\n\t\t\t\tLDAP_Domain_Search_User.value = Custom_Domain_Search.userDN || '';\n\t\t\t\tLDAP_Domain_Search_Password.value = Custom_Domain_Search.password || '';\n\t\t\t\tLDAP_Domain_Search_Filter.value = Custom_Domain_Search.filter;\n\t\t\t} else {\n\t\t\t\tconst filter = [];\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Category.value !== '') {\n\t\t\t\t\tfilter.push(`(objectCategory=${ LDAP_Domain_Search_Object_Category.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Class.value !== '') {\n\t\t\t\t\tfilter.push(`(objectclass=${ LDAP_Domain_Search_Object_Class.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Filter.value !== '') {\n\t\t\t\t\tfilter.push(`(${ LDAP_Domain_Search_Filter.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (filter.length === 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = filter[0];\n\t\t\t\t} else if (filter.length > 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = `(&${ filter.join('') })`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (LDAP_Domain_Search_Filter && LDAP_Domain_Search_Filter.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Filter' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Filter.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_UserDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User' });\n\n\n\t\tif (LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_Password' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Password.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Password' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value && LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Category' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Sync_Users' }); //Button\n\n\t\tconst LDAP_Sync_User_Data = RocketChat.models.Settings.findOne({ _id: 'LDAP_Sync_User_Data' });\n\t\tif (LDAP_Sync_User_Data && LDAP_Sync_User_Data.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tconst LDAP_Import_Users = RocketChat.models.Settings.findOne({ _id: 'LDAP_Import_Users' });\n\t\tif (LDAP_Import_Users && LDAP_Import_Users.value === false) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync_Import_New_Users' },\n\t\t\t\t{ $set: { value: false } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Import_Users' });\n\t}\n});\n","const majorColors = {\n\t'content-background-color': '#FFFFFF',\n\t'primary-background-color': '#04436A',\n\t'primary-font-color': '#444444',\n\t'primary-action-color': '#13679A', // was action-buttons-color\n\t'secondary-background-color': '#F4F4F4',\n\t'secondary-font-color': '#A0A0A0',\n\t'secondary-action-color': '#DDDDDD',\n\t'component-color': '#EAEAEA',\n\t'success-color': '#4dff4d',\n\t'pending-color': '#FCB316',\n\t'error-color': '#BC2031',\n\t'selection-color': '#02ACEC',\n\t'attention-color': '#9C27B0'\n};\n\n// Minor colours implement major colours by default, but can be overruled\n// const minorColors = {\n// \t'tertiary-background-color': '@component-color',\n// \t'tertiary-font-color': '@transparent-lightest',\n// \t'link-font-color': '@primary-action-color',\n// \t'info-font-color': '@secondary-font-color',\n// \t'custom-scrollbar-color': '@transparent-darker',\n// \t'status-online': '@success-color',\n// \t'status-away': '@pending-color',\n// \t'status-busy': '@error-color',\n// \t'status-offline': '@transparent-darker'\n// };\n\nconst newvariables = {\n\t'content-background-color': 'rc-color-primary-lightest',\n\t'primary-background-color': 'rc-color-primary',\n\t'success-color': 'rc-color-success',\n\t'pending-color': 'rc-color-alert',\n\t'error-color': 'rc-color-error',\n\t'status-online': 'rc-color-success',\n\t'status-away': 'rc-color-alert',\n\t'status-busy': 'rc-color-error',\n\t'status-offline': 'rc-color-primary-darkest'\n};\n\nfunction lightenDarkenColor(col, amt) {\n\tlet usePound = false;\n\tif (col[0] === '#') {\n\t\tcol = col.slice(1);\n\t\tusePound = true;\n\t}\n\n\tconst num = parseInt(col, 16);\n\tlet r = (num >> 16) + amt;\n\n\tif (r > 255) { r = 255; } else if (r < 0) { r = 0; }\n\n\tlet b = ((num >> 8) & 0x00FF) + amt;\n\n\tif (b > 255) { b = 255; } else if (b < 0) { b = 0; }\n\n\tlet g = (num & 0x0000FF) + amt;\n\n\tif (g > 255) { g = 255; } else if (g < 0) { g = 0; }\n\n\treturn (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);\n}\n\nRocketChat.Migrations.add({\n\tversion: 103,\n\tup() {\n\t\tObject.keys(majorColors).forEach(function(_id) {\n\t\t\tconst color = RocketChat.models.Settings.findOne({_id: `theme-color-${ _id }`});\n\t\t\tconst key = newvariables[_id];\n\t\t\tif (color && color.value !== majorColors[_id] && key) {\n\t\t\t\tif (/^@.+/.test(color.value)) {\n\t\t\t\t\tcolor.value = newvariables[color.value.replace('@', '')];\n\t\t\t\t}\n\t\t\t\tconst id = `theme-color-${ key }`;\n\t\t\t\tRocketChat.models.Settings.update({_id: id}, {$set: { value : color.value, editor: /^#.+/.test(color.value) ? 'color' : 'expression' }});\n\t\t\t\tif (key === 'rc-color-primary') {\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-darkest'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, -16)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-dark'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 18)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 110)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light-medium'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 156)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-lightest'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 200)}});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n});\n","RocketChat.Migrations.add({\n\tversion: 104,\n\tup() {\n\t\tif ((RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary'}) || {}).value === '#04436A' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-darkest'}) || {}).value === '#335a' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-dark'}) || {}).value === '#16557c' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-light'}) || {}).value === '#72b1d8' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-light-medium'}) || {}).value === '#a0dfff' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-lightest'}) || {}).value === '#ccffff'\n\t\t) {\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary'}, {$set: {editor: 'expression', value: 'color-dark'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-darkest'}, {$set: {editor: 'expression', value: 'color-darkest'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-dark'}, {$set: {editor: 'expression', value: 'color-dark-medium'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light'}, {$set: {editor: 'expression', value: 'color-gray'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light-medium'}, {$set: {editor: 'expression', value: 'color-gray-medium'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-lightest'}, {$set: {editor: 'expression', value: 'color-gray-lightest'}});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 105,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.find({ 'settings.preferences.unreadRoomsMode': { $exists: 1 } }).forEach(function(user) {\n\t\t\t\t\tconst newPreference = user.settings.preferences.unreadRoomsMode ? 'unread' : 'category';\n\t\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.unreadRoomsMode': 1 }, $set: { 'settings.preferences.roomsListExhibitionMode': newPreference } });\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst settingsMap = {\n\t\t\t\t\t'Desktop_Notifications_Default_Alert': 'Accounts_Default_User_Preferences_desktopNotifications',\n\t\t\t\t\t'Mobile_Notifications_Default_Alert': 'Accounts_Default_User_Preferences_mobileNotifications',\n\t\t\t\t\t'Audio_Notifications_Default_Alert': 'Accounts_Default_User_Preferences_audioNotifications',\n\t\t\t\t\t'Desktop_Notifications_Duration': 'Accounts_Default_User_Preferences_desktopNotificationDuration',\n\t\t\t\t\t'Audio_Notifications_Value': undefined\n\t\t\t\t};\n\t\t\t\tRocketChat.models.Settings.find({ _id: { $in: Object.keys(settingsMap) }}).forEach(oldSetting => {\n\t\t\t\t\tconst newSettingKey = settingsMap[oldSetting._id];\n\t\t\t\t\tconst newSetting = newSettingKey && RocketChat.models.Settings.findOne({ _id: newSettingKey });\n\n\t\t\t\t\tif (newSetting && newSetting.value !== oldSetting.value) {\n\t\t\t\t\t\tRocketChat.models.Settings.update({ _id: newSettingKey }, {\t$set: {\tvalue: oldSetting.value\t}\t});\n\t\t\t\t\t}\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: oldSetting._id });\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","import LivechatVisitors from 'meteor/rocketchat:livechat/server/models/LivechatVisitors';\n\nRocketChat.Migrations.add({\n\tversion: 106,\n\tup() {\n\t\tconst visitors = Meteor.users.find({ type: 'visitor' });\n\t\tconst total = visitors.count();\n\t\tlet current = 1;\n\n\t\tconsole.log('Migrating livechat visitors, this may take a while ...');\n\n\t\tMeteor.setTimeout(() => {\n\t\t\tvisitors.forEach(user => {\n\t\t\t\tconsole.log(`Migrating visitor ${ current++ }/${ total }`);\n\n\t\t\t\tconst {\n\t\t\t\t\t_id,\n\t\t\t\t\tname,\n\t\t\t\t\tusername,\n\t\t\t\t\tdeparment,\n\t\t\t\t\tuserAgent,\n\t\t\t\t\tip,\n\t\t\t\t\thost,\n\t\t\t\t\tvisitorEmails,\n\t\t\t\t\tphone\n\t\t\t\t} = user;\n\t\t\t\tLivechatVisitors.insert({\n\t\t\t\t\t_id,\n\t\t\t\t\tname,\n\t\t\t\t\tusername,\n\t\t\t\t\tdeparment,\n\t\t\t\t\tuserAgent,\n\t\t\t\t\tip,\n\t\t\t\t\thost,\n\t\t\t\t\tvisitorEmails,\n\t\t\t\t\tphone,\n\t\t\t\t\ttoken: user.profile.token\n\t\t\t\t});\n\n\t\t\t\tMeteor.users.remove({ _id });\n\t\t\t});\n\n\t\t\tconsole.log('Livechat visitors migration finished.');\n\t\t}, 1000);\n\t}\n});\n","\n\nRocketChat.Migrations.add({\n\tversion: 107,\n\tup() {\n\n\n\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'activity'\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'activity',\n\t\t\t\t'preferences.sidebarShowFavorites': true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'unread'\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'preferences.sidebarShowUnread' : true,\n\t\t\t\t'preferences.sidebarShowFavorites': true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'category'\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'preferences.sidebarShowFavorites': true\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 108,\n\tup() {\n\t\tconst roles = RocketChat.models.Roles.find({\n\t\t\t_id: { $ne: 'guest' },\n\t\t\tscope: 'Users'\n\t\t}).fetch().map((role)=>{ return role._id; });\n\t\tRocketChat.models.Permissions.createOrUpdate('leave-c', roles);\n\t\tRocketChat.models.Permissions.createOrUpdate('leave-d', roles);\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 109,\n\tup() {\n\t\tconst FileUpload_GoogleStorage_Proxy = (RocketChat.models.Settings.findOne({_id: 'FileUpload_GoogleStorage_Proxy'}) || {}).value === true;\n\t\tconst FileUpload_S3_Proxy = (RocketChat.models.Settings.findOne({_id: 'FileUpload_S3_Proxy'}) || {}).value === true;\n\n\t\tRocketChat.models.Settings.update({_id: 'FileUpload_GoogleStorage_Proxy_Avatars'}, {$set: {value: FileUpload_GoogleStorage_Proxy}});\n\t\tRocketChat.models.Settings.update({_id: 'FileUpload_GoogleStorage_Proxy_Uploads'}, {$set: {value: FileUpload_GoogleStorage_Proxy}});\n\n\t\tRocketChat.models.Settings.update({_id: 'FileUpload_S3_Proxy_Avatars'}, {$set: {value: FileUpload_S3_Proxy}});\n\t\tRocketChat.models.Settings.update({_id: 'FileUpload_S3_Proxy_Uploads'}, {$set: {value: FileUpload_S3_Proxy}});\n\n\t\tRocketChat.models.Settings.remove({_id: 'FileUpload_GoogleStorage_Proxy'});\n\t\tRocketChat.models.Settings.remove({_id: 'FileUpload_S3_Proxy'});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 110,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_viewMode' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_messageViewMode' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.remove(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_viewMode' }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t{ 'settings.preferences.viewMode': { $exists: 1 } },\n\t\t\t\t\t{ $rename: { 'settings.preferences.viewMode': 'user.settings.preferences.messageViewMode' } },\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t},\n\tdown() {\n\t\tif (RocketChat && RocketChat.models) {\n\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_messageViewMode' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_viewMode' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.remove(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_messageViewMode' }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t{ 'settings.preferences.messageViewMode': { $exists: 1 } },\n\t\t\t\t\t{ $rename: { 'settings.preferences.messageViewMode': 'user.settings.preferences.viewMode' } },\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n});\n","// Migration to give delete channel, delete group permissions to owner\nRocketChat.Migrations.add({\n\tversion: 111,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'delete-c' }, { $addToSet: { roles: 'owner' } });\n\t\t\tRocketChat.models.Permissions.update({ _id: 'delete-p' }, { $addToSet: { roles: 'owner' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 112,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_idleTimeoutLimit' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_idleTimeoutLimit' },\n\t\t\t\t\t\t{ $set: { value: setting.value / 1000 } }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.find({ 'settings.preferences.idleTimeLimit': { $exists: 1 } }).forEach(function(user) {\n\t\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t\t{ _id: user._id },\n\t\t\t\t\t\t{ $set: { 'settings.preferences.idleTimeLimit': user.settings.preferences.idleTimeLimit / 1000 } }\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 113,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Uploads && RocketChat.models.Messages) {\n\t\t\tconst fileQuery = {\n\t\t\t\tuserId: null\n\t\t\t};\n\n\t\t\tconst filesToUpdate = RocketChat.models.Uploads.find(fileQuery);\n\t\t\tfilesToUpdate.forEach((file) => {\n\t\t\t\tconst messageQuery = {\n\t\t\t\t\t'file._id' : file._id\n\t\t\t\t};\n\t\t\t\tconst message = RocketChat.models.Messages.findOne(messageQuery);\n\t\t\t\tif (message) {\n\t\t\t\t\tconst filter = {\n\t\t\t\t\t\t_id: file._id\n\t\t\t\t\t};\n\n\t\t\t\t\tconst update = {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tuserId: message.u._id\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tRocketChat.models.Uploads.model.direct.update(filter, update);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 114,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Message_GlobalSearch' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.upsert(\n\t\t\t\t\t\t{ _id: 'Search.defaultProvider.GlobalSearchEnabled' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.removeById('Message_GlobalSearch');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 115,\n\tup() {\n\t\tRocketChat.models.Rooms.update({\n\t\t\t'announcement.message': { $exists: true }\n\t\t}, {\n\t\t\t$unset: { announcement: 1 }\n\t\t}, { multi: true });\n\t}\n});\n","import _ from 'underscore';\n\nif (RocketChat.Migrations.getVersion() !== 0) {\n\tRocketChat.Migrations.migrateTo(process.env.MIGRATION_VERSION || 'latest');\n} else {\n\tconst control = RocketChat.Migrations._getControl();\n\tcontrol.version = _.last(RocketChat.Migrations._list).version;\n\tRocketChat.Migrations._setControl(control);\n}\n","if (Meteor.AppCache) {\n\tMeteor.AppCache.config({\n\t\tonlineOnly: ['/elements/', '/landing/', '/moment-locales/', '/scripts/']\n\t});\n}\n","/* globals FileUpload */\nimport _ from 'underscore';\nimport sharp from 'sharp';\n\nMeteor.startup(function() {\n\tWebApp.connectHandlers.use('/avatar/', Meteor.bindEnvironment(function(req, res/*, next*/) {\n\t\tconst params = {\n\t\t\tusername: decodeURIComponent(req.url.replace(/^\\//, '').replace(/\\?.*$/, ''))\n\t\t};\n\n\t\tif (_.isEmpty(params.username)) {\n\t\t\tres.writeHead(403);\n\t\t\tres.write('Forbidden');\n\t\t\tres.end();\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = /^\\/([^?]*)/.exec(req.url);\n\n\t\tif (match[1]) {\n\t\t\tlet username = decodeURIComponent(match[1]);\n\t\t\tlet file;\n\n\t\t\tusername = username.replace(/\\.jpg$/, '');\n\n\t\t\tif (username[0] !== '@') {\n\t\t\t\tif (Meteor.settings && Meteor.settings.public && Meteor.settings.public.sandstorm) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username);\n\t\t\t\t\tif (user && user.services && user.services.sandstorm && user.services.sandstorm.picture) {\n\t\t\t\t\t\tres.setHeader('Location', user.services.sandstorm.picture);\n\t\t\t\t\t\tres.writeHead(302);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfile = RocketChat.models.Avatars.findOneByName(username);\n\t\t\t}\n\n\t\t\tif (file) {\n\t\t\t\tres.setHeader('Content-Security-Policy', 'default-src \\'none\\'');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\t\t\t\tif (reqModifiedHeader && reqModifiedHeader === (file.uploadedAt && file.uploadedAt.toUTCString())) {\n\t\t\t\t\tres.setHeader('Last-Modified', reqModifiedHeader);\n\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\tres.end();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tres.setHeader('Cache-Control', 'public, max-age=0');\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Content-Disposition', 'inline');\n\t\t\t\tres.setHeader('Last-Modified', file.uploadedAt.toUTCString());\n\t\t\t\tres.setHeader('Content-Type', file.type);\n\t\t\t\tres.setHeader('Content-Length', file.size);\n\n\t\t\t\treturn FileUpload.get(file, req, res);\n\t\t\t} else {\n\t\t\t\tres.setHeader('Content-Type', 'image/svg+xml');\n\t\t\t\tres.setHeader('Cache-Control', 'public, max-age=0');\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\n\t\t\t\tif (reqModifiedHeader) {\n\t\t\t\t\tif (reqModifiedHeader === 'Thu, 01 Jan 2015 00:00:00 GMT') {\n\t\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (RocketChat.settings.get('UI_Use_Name_Avatar')) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username, {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tname: 1\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (user && user.name) {\n\t\t\t\t\t\tusername = user.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet color = '';\n\t\t\t\tlet initials = '';\n\n\t\t\t\tif (username === '?') {\n\t\t\t\t\tcolor = '#000';\n\t\t\t\t\tinitials = username;\n\t\t\t\t} else {\n\t\t\t\t\tcolor = RocketChat.getAvatarColor(username);\n\n\t\t\t\t\tinitials = username.replace(/[^A-Za-z0-9]/g, '').substr(0, 1).toUpperCase();\n\t\t\t\t}\n\n\t\t\t\tconst viewSize = parseInt(req.query.size) || 200;\n\t\t\t\tconst fontSize = viewSize / 1.6;\n\n\t\t\t\tconst svg = `<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 ${ viewSize } ${ viewSize }\\\">\\n<rect width=\\\"100%\\\" height=\\\"100%\\\" fill=\\\"${ color }\\\"/>\\n<text x=\\\"50%\\\" y=\\\"50%\\\" dy=\\\"0.36em\\\" text-anchor=\\\"middle\\\" pointer-events=\\\"none\\\" fill=\\\"#ffffff\\\" font-family=\\\"Helvetica, Arial, Lucida Grande, sans-serif\\\" font-size=\"${ fontSize }\">\\n${ initials }\\n</text>\\n</svg>`;\n\n\t\t\t\tif (['png', 'jpg', 'jpeg'].includes(req.query.format)) {\n\t\t\t\t\tres.setHeader('Content-Type', `image/${ req.query.format }`);\n\t\t\t\t\tsharp(new Buffer(svg))\n\t\t\t\t\t\t.toFormat(req.query.format)\n\t\t\t\t\t\t.pipe(res);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tres.write(svg);\n\t\t\t\tres.end();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}));\n});\n","/* global SyncedCron */\n\nconst logger = new Logger('SyncedCron');\n\nSyncedCron.config({\n\tlogger(opts) {\n\t\treturn logger[opts.level].call(logger, opts.message);\n\t},\n\tcollectionName: 'rocketchat_cron_history'\n});\n\nfunction generateStatistics() {\n\tconst statistics = RocketChat.statistics.save();\n\n\tstatistics.host = Meteor.absoluteUrl();\n\n\tif (RocketChat.settings.get('Statistics_reporting')) {\n\t\ttry {\n\t\t\tHTTP.post('https://collector.rocket.chat/', {\n\t\t\t\tdata: statistics\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t/*error*/\n\t\t\tlogger.warn('Failed to send usage report');\n\t\t}\n\t}\n}\n\nfunction cleanupOEmbedCache() {\n\treturn Meteor.call('OEmbedCacheCleanup');\n}\n\nMeteor.startup(function() {\n\treturn Meteor.defer(function() {\n\t\tgenerateStatistics();\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Generate and save statistics',\n\t\t\tschedule(parser) {\n\t\t\t\treturn parser.cron(`${ new Date().getMinutes() } * * * *`);\n\t\t\t},\n\t\t\tjob: generateStatistics\n\t\t});\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Cleanup OEmbed cache',\n\t\t\tschedule(parser) {\n\t\t\t\tconst now = new Date();\n\t\t\t\treturn parser.cron(`${ now.getMinutes() } ${ now.getHours() } * * *`);\n\t\t\t},\n\t\t\tjob: cleanupOEmbedCache\n\t\t});\n\n\t\treturn SyncedCron.start();\n\t});\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nfunction flat(obj, newObj = {}, path = '') {\n\tfor (const key of Object.keys(obj)) {\n\t\tconst value = obj[key];\n\n\t\tif (_.isObject(value)) {\n\t\t\tflat(value, newObj, `${ key }.`);\n\t\t} else {\n\t\t\tnewObj[path + key] = value;\n\t\t}\n\t}\n\n\treturn newObj;\n}\n\nRocketChat.i18nValidation = function i18nValidation() {\n\tconst l = {};\n\tconst keys = {};\n\tconst errors = [];\n\tconst langs = Object.keys(TAPi18next.options.resStore);\n\n\tfor (const lang of Object.keys(TAPi18next.options.resStore)) {\n\t\tconst value = TAPi18next.options.resStore[lang];\n\n\t\tl[lang] = flat(value);\n\n\t\tfor (const key of Object.keys(l[lang])) {\n\t\t\tif (keys[key] == null) {\n\t\t\t\tkeys[key] = [];\n\t\t\t}\n\t\t\tkeys[key].push(lang);\n\t\t}\n\t}\n\n\tlet len = 0;\n\tfor (const key of Object.keys(keys)) {\n\t\tconst present = keys[key];\n\n\t\tif (!(present.length !== langs.length)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst error = (`${ _.difference(langs, present).join(',') }: missing translation for `).red + key.white + (`. Present in [${ present.join(',') }]`).red;\n\n\t\terrors.push(error);\n\n\t\tif (error.length > len) {\n\t\t\tlen = error.length;\n\t\t}\n\t}\n\n\tif (errors.length > 0) {\n\t\tconsole.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\n\t\tfor (const error of errors) {\n\t\t\tconsole.log('|'.red, s.rpad(`${ error }`, len).red, '|'.red);\n\t\t}\n\n\t\treturn console.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\t}\n};\n\n// Meteor.startup(function() {\n// \tRocketChat.i18nValidation();\n// });\n","import _ from 'underscore';\n\nMeteor.startup(function() {\n\tMeteor.defer(function() {\n\t\tif (!RocketChat.models.Rooms.findOneById('GENERAL')) {\n\t\t\tRocketChat.models.Rooms.createWithIdTypeAndName('GENERAL', 'c', 'general', {\n\t\t\t\t'default': true\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.models.Users.db.findOneById('rocket.cat')) {\n\t\t\tRocketChat.models.Users.create({\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tname: 'Rocket.Cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t\tstatus: 'online',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'bot'\n\t\t\t});\n\n\t\t\tRocketChat.authz.addUserRoles('rocket.cat', 'bot');\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(Assets.getBinary('avatars/rocketcat.png'), 'utf8'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName('rocket.cat');\n\n\t\t\tconst file = {\n\t\t\t\tuserId: 'rocket.cat',\n\t\t\t\ttype: 'image/png'\n\t\t\t};\n\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tfileStore.insert(file, rs, () => {\n\t\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin('rocket.cat', 'local');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (process.env.ADMIN_PASS) {\n\t\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\t\tconsole.log('Inserting admin user:'.green);\n\t\t\t\tconst adminUser = {\n\t\t\t\t\tname: 'Administrator',\n\t\t\t\t\tusername: 'admin',\n\t\t\t\t\tstatus: 'offline',\n\t\t\t\t\tstatusDefault: 'online',\n\t\t\t\t\tutcOffset: 0,\n\t\t\t\t\tactive: true\n\t\t\t\t};\n\n\t\t\t\tif (process.env.ADMIN_NAME) {\n\t\t\t\t\tadminUser.name = process.env.ADMIN_NAME;\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\n\t\t\t\tif (process.env.ADMIN_EMAIL) {\n\t\t\t\t\tconst re = /^[^@].*@[^@]+$/i;\n\n\t\t\t\t\tif (re.test(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\tif (!RocketChat.models.Users.findOneByEmailAddress(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\t\tadminUser.emails = [{\n\t\t\t\t\t\t\t\taddress: process.env.ADMIN_EMAIL,\n\t\t\t\t\t\t\t\tverified: true\n\t\t\t\t\t\t\t}];\n\n\t\t\t\t\t\t\tconsole.log((`Email: ${ process.env.ADMIN_EMAIL }`).green);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Email provided already exists; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Email provided is invalid; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (process.env.ADMIN_USERNAME) {\n\t\t\t\t\tlet nameValidation;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nameValidation.test(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\tif (RocketChat.checkUsernameAvailability(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\t\tadminUser.username = process.env.ADMIN_USERNAME;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Username provided already exists; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Username provided is invalid; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\n\t\t\t\tadminUser.type = 'user';\n\n\t\t\t\tconst id = RocketChat.models.Users.create(adminUser);\n\n\t\t\t\tAccounts.setPassword(id, process.env.ADMIN_PASS);\n\n\t\t\t\tconsole.log((`Password: ${ process.env.ADMIN_PASS }`).green);\n\n\t\t\t\tRocketChat.authz.addUserRoles(id, 'admin');\n\t\t\t} else {\n\t\t\t\tconsole.log('Users with admin role already exist; Ignoring environment variables ADMIN_PASS'.red);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof process.env.INITIAL_USER === 'string' && process.env.INITIAL_USER.length > 0) {\n\t\t\ttry {\n\t\t\t\tconst initialUser = JSON.parse(process.env.INITIAL_USER);\n\n\t\t\t\tif (!initialUser._id) {\n\t\t\t\t\tconsole.log('No _id provided; Ignoring environment variable INITIAL_USER'.red);\n\t\t\t\t} else if (!RocketChat.models.Users.findOneById(initialUser._id)) {\n\t\t\t\t\tconsole.log('Inserting initial user:'.green);\n\t\t\t\t\tconsole.log(JSON.stringify(initialUser, null, 2).green);\n\t\t\t\t\tRocketChat.models.Users.create(initialUser);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('Error processing environment variable INITIAL_USER'.red, e);\n\t\t\t}\n\t\t}\n\n\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: 'rocket.cat'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tRocketChat.authz.addUserRoles(oldestUser._id, 'admin');\n\t\t\t\tconsole.log(`No admins are found. Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Users.removeById('rocketchat.internal.admin.test');\n\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\tconsole.log('Inserting admin test user:'.green);\n\n\t\t\tconst adminUser = {\n\t\t\t\t_id: 'rocketchat.internal.admin.test',\n\t\t\t\tname: 'RocketChat Internal Admin Test',\n\t\t\t\tusername: 'rocketchat.internal.admin.test',\n\t\t\t\temails: [\n\t\t\t\t\t{\n\t\t\t\t\t\taddress: 'rocketchat.internal.admin.test@rocket.chat',\n\t\t\t\t\t\tverified: true\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tstatus: 'offline',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'user'\n\t\t\t};\n\n\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\t\t\tconsole.log((`Email: ${ adminUser.emails[0].address }`).green);\n\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\t\t\tconsole.log((`Password: ${ adminUser._id }`).green);\n\n\t\t\tif (RocketChat.models.Users.db.findOneByEmailAddress(adminUser.emails[0].address)) {\n\t\t\t\tthrow new Meteor.Error(`Email ${ adminUser.emails[0].address } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tif (!RocketChat.checkUsernameAvailability(adminUser.username)) {\n\t\t\t\tthrow new Meteor.Error(`Username ${ adminUser.username } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.create(adminUser);\n\n\t\t\tAccounts.setPassword(adminUser._id, adminUser._id);\n\n\t\t\tRocketChat.authz.addUserRoles(adminUser._id, 'admin');\n\n\t\t\treturn RocketChat.addUserToDefaultChannels(adminUser, true);\n\t\t}\n\t});\n});\n","/* globals InstanceStatus, UserPresence, UserPresenceMonitor */\n\nMeteor.startup(function() {\n\tconst instance = {\n\t\thost: 'localhost',\n\t\tport: String(process.env.PORT).trim()\n\t};\n\n\tif (process.env.INSTANCE_IP) {\n\t\tinstance.host = String(process.env.INSTANCE_IP).trim();\n\t}\n\n\tInstanceStatus.registerInstance('rocket.chat', instance);\n\n\tUserPresence.start();\n\n\treturn UserPresenceMonitor.start();\n});\n","Meteor.startup(function() {\n\tRocketChat.roomTypes.setPublish('c', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tannouncement: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1,\n\t\t\t\tjoinCodeRequired: 1,\n\t\t\t\tstreamingOptions: 1\n\t\t\t}\n\t\t};\n\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeAndName('c', identifier, options);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'view-joined-room')) {\n\t\t\tconst roomId = RocketChat.models.Subscriptions.findByTypeNameAndUserId('c', identifier, this.userId).fetch();\n\t\t\tif (roomId.length > 0) {\n\t\t\t\treturn RocketChat.models.Rooms.findById(roomId[0].rid, options);\n\t\t\t}\n\t\t}\n\n\t\treturn this.ready();\n\t});\n\n\tRocketChat.roomTypes.setPublish('p', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tannouncement: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1,\n\t\t\t\ttokenpass: 1,\n\t\t\t\tstreamingOptions: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', identifier, user.username, options);\n\t});\n\n\treturn RocketChat.roomTypes.setPublish('d', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tjitsiTimeout: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\tif (RocketChat.authz.hasAtLeastOnePermission(this.userId, ['view-d-room', 'view-joined-room'])) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeContainingUsernames('d', [user.username, identifier], options);\n\t\t}\n\n\t\treturn this.ready();\n\t});\n});\n","/* globals MongoInternals, SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\n\nMeteor.startup(function() {\n\tlet oplogState = 'Disabled';\n\tif (MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry) {\n\t\toplogState = 'Enabled';\n\t\tif (RocketChat.settings.get('Force_Disable_OpLog_For_Cache') === true) {\n\t\t\toplogState += ' (Disabled for Cache Sync)';\n\t\t}\n\t}\n\n\tconst desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n\tconst desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n\n\treturn Meteor.setTimeout(function() {\n\t\tlet msg = [\n\t\t\t`Rocket.Chat Version: ${ RocketChat.Info.version }`,\n\t\t\t`     NodeJS Version: ${ process.versions.node } - ${ process.arch }`,\n\t\t\t`           Platform: ${ process.platform }`,\n\t\t\t`       Process Port: ${ process.env.PORT }`,\n\t\t\t`           Site URL: ${ RocketChat.settings.get('Site_Url') }`,\n\t\t\t`   ReplicaSet OpLog: ${ oplogState }`\n\t\t];\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.hash) {\n\t\t\tmsg.push(`        Commit Hash: ${ RocketChat.Info.commit.hash.substr(0, 10) }`);\n\t\t}\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.branch) {\n\t\t\tmsg.push(`      Commit Branch: ${ RocketChat.Info.commit.branch }`);\n\t\t}\n\n\t\tmsg = msg.join('\\n');\n\n\t\tif (semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n\t\t\treturn SystemLogger.startup_box(msg, 'SERVER RUNNING');\n\t\t}\n\n\t\tmsg += ['', '', 'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,', `PLEASE UPGRADE / DOWNGRADE TO VERSION ${ desiredNodeVersionMajor }.X.X`].join('\\n');\n\n\t\tSystemLogger.error_box(msg, 'SERVER ERROR');\n\n\t\treturn process.exit();\n\t}, 100);\n});\n","import _ from 'underscore';\n\nconst orig_updateOrCreateUserFromExternalService = Accounts.updateOrCreateUserFromExternalService;\n\nAccounts.updateOrCreateUserFromExternalService = function(serviceName, serviceData = {} /*, options*/) {\n\tconst services = [\n\t\t'facebook',\n\t\t'github',\n\t\t'gitlab',\n\t\t'google',\n\t\t'meteor-developer',\n\t\t'linkedin',\n\t\t'twitter',\n\t\t'sandstorm'\n\t];\n\n\tif (services.includes(serviceName) === false && serviceData._OAuthCustom !== true) {\n\t\treturn;\n\t}\n\n\tif (serviceName === 'meteor-developer') {\n\t\tif (Array.isArray(serviceData.emails)) {\n\t\t\tconst primaryEmail = serviceData.emails.sort(a => a.primary !== true).filter(item => item.verified === true)[0];\n\t\t\tserviceData.email = primaryEmail && primaryEmail.address;\n\t\t}\n\t}\n\n\tif (serviceName === 'linkedin') {\n\t\tserviceData.email = serviceData.emailAddress;\n\t}\n\n\tif (serviceData.email) {\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(serviceData.email);\n\t\tif (user != null) {\n\t\t\tconst findQuery = {\n\t\t\t\taddress: serviceData.email,\n\t\t\t\tverified: true\n\t\t\t};\n\n\t\t\tif (!_.findWhere(user.emails, findQuery)) {\n\t\t\t\tRocketChat.models.Users.resetPasswordAndSetRequirePasswordChange(user._id, true, 'This_email_has_already_been_used_and_has_not_been_verified__Please_change_your_password');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.setServiceId(user._id, serviceName, serviceData.id);\n\t\t\tRocketChat.models.Users.setEmailVerified(user._id, serviceData.email);\n\t\t}\n\t}\n\n\treturn orig_updateOrCreateUserFromExternalService.apply(this, arguments);\n};\n","import { Settings } from 'meteor/rocketchat:grant';\n\nSettings.add({\n\tenabled: true,\n\tprovider: 'github',\n\tkey: '96db2753350cfe8c8ae1',\n\tsecret: '546317a561df5e3d350fca9b5500f270b54f3301'\n});\n\nSettings.add({\n\tenabled: true,\n\tprovider: 'facebook',\n\tkey: '494859557516801',\n\tsecret: '5274d3495cebaf01f7e1b90fe1331fba'\n});\n\nSettings.add({\n\tenabled: true,\n\tprovider: 'google',\n\tkey: '979285364697-pob8soqche90ng1af0pj9if6ed69jalh.apps.googleusercontent.com',\n\tsecret: 'lFWtrtJngtlNBdrAoevwPjZh'\n});\n\nSettings.apps.add('pwa', {\n\tredirectUrl: 'http://localhost:4200/login?service={provider}&access_token={accessToken}&refresh_token={refreshToken}',\n\terrorUrl: 'http://localhost:4200/login?service={provider}&error={error}'\n});\n","Meteor.methods({\n\tOEmbedCacheCleanup() {\n\t\tif (Meteor.userId() && !RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'OEmbedCacheCleanup'\n\t\t\t});\n\t\t}\n\n\t\tconst date = new Date();\n\t\tconst expirationDays = RocketChat.settings.get('API_EmbedCacheExpirationDays');\n\t\tdate.setDate(date.getDate() - expirationDays);\n\t\tRocketChat.models.OEmbedCache.removeAfterDate(date);\n\t\treturn {\n\t\t\tmessage: 'cache_cleared'\n\t\t};\n\t}\n});\n","Meteor.methods({\n\taddAllUserToRoom(rid, activeUsersOnly = false) {\n\n\t\tcheck (rid, String);\n\t\tcheck (activeUsersOnly, Boolean);\n\n\t\tif (RocketChat.authz.hasRole(this.userId, 'admin') === true) {\n\t\t\tconst userCount = RocketChat.models.Users.find().count();\n\t\t\tif (userCount > RocketChat.settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\t\tif (room == null) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userFilter = {};\n\t\t\tif (activeUsersOnly === true) {\n\t\t\t\tuserFilter.active = true;\n\t\t\t}\n\n\t\t\tconst users = RocketChat.models.Users.find(userFilter).fetch();\n\t\t\tconst now = new Date();\n\t\t\tusers.forEach(function(user) {\n\t\t\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\t\t\t\tif (subscription != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t\t\t\tRocketChat.models.Rooms.addUsernameById(rid, user.username);\n\t\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t\topen: true,\n\t\t\t\t\talert: true,\n\t\t\t\t\tunread: 1,\n\t\t\t\t\tuserMentions: 1,\n\t\t\t\t\tgroupMentions: 0\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, {\n\t\t\t\t\tts: now\n\t\t\t\t});\n\t\t\t\tMeteor.defer(function() {});\n\t\t\t\treturn RocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthrow (new Meteor.Error(403, 'Access to Method Forbidden', {\n\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t}));\n\t\t}\n\t}\n});\n","Meteor.methods({\n\taddRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-leader', 'User is already a leader', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'leader'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('moderator') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-moderator', 'User is already a moderator', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: fromUser.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('owner') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-owner', 'User is already an owner', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tafterVerifyEmail() {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'afterVerifyEmail'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tconst verifiedEmail = _.find(user.emails, (email) => email.verified);\n\n\t\tif (verifiedEmail) {\n\t\t\tRocketChat.models.Roles.addUserRoles(user._id, 'user');\n\t\t\tRocketChat.models.Roles.removeUserRoles(user._id, 'anonymous');\n\t\t}\n\t}\n});\n","import s from 'underscore.string';\n\nconst sortChannels = function(field, direction) {\n\tswitch (field) {\n\t\tcase 'createdAt':\n\t\t\treturn {\n\t\t\t\tts: direction === 'asc' ? 1 : -1\n\t\t\t};\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t[field]: direction === 'asc' ? 1 : -1\n\t\t\t};\n\t}\n};\n\nconst sortUsers = function(field, direction) {\n\tswitch (field) {\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t[field]: direction === 'asc' ? 1 : -1\n\t\t\t};\n\t}\n};\n\n\nMeteor.methods({\n\tbrowseChannels({text='', type = 'channels', sortBy = 'name', sortDirection = 'asc', page = 0, limit = 10}) {\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\n\t\tif (!['channels', 'users'].includes(type)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!['asc', 'desc'].includes(sortDirection)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!['name', 'createdAt', ...type === 'channels'? ['usernames'] : [], ...type === 'users' ? ['username'] : []].includes(sortBy)) {\n\t\t\treturn;\n\t\t}\n\n\t\tpage = page > -1 ? page : 0;\n\n\t\tlimit = limit > 0 ? limit : 10;\n\n\t\tconst options = {\n\t\t\tskip: limit * page,\n\t\t\tlimit\n\t\t};\n\n\t\tconst user = Meteor.user();\n\t\tif (type === 'channels') {\n\n\t\t\tconst sort = sortChannels(sortBy, sortDirection);\n\t\t\tif (!RocketChat.authz.hasPermission(user._id, 'view-c-room')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn RocketChat.models.Rooms.findByNameAndType(regex, 'c', {\n\t\t\t\t...options,\n\t\t\t\tsort,\n\t\t\t\tfields: {\n\t\t\t\t\tdescription: 1,\n\t\t\t\t\tname: 1,\n\t\t\t\t\tts: 1,\n\t\t\t\t\tarchived: 1,\n\t\t\t\t\tusernames: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t}\n\n\t\t// type === users\n\t\tif (!RocketChat.authz.hasPermission(user._id, 'view-outside-room') || !RocketChat.authz.hasPermission(user._id, 'view-d-room')) {\n\t\t\treturn;\n\t\t}\n\t\tconst sort = sortUsers(sortBy, sortDirection);\n\t\treturn RocketChat.models.Users.findByActiveUsersExcept(text, [user.username], {\n\t\t\t...options,\n\t\t\tsort,\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1,\n\t\t\t\tcreatedAt: 1,\n\t\t\t\temails: 1\n\t\t\t}\n\t\t}).fetch();\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'browseChannels',\n\tuserId(/*userId*/) {\n\t\treturn true;\n\t}\n}, 100, 100000);\n","Meteor.methods({\n\tcanAccessRoom(rid, userId, extraData) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, Match.Maybe(String));\n\n\t\tlet user;\n\n\t\tif (userId) {\n\t\t\tuser = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!user || !user.username) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!rid) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tif (room) {\n\t\t\tif (RocketChat.authz.canAccessRoom.call(this, room, user, extraData)) {\n\t\t\t\tif (user) {\n\t\t\t\t\troom.username = user.username;\n\t\t\t\t}\n\t\t\t\treturn room;\n\t\t\t}\n\n\t\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nMeteor.methods({\n\tchannelsList(filter, channelType, limit, sort) {\n\t\tthis.unblock();\n\n\t\tcheck(filter, String);\n\t\tcheck(channelType, String);\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'channelsList'\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tmsgs: -1\n\t\t\t}\n\t\t};\n\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\tif (s.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tname: 1\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1\n\t\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst roomTypes = [];\n\n\t\tif (channelType !== 'private') {\n\t\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room')) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c'\n\t\t\t\t});\n\t\t\t} else if (RocketChat.authz.hasPermission(Meteor.userId(), 'view-joined-room')) {\n\t\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', Meteor.userId()).fetch(), 'rid');\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c',\n\t\t\t\t\tids: roomIds\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (channelType !== 'public' && RocketChat.authz.hasPermission(Meteor.userId(), 'view-p-room')) {\n\t\t\tconst user = Meteor.user();\n\t\t\tconst userPref = RocketChat.getUserPreference(user, 'mergeChannels') && RocketChat.getUserPreference(user, 'roomsListExhibitionMode') === 'category';\n\t\t\tconst globalPref = RocketChat.settings.get('UI_Merge_Channels_Groups');\n\t\t\tconst mergeChannels = userPref !== undefined ? userPref : globalPref;\n\n\t\t\tif (mergeChannels) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'p',\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (roomTypes.length) {\n\t\t\tif (filter) {\n\t\t\t\treturn {\n\t\t\t\t\tchannels: RocketChat.models.Rooms.findByNameContainingTypesWithUsername(filter, roomTypes, options).fetch()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tchannels: RocketChat.models.Rooms.findContainingTypesWithUsername(roomTypes, options).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tchannels: []\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tcreateDirectMessage(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst me = Meteor.user();\n\n\t\tif (!me.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.settings.get('Message_AllowDirectMessagesToYourself') === false && me.username === username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-d')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst to = RocketChat.models.Users.findOneByUsername(username);\n\n\t\tif (!to) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst rid = [me._id, to._id].sort().join('');\n\n\t\tconst now = new Date();\n\n\t\t// Make sure we have a room\n\t\tRocketChat.models.Rooms.upsert({\n\t\t\t_id: rid\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tusernames: [me.username, to.username]\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tt: 'd',\n\t\t\t\tmsgs: 0,\n\t\t\t\tts: now\n\t\t\t}\n\t\t});\n\n\t\t// Make user I have a subcription to this room\n\t\tconst upsertSubscription = {\n\t\t\t$set: {\n\t\t\t\tts: now,\n\t\t\t\tls: now,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tname: to.username,\n\t\t\t\tt: 'd',\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tcustomFields: me.customFields,\n\t\t\t\tu: {\n\t\t\t\t\t_id: me._id,\n\t\t\t\t\tusername: me.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (to.active === false) {\n\t\t\tupsertSubscription.$set.archived = true;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': me._id}] // work around to solve problems with upsert and dot\n\t\t}, upsertSubscription);\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': to._id}] // work around to solve problems with upsert and dot\n\t\t}, {\n\t\t\t$setOnInsert: {\n\t\t\t\tname: me.username,\n\t\t\t\tt: 'd',\n\t\t\t\topen: false,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tcustomFields: to.customFields,\n\t\t\t\tu: {\n\t\t\t\t\t_id: to._id,\n\t\t\t\t\tusername: to.username\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\trid\n\t\t};\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('createDirectMessage', 10, 60000, {\n\tuserId(userId) {\n\t\treturn !RocketChat.authz.hasPermission(userId, 'send-many-messages');\n\t}\n});\n","/* global FileUpload */\nMeteor.methods({\n\tdeleteFileMessage(fileID) {\n\t\tcheck(fileID, String);\n\n\t\tconst msg = RocketChat.models.Messages.getMessageByFileId(fileID);\n\n\t\tif (msg) {\n\t\t\treturn Meteor.call('deleteMessage', msg);\n\t\t}\n\n\t\treturn FileUpload.getStore('Uploads').deleteById(fileID);\n\t}\n});\n","Meteor.methods({\n\tdeleteUser(userId) {\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'delete-user') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst adminCount = Meteor.users.find({roles: 'admin'}).count();\n\n\t\tconst userIsAdmin = user.roles.indexOf('admin') > -1;\n\n\t\tif (adminCount === 1 && userIsAdmin) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Leaving the app without admins is not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t\taction: 'Remove_last_admin'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.deleteUser(userId);\n\n\t\treturn true;\n\t}\n});\n","/* globals RocketChat */\n\nMeteor.methods({\n\teraseRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.roomTypes.roomTypes[room.t].canBeDeleted(room)) {\n\t\t\tRocketChat.models.Messages.removeByRoomId(rid);\n\t\t\tRocketChat.models.Subscriptions.removeByRoomId(rid);\n\t\t\treturn RocketChat.models.Rooms.removeById(rid);\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","/* global Gravatar */\n\nfunction getAvatarSuggestionForUser(user) {\n\tcheck(user, Object);\n\n\tconst avatars = [];\n\n\tif (user.services.facebook && user.services.facebook.id && RocketChat.settings.get('Accounts_OAuth_Facebook')) {\n\t\tavatars.push({\n\t\t\tservice: 'facebook',\n\t\t\turl: `https://graph.facebook.com/${ user.services.facebook.id }/picture?type=large`\n\t\t});\n\t}\n\n\tif (user.services.google && user.services.google.picture && user.services.google.picture !== 'https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg' && RocketChat.settings.get('Accounts_OAuth_Google')) {\n\t\tavatars.push({\n\t\t\tservice: 'google',\n\t\t\turl: user.services.google.picture\n\t\t});\n\t}\n\n\tif (user.services.github && user.services.github.username && RocketChat.settings.get('Accounts_OAuth_Github')) {\n\t\tavatars.push({\n\t\t\tservice: 'github',\n\t\t\turl: `https://avatars.githubusercontent.com/${ user.services.github.username }?s=200`\n\t\t});\n\t}\n\n\tif (user.services.linkedin && user.services.linkedin.pictureUrl && RocketChat.settings.get('Accounts_OAuth_Linkedin')) {\n\t\tavatars.push({\n\t\t\tservice: 'linkedin',\n\t\t\turl: user.services.linkedin.pictureUrl\n\t\t});\n\t}\n\n\tif (user.services.twitter && user.services.twitter.profile_image_url_https && RocketChat.settings.get('Accounts_OAuth_Twitter')) {\n\t\tavatars.push({\n\t\t\tservice: 'twitter',\n\t\t\turl: user.services.twitter.profile_image_url_https.replace(/_normal|_bigger/, '')\n\t\t});\n\t}\n\n\tif (user.services.gitlab && user.services.gitlab.avatar_url && RocketChat.settings.get('Accounts_OAuth_Gitlab')) {\n\t\tavatars.push({\n\t\t\tservice: 'gitlab',\n\t\t\turl: user.services.gitlab.avatar_url\n\t\t});\n\t}\n\n\tif (user.services.sandstorm && user.services.sandstorm.picture && Meteor.settings['public'].sandstorm) {\n\t\tavatars.push({\n\t\t\tservice: 'sandstorm',\n\t\t\turl: user.services.sandstorm.picture\n\t\t});\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.verified === true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (email.verified !== true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tconst validAvatars = {};\n\tfor (const avatar of avatars) {\n\t\ttry {\n\t\t\tconst result = HTTP.get(avatar.url, {\n\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\tencoding: 'binary'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (result.statusCode === 200) {\n\t\t\t\tlet blob = `data:${ result.headers['content-type'] };base64,`;\n\t\t\t\tblob += Buffer.from(result.content, 'binary').toString('base64');\n\t\t\t\tavatar.blob = blob;\n\t\t\t\tavatar.contentType = result.headers['content-type'];\n\t\t\t\tvalidAvatars[avatar.service] = avatar;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// error;\n\t\t}\n\t}\n\treturn validAvatars;\n}\n\nthis.getAvatarSuggestionForUser = getAvatarSuggestionForUser;\n\nMeteor.methods({\n\tgetAvatarSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getAvatarSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst user = Meteor.user();\n\n\t\treturn getAvatarSuggestionForUser(user);\n\t}\n});\n","Meteor.methods({\n\tgetRoomIdByNameOrId(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid) || RocketChat.models.Rooms.findOneByName(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tif (user && user.username && room.usernames.indexOf(user.username) !== -1) {\n\t\t\treturn room._id;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\treturn room._id;\n\t}\n});\n","Meteor.methods({\n\tgetRoomNameById(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tif (user && user.username && room.usernames.indexOf(user.username) !== -1) {\n\t\t\treturn room.name;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\treturn room.name;\n\t}\n});\n","Meteor.methods({\n\tgetTotalChannels() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getTotalChannels'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\tt: 'c'\n\t\t};\n\t\treturn RocketChat.models.Rooms.find(query).count();\n\t}\n});\n","/* global slugify */\nimport _ from 'underscore';\n\nfunction slug(text) {\n\ttext = slugify(text, '.');\n\treturn text.replace(/[^0-9a-z-_.]/g, '');\n}\n\nfunction usernameIsAvaliable(username) {\n\tif (username.length < 1) {\n\t\treturn false;\n\t}\n\n\tif (username === 'all') {\n\t\treturn false;\n\t}\n\n\treturn !RocketChat.models.Users.findOneByUsername(username);\n}\n\nfunction generateSuggestion(user) {\n\tlet usernames = [];\n\tlet username = undefined;\n\n\tif (Meteor.settings['public'].sandstorm) {\n\t\tusernames.push(user.services.sandstorm.preferredHandle);\n\t}\n\n\tif (Match.test(user && user.name, String)) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.name));\n\t\t} else {\n\t\t\tusernames.push(user.name);\n\t\t}\n\n\t\tconst nameParts = user.name.split(' ');\n\n\t\tif (nameParts.length > 1) {\n\t\t\tconst first = nameParts[0];\n\t\t\tconst last = nameParts[nameParts.length - 1];\n\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(first[0] + last));\n\t\t\t\tusernames.push(slug(first + last[0]));\n\t\t\t} else {\n\t\t\t\tusernames.push(first[0] + last);\n\t\t\t\tusernames.push(first + last[0]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.profile && user.profile.name) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.profile.name));\n\t\t} else {\n\t\t\tusernames.push(user.profile.name);\n\t\t}\n\t}\n\n\tif (Array.isArray(user.services)) {\n\t\tlet services = user.services.map((service) => {\n\t\t\treturn _.values(_.pick(service, 'name', 'username', 'firstName', 'lastName'));\n\t\t});\n\n\t\tservices = _.uniq(_.flatten(services));\n\n\t\tfor (const service of services) {\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(service));\n\t\t\t} else {\n\t\t\t\tusernames.push(service);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.address && email.verified === true) {\n\t\t\t\tusernames.push(slug(email.address.replace(/@.+$/, '')));\n\t\t\t\tusernames.push(slug(email.address.replace(/(.+)@(\\w+).+/, '$1.$2')));\n\t\t\t}\n\t\t}\n\t}\n\n\tusernames = _.compact(usernames);\n\n\tfor (const item of usernames) {\n\t\tif (usernameIsAvaliable(item)) {\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tif (usernames.length === 0 || usernames[0].length === 0) {\n\t\tusernames.push(RocketChat.settings.get('Accounts_DefaultUsernamePrefixSuggestion'));\n\t}\n\n\tlet index = 0;\n\twhile (!username) {\n\t\tindex++;\n\t\tif (usernameIsAvaliable(`${ usernames[0] }-${ index }`)) {\n\t\t\tusername = `${ usernames[0] }-${ index }`;\n\t\t}\n\t}\n\n\tif (usernameIsAvaliable(username)) {\n\t\treturn username;\n\t}\n}\n\nRocketChat.generateUsernameSuggestion = generateSuggestion;\n\nMeteor.methods({\n\tgetUsernameSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getUsernameSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn generateSuggestion(user);\n\t}\n});\n","Meteor.methods({\n\tgetUsersOfRoom(roomId, showAll) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', roomId, Meteor.userId());\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst filter = (record) => {\n\t\t\tif (!record._user) {\n\t\t\t\tconsole.log('Subscription without user', record._id);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (showAll === true) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn record._user.status !== 'offline';\n\t\t};\n\n\t\tconst map = (record) => {\n\t\t\treturn {\n\t\t\t\t_id: record._user._id,\n\t\t\t\tusername: record._user.username,\n\t\t\t\tname: record._user.name\n\t\t\t};\n\t\t};\n\n\t\tconst records = RocketChat.models.Subscriptions.findByRoomId(roomId).fetch();\n\n\t\treturn {\n\t\t\ttotal: records.length,\n\t\t\trecords: records.filter(filter).map(map)\n\t\t};\n\t}\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nMeteor.methods({\n\tgroupsList(nameFilter, limit, sort) {\n\n\t\tcheck(nameFilter, Match.Optional(String));\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'groupsList' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: { name: 1 },\n\t\t\tsort: { name: 1 }\n\t\t};\n\n\t\t//Verify the limit param is a number\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\t//Verify there is a sort option and it's a string\n\t\tif (s.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = { name: 1 };\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = { msgs: -1 };\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//Determine if they are searching or not, base it upon the name field\n\t\tif (nameFilter) {\n\t\t\treturn { groups: RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', new RegExp(s.trim(s.escapeRegExp(nameFilter)), 'i'), Meteor.user().username, options).fetch() };\n\t\t} else {\n\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', Meteor.userId()).fetch(), 'rid');\n\t\t\treturn { groups: RocketChat.models.Rooms.findByIds(roomIds, options).fetch() };\n\t\t}\n\t}\n});\n","Meteor.methods({\n\thideRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'hideRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.hideByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","/* globals RocketChat */\n\nMeteor.methods({\n\tignoreUser({rid, userId: ignoredUser, ignore = true}) {\n\t\tcheck(ignoredUser, String);\n\t\tcheck(rid, String);\n\t\tcheck(ignore, Boolean);\n\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'ignoreUser'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'ignoreUser' });\n\t\t}\n\n\t\tconst subscriptionIgnoredUser = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, ignoredUser);\n\n\t\tif (!subscriptionIgnoredUser) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'ignoreUser' });\n\t\t}\n\n\t\treturn !!RocketChat.models.Subscriptions.ignoreUser({_id: subscription._id, ignoredUser, ignore});\n\t}\n});\n","const hideMessagesOfType = [];\n\nRocketChat.settings.get(/Message_HideType_.+/, function(key, value) {\n\tconst type = key.replace('Message_HideType_', '');\n\tconst types = type === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [type];\n\n\treturn types.forEach((type) => {\n\t\tconst index = hideMessagesOfType.indexOf(type);\n\n\t\tif (value === true && index === -1) {\n\t\t\treturn hideMessagesOfType.push(type);\n\t\t}\n\n\t\tif (index > -1) {\n\t\t\treturn hideMessagesOfType.splice(index, 1);\n\t\t}\n\t});\n});\n\nMeteor.methods({\n\tloadHistory(rid, end, limit = 20, ls) {\n\t\tthis.unblock();\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadHistory'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canAnonymous = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst canPreview = RocketChat.authz.hasPermission(fromId, 'preview-c-room');\n\t\tif (room.t === 'c' && !canAnonymous && !canPreview && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn RocketChat.loadMessageHistory({ userId: fromId, rid, end, limit, ls });\n\t}\n});\n","Meteor.methods({\n\tloadLocale(locale) {\n\t\tcheck(locale, String);\n\n\t\ttry {\n\t\t\treturn Assets.getText(`moment-locales/${ locale.toLowerCase() }.js`);\n\t\t} catch (error) {\n\t\t\ttry {\n\t\t\t\treturn Assets.getText(`moment-locales/${ locale.split('-').shift().toLowerCase() }.js`);\n\t\t\t} catch (error) {\n\t\t\t\treturn console.log(error);\n\t\t\t}\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tloadMissedMessages(rid, start) {\n\t\tcheck(rid, String);\n\t\tcheck(start, Date);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadMissedMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\t'editedAt': 0\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, start, options).fetch();\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tloadNextMessages(rid, end, limit = 20) {\n\t\tcheck(rid, String);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadNextMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: 1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, end, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomId(rid, options).fetch();\n\t\t}\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\treturn {\n\t\t\tmessages\n\t\t};\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tloadSurroundingMessages(message, limit = 50) {\n\t\tcheck(message, Object);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadSurroundingMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!message._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!message || !message.rid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', message.rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlimit = limit - 1;\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: Math.ceil(limit / 2)\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tconst recordsBefore = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(message.rid, message.ts, options).fetch();\n\n\t\tconst messages = recordsBefore.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreBefore = messages.length === options.limit;\n\n\t\tmessages.push(message);\n\n\t\toptions.sort = {\n\t\t\tts: 1\n\t\t};\n\n\t\toptions.limit = Math.floor(limit / 2);\n\n\t\tconst recordsAfter = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(message.rid, message.ts, options).fetch();\n\t\tconst afterMessages = recordsAfter.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreAfter = afterMessages.length === options.limit;\n\n\t\treturn {\n\t\t\tmessages: messages.concat(afterMessages),\n\t\t\tmoreBefore,\n\t\t\tmoreAfter\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tlogoutCleanUp(user) {\n\t\tcheck(user, Object);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLogoutCleanUp', user);\n\t\t});\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tmessageSearch(text, rid, limit) {\n\t\tcheck(text, String);\n\t\tcheck(rid, Match.Maybe(String));\n\t\tcheck(limit, Match.Optional(Number));\n\n\t\t// TODO: Evaluate why we are returning `users` and `channels`, as the only thing that gets set is the `messages`.\n\t\tconst result = {\n\t\t\tmessage: {\n\t\t\t\tdocs:[]\n\t\t\t}\n\t\t};\n\n\t\tconst currentUserId = Meteor.userId();\n\t\tif (!currentUserId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messageSearch'\n\t\t\t});\n\t\t}\n\n\t\t// Don't process anything else if the user can't access the room\n\t\tif (rid) {\n\t\t\tif (!Meteor.call('canAccessRoom', rid, currentUserId)) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t} else if (RocketChat.settings.get('Search.defaultProvider.GlobalSearchEnabled') !== true) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tconst currentUserName = user.username;\n\t\tconst currentUserTimezoneOffset = user.utcOffset;\n\n\t\tconst query = {};\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: limit || 20\n\t\t};\n\n\t\t// I would place these methods at the bottom of the file for clarity but travis doesn't appreciate that.\n\t\t// (no-use-before-define)\n\n\t\tfunction filterStarred() {\n\t\t\tquery['starred._id'] = currentUserId;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterUrl() {\n\t\t\tquery['urls.0'] = {\n\t\t\t\t$exists: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterPinned() {\n\t\t\tquery.pinned = true;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLocation() {\n\t\t\tquery.location = {\n\t\t\t\t$exist: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterBeforeDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst beforeDate = new Date(year, month, day);\n\t\t\tbeforeDate.setHours(beforeDate.getUTCHours() + beforeDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tquery.ts = {\n\t\t\t\t$lte: beforeDate\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterAfterDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tday++;\n\t\t\tconst afterDate = new Date(year, month, day);\n\t\t\tafterDate.setUTCHours(afterDate.getUTCHours() + afterDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tif (query.ts) {\n\t\t\t\tquery.ts.$gte = afterDate;\n\t\t\t} else {\n\t\t\t\tquery.ts = {\n\t\t\t\t\t$gte: afterDate\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterOnDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst date = new Date(year, month, day);\n\t\t\tdate.setUTCHours(date.getUTCHours() + date.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tconst dayAfter = new Date(date);\n\t\t\tdayAfter.setDate(dayAfter.getDate() + 1);\n\t\t\tdelete query.ts;\n\t\t\tquery.ts = {\n\t\t\t\t$gte: date,\n\t\t\t\t$lt: dayAfter\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLabel(_, tag) {\n\t\t\tquery['attachments.0.labels'] = new RegExp(s.escapeRegExp(tag), 'i');\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction sortByTimestamp(_, direction) {\n\t\t\tif (direction.startsWith('asc')) {\n\t\t\t\toptions.sort.ts = 1;\n\t\t\t} else if (direction.startsWith('desc')) {\n\t\t\t\toptions.sort.ts = -1;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\t/*\n\t\t text = 'from:rodrigo mention:gabriel chat'\n\t\t */\n\n\t\t// Query for senders\n\t\tconst from = [];\n\t\ttext = text.replace(/from:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tif (username === 'me' && !from.includes(currentUserName)) {\n\t\t\t\tusername = currentUserName;\n\t\t\t}\n\t\t\tfrom.push(username);\n\t\t\treturn '';\n\t\t});\n\n\t\tif (from.length > 0) {\n\t\t\tquery['u.username'] = {\n\t\t\t\t$regex: from.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\n\t\t// Query for senders\n\t\tconst mention = [];\n\t\ttext = text.replace(/mention:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tmention.push(username);\n\t\t\treturn '';\n\t\t});\n\n\t\tif (mention.length > 0) {\n\t\t\tquery['mentions.username'] = {\n\t\t\t\t$regex: mention.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\n\t\t// Filter on messages that are starred by the current user.\n\t\ttext = text.replace(/has:star/g, filterStarred);\n\t\t// Filter on messages that have an url.\n\t\ttext = text.replace(/has:url|has:link/g, filterUrl);\n\t\t// Filter on pinned messages.\n\t\ttext = text.replace(/is:pinned|has:pin/g, filterPinned);\n\t\t// Filter on messages which have a location attached.\n\t\ttext = text.replace(/has:location|has:map/g, filterLocation);\n\t\t// Filter image tags\n\t\ttext = text.replace(/label:(\\w+)/g, filterLabel);\n\t\t// Filtering before/after/on a date\n\t\t// matches dd-MM-yyyy, dd/MM/yyyy, dd-MM-yyyy, prefixed by before:, after: and on: respectively.\n\t\t// Example: before:15/09/2016 after: 10-08-2016\n\t\t// if \"on:\" is set, \"before:\" and \"after:\" are ignored.\n\t\ttext = text.replace(/before:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterBeforeDate);\n\t\ttext = text.replace(/after:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterAfterDate);\n\t\ttext = text.replace(/on:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterOnDate);\n\t\t// Sort order\n\t\ttext = text.replace(/(?:order|sort):(asc|ascend|ascending|desc|descend|descending)/g, sortByTimestamp);\n\n\t\t// Query in message text\n\t\ttext = text.trim().replace(/\\s\\s/g, ' ');\n\t\tif (text !== '') {\n\t\t\tif (/^\\/.+\\/[imxs]*$/.test(text)) {\n\t\t\t\tconst r = text.split('/');\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: r[1],\n\t\t\t\t\t$options: r[2]\n\t\t\t\t};\n\t\t\t} else if (RocketChat.settings.get('Message_AlwaysSearchRegExp')) {\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: text,\n\t\t\t\t\t$options: 'i'\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tquery.$text = {\n\t\t\t\t\t$search: text\n\t\t\t\t};\n\t\t\t\toptions.fields = {\n\t\t\t\t\tscore: {\n\t\t\t\t\t\t$meta: 'textScore'\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(query).length > 0) {\n\t\t\tquery.t = {\n\t\t\t\t$ne: 'rm' //hide removed messages (useful when searching for user messages)\n\t\t\t};\n\t\t\tquery._hidden = {\n\t\t\t\t$ne: true // don't return _hidden messages\n\t\t\t};\n\n\t\t\tif (rid) {\n\t\t\t\tquery.rid = rid;\n\t\t\t} else {\n\t\t\t\tquery.rid = {\n\t\t\t\t\t$in: RocketChat.models.Subscriptions.findByUserId(user._id)\n\t\t\t\t\t\t.fetch()\n\t\t\t\t\t\t.map(subscription => subscription.rid)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\t\toptions.fields = {\n\t\t\t\t\t'editedAt': 0\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tresult.message.docs = RocketChat.models.Messages.find(query, options).fetch();\n\t\t}\n\n\t\treturn result;\n\t}\n});\n","Meteor.methods({\n\tmigrateTo(version) {\n\t\tcheck(version, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!user || RocketChat.authz.hasPermission(user._id, 'run-migration') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tRocketChat.Migrations.migrateTo(version);\n\n\t\treturn version;\n\t},\n\n\tgetMigrationVersion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getMigrationVersion'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.Migrations.getVersion();\n\t}\n});\n","Meteor.methods({\n\tmuteUserInRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst mutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.muteUsernameByRoomId(data.rid, mutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserMutedWithRoomIdAndUser(data.rid, mutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\topenRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'openRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.openByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","import { ReadReceipt } from '../../imports/message-read-receipt/server/lib/ReadReceipt';\n\nMeteor.methods({\n\treadMessages(rid) {\n\t\tcheck(rid, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'readMessages'\n\t\t\t});\n\t\t}\n\n\t\t// this prevents cache from updating object reference/pointer\n\t\tconst userSubscription = Object.assign({}, RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId));\n\n\t\tRocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(rid, userId);\n\n\t\tMeteor.defer(() => {\n\t\t\tReadReceipt.markMessagesAsRead(rid, userId, userSubscription.ls);\n\t\t});\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tregisterUser(formData) {\n\t\tconst AllowAnonymousRead = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst AllowAnonymousWrite = RocketChat.settings.get('Accounts_AllowAnonymousWrite');\n\t\tconst manuallyApproveNewUsers = RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\t\tif (AllowAnonymousRead === true && AllowAnonymousWrite === true && formData.email == null) {\n\t\t\tconst userId = Accounts.insertUserDoc({}, {\n\t\t\t\tglobalRoles: [\n\t\t\t\t\t'anonymous'\n\t\t\t\t]\n\t\t\t});\n\n\t\t\tconst { id, token } = Accounts._loginUser(this, userId);\n\n\t\t\treturn { id, token };\n\t\t} else {\n\t\t\tcheck(formData, Match.ObjectIncluding({\n\t\t\t\temail: String,\n\t\t\t\tpass: String,\n\t\t\t\tname: String,\n\t\t\t\tsecretURL: Match.Optional(String),\n\t\t\t\treason: Match.Optional(String)\n\t\t\t}));\n\t\t}\n\n\t\tif (RocketChat.settings.get('Accounts_RegistrationForm') === 'Disabled') {\n\t\t\tthrow new Meteor.Error('error-user-registration-disabled', 'User registration is disabled', { method: 'registerUser' });\n\t\t} else if (RocketChat.settings.get('Accounts_RegistrationForm') === 'Secret URL' && (!formData.secretURL || formData.secretURL !== RocketChat.settings.get('Accounts_RegistrationForm_SecretURL'))) {\n\t\t\tthrow new Meteor.Error ('error-user-registration-secret', 'User registration is only allowed via Secret URL', { method: 'registerUser' });\n\t\t}\n\n\t\tRocketChat.validateEmailDomain(formData.email);\n\n\t\tconst userData = {\n\t\t\temail: s.trim(formData.email.toLowerCase()),\n\t\t\tpassword: formData.pass,\n\t\t\tname: formData.name,\n\t\t\treason: formData.reason\n\t\t};\n\n\t\t// Check if user has already been imported and never logged in. If so, set password and let it through\n\t\tconst importedUser = RocketChat.models.Users.findOneByEmailAddress(s.trim(formData.email.toLowerCase()));\n\t\tlet userId;\n\t\tif (importedUser && importedUser.importIds && importedUser.importIds.length && !importedUser.lastLogin) {\n\t\t\tAccounts.setPassword(importedUser._id, userData.password);\n\t\t\tuserId = importedUser._id;\n\t\t} else {\n\t\t\tuserId = Accounts.createUser(userData);\n\t\t}\n\n\t\tRocketChat.models.Users.setName(userId, s.trim(formData.name));\n\n\t\tconst reason = s.trim(formData.reason);\n\t\tif (manuallyApproveNewUsers && reason) {\n\t\t\tRocketChat.models.Users.setReason(userId, reason);\n\t\t}\n\n\t\tRocketChat.saveCustomFields(userId, formData);\n\n\t\ttry {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = () => subject;\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = (userModel, url) => html.replace(/\\[Verification_Url]/g, url);\n\t\t\t}\n\n\t\t\tAccounts.sendVerificationEmail(userId, userData.email);\n\t\t} catch (error) {\n\t\t\t// throw new Meteor.Error 'error-email-send-failed', 'Error trying to send email: ' + error.message, { method: 'registerUser', message: error.message }\n\t\t}\n\n\t\treturn userId;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-leader', 'User is not a leader', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'leader'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('moderator') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-moderator', 'User is not a moderator', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('owner') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-owner', 'User is not an owner', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', rid).count();\n\n\t\tif (numOwners === 1) {\n\t\t\tthrow new Meteor.Error('error-remove-last-owner', 'This is the last owner. Please set a new owner before removing this one.', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveUserFromRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'remove-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room || room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst removedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tif (RocketChat.authz.hasRole(removedUser._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', {\n\t\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Rooms.removeUsernameById(data.rid, data.username);\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(data.rid, removedUser._id);\n\n\t\tif (['c', 'p'].includes(room.t) === true) {\n\t\t\tRocketChat.authz.removeUserFromRoles(removedUser._id, ['moderator', 'owner'], data.rid);\n\t\t}\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserRemovedWithRoomIdAndUser(data.rid, removedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\treportMessage(messageId, description) {\n\t\tcheck(messageId, String);\n\t\tcheck(description, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tif ((description == null) || description.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-description', 'Invalid description', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message_id', 'Invalid message id', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Reports.createWithMessageDescriptionAndUserId(message, description, Meteor.userId());\n\t}\n});\n","import fs from 'fs';\nimport path from 'path';\n\nlet tempFolder = '/tmp/userData';\nif (RocketChat.settings.get('UserData_FileSystemPath') != null) {\n\tif (RocketChat.settings.get('UserData_FileSystemPath').trim() !== '') {\n\t\ttempFolder = RocketChat.settings.get('UserData_FileSystemPath');\n\t}\n}\n\nMeteor.methods({\n\trequestDataDownload({fullExport = false}) {\n\t\tconst currentUserData = Meteor.user();\n\t\tconst userId = currentUserData._id;\n\n\t\tconst lastOperation = RocketChat.models.ExportOperations.findLastOperationByUser(userId, fullExport);\n\n\t\tif (lastOperation) {\n\t\t\tconst yesterday = new Date();\n\t\t\tyesterday.setUTCDate(yesterday.getUTCDate() - 1);\n\n\t\t\tif (lastOperation.createdAt > yesterday) {\n\t\t\t\treturn {\n\t\t\t\t\trequested: false,\n\t\t\t\t\texportOperation: lastOperation\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst subFolderName = fullExport ? 'full' : 'partial';\n\t\tconst baseFolder = path.join(tempFolder, userId);\n\t\tif (!fs.existsSync(baseFolder)) {\n\t\t\tfs.mkdirSync(baseFolder);\n\t\t}\n\n\t\tconst folderName = path.join(baseFolder, subFolderName);\n\t\tif (!fs.existsSync(folderName)) {\n\t\t\tfs.mkdirSync(folderName);\n\t\t}\n\t\tconst assetsFolder = path.join(folderName, 'assets');\n\t\tif (!fs.existsSync(assetsFolder)) {\n\t\t\tfs.mkdirSync(assetsFolder);\n\t\t}\n\n\t\tconst exportOperation = {\n\t\t\tuserId : currentUserData._id,\n\t\t\troomList: null,\n\t\t\tstatus: 'pending',\n\t\t\texportPath: folderName,\n\t\t\tassetsPath: assetsFolder,\n\t\t\tfileList: [],\n\t\t\tgeneratedFile: null,\n\t\t\tfullExport\n\t\t};\n\n\t\tRocketChat.models.ExportOperations.create(exportOperation);\n\n\t\treturn {\n\t\t\trequested: true,\n\t\t\texportOperation\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tresetAvatar() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tFileUpload.getStore('Avatars').deleteByName(user.username);\n\t\tRocketChat.models.Users.unsetAvatarOrigin(user._id);\n\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {\n\t\t\tusername: user.username\n\t\t});\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'resetAvatar',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.methods({\n\troomNameExists(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'roomExists'\n\t\t\t});\n\t\t}\n\t\tconst room = RocketChat.models.Rooms.findOneByName(rid);\n\t\treturn !!room;\n\t}\n});\n","Meteor.methods({\n\tsaveUserPreferences(settings) {\n\t\tconst keys = {\n\t\t\tlanguage: Match.Optional(String),\n\t\t\tnewRoomNotification: Match.Optional(String),\n\t\t\tnewMessageNotification: Match.Optional(String),\n\t\t\tuseEmojis: Match.Optional(Boolean),\n\t\t\tconvertAsciiEmoji: Match.Optional(Boolean),\n\t\t\tsaveMobileBandwidth: Match.Optional(Boolean),\n\t\t\tcollapseMediaByDefault: Match.Optional(Boolean),\n\t\t\tautoImageLoad: Match.Optional(Boolean),\n\t\t\temailNotificationMode: Match.Optional(String),\n\t\t\troomsListExhibitionMode: Match.Optional(String),\n\t\t\tunreadAlert: Match.Optional(Boolean),\n\t\t\tnotificationsSoundVolume: Match.Optional(Number),\n\t\t\tdesktopNotifications: Match.Optional(String),\n\t\t\tmobileNotifications: Match.Optional(String),\n\t\t\tenableAutoAway: Match.Optional(Boolean),\n\t\t\thighlights: Match.Optional([String]),\n\t\t\tdesktopNotificationDuration: Match.Optional(Number),\n\t\t\tmessageViewMode: Match.Optional(Number),\n\t\t\thideUsernames: Match.Optional(Boolean),\n\t\t\thideRoles: Match.Optional(Boolean),\n\t\t\thideAvatars: Match.Optional(Boolean),\n\t\t\thideFlexTab: Match.Optional(Boolean),\n\t\t\tsendOnEnter: Match.Optional(String),\n\t\t\troomCounterSidebar: Match.Optional(Boolean),\n\t\t\tidleTimeLimit: Match.Optional(Number),\n\t\t\tsidebarShowFavorites: Match.Optional(Boolean),\n\t\t\tsidebarShowUnread: Match.Optional(Boolean),\n\t\t\tsidebarSortby: Match.Optional(String),\n\t\t\tsidebarViewMode: Match.Optional(String),\n\t\t\tsidebarHideAvatar: Match.Optional(Boolean),\n\t\t\tmuteFocusedConversations: Match.Optional(Boolean)\n\t\t};\n\t\tcheck(settings, Match.ObjectIncluding(keys));\n\t\tif (settings.mergeChannels) {\n\t\t\tcheck(settings, Match.ObjectIncluding({\n\t\t\t\tmergeChannels: Match.OneOf(Number, Boolean) //eslint-disable-line new-cap\n\t\t\t}));\n\t\t}\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (user.settings == null) {\n\t\t\tRocketChat.models.Users.clearSettings(user._id);\n\t\t}\n\n\t\tif (settings.language != null) {\n\t\t\tRocketChat.models.Users.setLanguage(user._id, settings.language);\n\t\t}\n\n\t\tif (settings.mergeChannels != null) {\n\t\t\tsettings.mergeChannels = ['1', true].includes(settings.mergeChannels);\n\t\t}\n\n\n\n\t\tif (settings.roomsListExhibitionMode != null) {\n\t\t\tsettings.roomsListExhibitionMode = ['category', 'unread', 'activity'].includes(settings.roomsListExhibitionMode) ? settings.roomsListExhibitionMode : 'category';\n\t\t}\n\n\t\tRocketChat.models.Users.setPreferences(user._id, settings);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tsaveUserProfile(settings, customFields) {\n\t\tcheck(settings, Object);\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserProfileChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tfunction checkPassword(user = {}, typedPassword) {\n\t\t\tif (!(user.services && user.services.password && user.services.password.bcrypt && user.services.password.bcrypt.trim())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst passCheck = Accounts._checkPassword(user, {\n\t\t\t\tdigest: typedPassword,\n\t\t\t\talgorithm: 'sha-256'\n\t\t\t});\n\n\t\t\tif (passCheck.error) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (settings.realname) {\n\t\t\tRocketChat.setRealName(Meteor.userId(), settings.realname);\n\t\t}\n\n\t\tif (settings.username) {\n\t\t\tMeteor.call('setUsername', settings.username);\n\t\t}\n\n\t\tif (settings.email) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tMeteor.call('setEmail', settings.email);\n\t\t}\n\n\t\t// Should be the last check to prevent error when trying to check password for users without password\n\t\tif ((settings.newPassword) && RocketChat.settings.get('Accounts_AllowPasswordChange') === true) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tAccounts.setPassword(Meteor.userId(), settings.newPassword, {\n\t\t\t\tlogout: false\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Users.setProfile(Meteor.userId(), {});\n\n\t\tRocketChat.saveCustomFields(Meteor.userId(), customFields);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tsendConfirmationEmail(email) {\n\t\tcheck(email, String);\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = function(userModel, url) {\n\t\t\t\t\treturn html.replace(/\\[Verification_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendVerificationEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tsendForgotPasswordEmail(email) {\n\t\tcheck(email, String);\n\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tconst regex = new RegExp(`^${ s.escapeRegExp(email) }$`, 'i');\n\t\t\temail = (user.emails || []).map(item => item.address).find(userEmail => regex.test(userEmail));\n\n\t\t\tif (RocketChat.settings.get('Forgot_Password_Customized')) {\n\t\t\t\tconst data = { name: user.name, email };\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email_Subject') || '', data);\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email') || '', data);\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.html = function(userModel, url) {\n\t\t\t\t\turl = url.replace('/#/', '/');\n\t\t\t\t\treturn html.replace(/\\[Forgot_Password_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendResetPasswordEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetAvatarFromService(dataURI, contentType, service) {\n\t\tcheck(dataURI, String);\n\t\tcheck(contentType, Match.Optional(String));\n\t\tcheck(service, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn RocketChat.setUserAvatar(user, dataURI, contentType, service);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'setAvatarFromService',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 5000);\n","Meteor.methods({\n\tsetUserActiveStatus(userId, active) {\n\t\tcheck(userId, String);\n\t\tcheck(active, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-active-status') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user) {\n\t\t\tRocketChat.models.Users.setUserActive(userId, active);\n\n\t\t\tif (user.username) {\n\t\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, !active);\n\t\t\t}\n\n\t\t\tif (active === false) {\n\t\t\t\tRocketChat.models.Users.unsetLoginTokens(userId);\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Users.unsetReason(userId);\n\t\t\t}\n\n\t\t\tconst destinations = Array.isArray(user.emails) && user.emails.map(email => `${ user.name || user.username }<${ email.address }>`);\n\n\t\t\tif (destinations) {\n\t\t\t\tconst email = {\n\t\t\t\t\tto: destinations,\n\t\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\t\tsubject: Accounts.emailTemplates.userActivated.subject({active}),\n\t\t\t\t\thtml: Accounts.emailTemplates.userActivated.html({active, name: user.name, username: user.username})\n\t\t\t\t};\n\n\t\t\t\tMeteor.defer(() => Email.send(email));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetUserPassword(password) {\n\t\tcheck(password, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user && user.requirePasswordChange !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tAccounts.setPassword(userId, password, {\n\t\t\tlogout: false\n\t\t});\n\n\t\treturn RocketChat.models.Users.unsetRequirePasswordChange(userId);\n\t}\n});\n","Meteor.methods({\n\ttoggleFavorite(rid, f) {\n\t\tcheck(rid, String);\n\n\t\tcheck(f, Match.Optional(Boolean));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'toggleFavorite'\n\t\t\t});\n\t\t}\n\n\t\tconst userSubscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tif (!userSubscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription',\n\t\t\t\t'You must be part of a room to favorite it',\n\t\t\t\t{ method: 'toggleFavorite' }\n\t\t\t);\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setFavoriteByRoomIdAndUserId(rid, Meteor.userId(), f);\n\t}\n});\n","Meteor.methods({\n\tunmuteUserInRoom(data) {\n\t\tconst fromId = Meteor.userId();\n\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst unmutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.unmuteUsernameByRoomId(data.rid, unmutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserUnmutedWithRoomIdAndUser(data.rid, unmutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tuserSetUtcOffset(utcOffset) {\n\t\tcheck(utcOffset, Number);\n\n\t\tif (this.userId == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unblock();\n\n\t\treturn RocketChat.models.Users.setUtcOffset(this.userId, utcOffset);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'userSetUtcOffset',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.publish('activeUsers', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.findUsersNotOffline({\n\t\tfields: {\n\t\t\tusername: 1,\n\t\t\tname: 1,\n\t\t\tstatus: 1,\n\t\t\tutcOffset: 1\n\t\t}\n\t});\n});\n","Meteor.publish('channelAndPrivateAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tname: 1\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t};\n\n\tconst cursorHandle = RocketChat.models.Rooms.findByNameStartingAndTypes(selector.name, ['c', 'p'], options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('fullUserData', function(filter, limit) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst result = RocketChat.getFullUserData({\n\t\tuserId: this.userId,\n\t\tfilter,\n\t\tlimit\n\t});\n\n\tif (!result) {\n\t\treturn this.ready();\n\t}\n\n\treturn result;\n});\n","import _ from 'underscore';\n\nMeteor.publish('messages', function(rid/*, start*/) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst publication = this;\n\n\tif (typeof rid !== 'string') {\n\t\treturn this.ready();\n\t}\n\n\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\treturn this.ready();\n\t}\n\n\tconst cursor = RocketChat.models.Messages.findVisibleByRoomId(rid, {\n\t\tsort: {\n\t\t\tts: -1\n\t\t},\n\t\tlimit: 50\n\t});\n\n\tconst cursorHandle = cursor.observeChanges({\n\t\tadded(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.added('rocketchat_message', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.changed('rocketchat_message', _id, record);\n\t\t}\n\t});\n\n\tconst cursorDelete = RocketChat.models.Messages.findInvisibleByRoomId(rid, {\n\t\tfields: {\n\t\t\t_id: 1\n\t\t}\n\t});\n\n\tconst cursorDeleteHandle = cursorDelete.observeChanges({\n\t\tadded(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t},\n\t\tchanged(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\tcursorHandle.stop();\n\t\treturn cursorDeleteHandle.stop();\n\t});\n});\n\nMeteor.methods({\n\t'messages/get'(rid, {lastUpdate, latestDate = new Date(), oldestDate, inclusive = false, count = 20, unreads= false}) {\n\t\tcheck(rid, String);\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messages/get'\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'messages/get'\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\tif (lastUpdate instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdated: RocketChat.models.Messages.findForUpdates(rid, lastUpdate, options).fetch(),\n\t\t\t\tdeleted: RocketChat.models.Messages.trashFindDeletedAfter(lastUpdate, {rid}, { ...options, fields: { _id: 1, _deletedAt: 1 }}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn Meteor.call('getChannelHistory', { rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\n\t}\n});\n","import _ from 'underscore';\n\nconst fields = {\n\t_id: 1,\n\tname: 1,\n\tfname: 1,\n\tt: 1,\n\tcl: 1,\n\tu: 1,\n\t// usernames: 1,\n\ttopic: 1,\n\tannouncement: 1,\n\tannouncementDetails: 1,\n\tmuted: 1,\n\t_updatedAt: 1,\n\tarchived: 1,\n\tjitsiTimeout: 1,\n\tdescription: 1,\n\tdefault: 1,\n\tcustomFields: 1,\n\tlastMessage: 1,\n\n\t// @TODO create an API to register this fields based on room type\n\tlivechatData: 1,\n\ttags: 1,\n\tsms: 1,\n\tfacebook: 1,\n\tcode: 1,\n\tjoinCodeRequired: 1,\n\topen: 1,\n\tv: 1,\n\tlabel: 1,\n\tro: 1,\n\treactWhenReadOnly: 1,\n\tsentiment: 1,\n\ttokenpass: 1,\n\tstreamingOptions: 1,\n\tbroadcast: 1\n};\n\nconst roomMap = (record) => {\n\tif (record._room) {\n\t\treturn _.pick(record._room, ...Object.keys(fields));\n\t}\n\tconsole.log('Empty Room for Subscription', record);\n\treturn {};\n};\n\nMeteor.methods({\n\t'rooms/get'(updatedAt) {\n\t\tlet options = {fields};\n\n\t\tif (!Meteor.userId()) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\treturn RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c'], options).fetch();\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\toptions = {\n\t\t\tfields\n\t\t};\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: RocketChat.models.Rooms.findBySubscriptionUserIdUpdatedAfter(Meteor.userId(), updatedAt, options).fetch(),\n\t\t\t\tremove: RocketChat.models.Rooms.trashFindDeletedAfter(updatedAt, {}, {fields: {_id: 1, _deletedAt: 1}}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Rooms.findBySubscriptionUserId(Meteor.userId(), options).fetch();\n\t},\n\n\tgetRoomByTypeAndName(type, name) {\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tconst roomFind = RocketChat.roomTypes.getRoomFind(type);\n\n\t\tlet room;\n\n\t\tif (roomFind) {\n\t\t\troom = roomFind.call(this, name);\n\t\t} else {\n\t\t\troom = RocketChat.models.Rooms.findByTypeAndName(type, name).fetch();\n\t\t}\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', room._id, Meteor.userId())) {\n\t\t\tthrow new Meteor.Error('error-no-permission', 'No permission', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (RocketChat.settings.get('Store_Last_Message') && !RocketChat.authz.hasPermission(Meteor.userId(), 'preview-c-room')) {\n\t\t\tdelete room.lastMessage;\n\t\t}\n\n\t\treturn roomMap({ _room: room });\n\t}\n});\n\nRocketChat.models.Rooms.cache.on('sync', (type, room/*, diff*/) => {\n\tconst records = RocketChat.models.Subscriptions.findByRoomId(room._id).fetch();\n\n\tconst _room = roomMap({_room: room});\n\tfor (const record of records) {\n\t\tRocketChat.Notifications.notifyUserInThisInstance(record.u._id, 'rooms-changed', type, _room);\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', (type, subscription/*, diff*/) => {\n\tif (type === 'inserted' || type === 'removed') {\n\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\tif (room) {\n\t\t\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'rooms-changed', type, roomMap({_room: room}));\n\t\t}\n\t}\n});\n","Meteor.publish('roomFiles', function(rid, limit = 50) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\n\tconst cursorFileListHandle = RocketChat.models.Uploads.findNotHiddenFilesOfRoom(rid, limit).observeChanges({\n\t\tadded(_id, record) {\n\t\t\tconst {username, name} = record.userId ? RocketChat.models.Users.findOneById(record.userId) : {};\n\t\t\treturn pub.added('room_files', _id, {...record, user:{username, name}});\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\tconst {username, name} = record.userId ? RocketChat.models.Users.findOneById(record.userId) : {};\n\t\t\treturn pub.changed('room_files', _id, {...record, user:{username, name}});\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('room_files', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\treturn cursorFileListHandle.stop();\n\t});\n});\n","Meteor.publish('roomSubscriptionsByRole', function(rid, role) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, role, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\troles: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","import s from 'underscore.string';\n\nfunction fetchRooms(userId, rooms) {\n\tif (!RocketChat.settings.get('Store_Last_Message') || RocketChat.authz.hasPermission(userId, 'preview-c-room')) {\n\t\treturn rooms;\n\t}\n\n\treturn rooms.map(room => {\n\t\tdelete room.lastMessage;\n\t\treturn room;\n\t});\n}\n\nMeteor.methods({\n\tspotlight(text, usernames, type = {users: true, rooms: true}, rid) {\n\t\tconst searchForChannels = text[0] === '#';\n\t\tconst searchForDMs = text[0] === '@';\n\t\tif (searchForChannels) {\n\t\t\ttype.users = false;\n\t\t\ttext = text.slice(1);\n\t\t}\n\t\tif (searchForDMs) {\n\t\t\ttype.rooms = false;\n\t\t\ttext = text.slice(1);\n\t\t}\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\trooms: []\n\t\t};\n\t\tconst roomOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tt: 1,\n\t\t\t\tname: 1,\n\t\t\t\tlastMessage: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tname: 1\n\t\t\t}\n\t\t};\n\t\tconst userId = this.userId;\n\t\tif (userId == null) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\tresult.rooms = fetchRooms(userId, RocketChat.models.Rooms.findByNameAndTypeNotDefault(regex, 'c', roomOptions).fetch());\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\tconst userOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1,\n\t\t\t\tstatus: 1\n\t\t\t},\n\t\t\tsort: {}\n\t\t};\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tuserOptions.sort.name = 1;\n\t\t} else {\n\t\t\tuserOptions.sort.username = 1;\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(userId, 'view-outside-room')) {\n\t\t\tif (type.users === true && RocketChat.authz.hasPermission(userId, 'view-d-room')) {\n\t\t\t\tresult.users = RocketChat.models.Users.findByActiveUsersExcept(text, usernames, userOptions).fetch();\n\t\t\t}\n\n\t\t\tif (type.rooms === true && RocketChat.authz.hasPermission(userId, 'view-c-room')) {\n\t\t\t\tconst username = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\t\tusername: 1\n\t\t\t\t}).username;\n\n\t\t\t\tconst searchableRoomTypes = Object.entries(RocketChat.roomTypes.roomTypes)\n\t\t\t\t\t.filter((roomType)=>roomType[1].includeInRoomSearch())\n\t\t\t\t\t.map((roomType)=>roomType[0]);\n\n\t\t\t\tresult.rooms = fetchRooms(userId, RocketChat.models.Rooms.findByNameAndTypesNotContainingUsername(regex, searchableRoomTypes, username, roomOptions).fetch());\n\t\t\t}\n\t\t} else if (type.users === true && rid) {\n\t\t\tconst subscriptions = RocketChat.models.Subscriptions.find({\n\t\t\t\trid, 'u.username': {\n\t\t\t\t\t$regex: regex,\n\t\t\t\t\t$nin: [...usernames, Meteor.user().username]\n\t\t\t\t}\n\t\t\t}, {limit: userOptions.limit}).fetch().map(({u}) => u._id);\n\t\t\tresult.users = RocketChat.models.Users.find({_id: {$in: subscriptions}}, {\n\t\t\t\tfields: userOptions.fields,\n\t\t\t\tsort: userOptions.sort\n\t\t\t}).fetch();\n\t\t}\n\n\t\treturn result;\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'spotlight',\n\tuserId(/*userId*/) {\n\t\treturn true;\n\t}\n}, 100, 100000);\n","const fields = {\n\tt: 1,\n\tts: 1,\n\tls: 1,\n\tname: 1,\n\tfname: 1,\n\trid: 1,\n\tcode: 1,\n\tf: 1,\n\tu: 1,\n\topen: 1,\n\talert: 1,\n\troles: 1,\n\tunread: 1,\n\tuserMentions: 1,\n\tgroupMentions: 1,\n\tarchived: 1,\n\taudioNotifications: 1,\n\taudioNotificationValue: 1,\n\tdesktopNotifications: 1,\n\tdesktopNotificationDuration: 1,\n\tmobilePushNotifications: 1,\n\temailNotifications: 1,\n\tunreadAlert: 1,\n\t_updatedAt: 1,\n\tblocked: 1,\n\tblocker: 1,\n\tautoTranslate: 1,\n\tautoTranslateLanguage: 1,\n\tdisableNotifications: 1,\n\thideUnreadStatus: 1,\n\tmuteGroupMentions: 1,\n\tignored: 1\n};\n\nMeteor.methods({\n\t'subscriptions/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst options = { fields };\n\n\t\tconst records = RocketChat.models.Subscriptions.findByUserId(Meteor.userId(), options).fetch();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Subscriptions.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\t'u._id': Meteor.userId()\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn records;\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', function(type, subscription) {\n\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', type, RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields\n\t}));\n});\n\n// TODO needs improvement\n// We are sending the record again cuz any update on subscription will send the record without the fname (join)\n// Then we need to sent it again listening to the join event.\nRocketChat.models.Subscriptions.on('join:fname:inserted', function(subscription/*, user*/) {\n\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', 'changed', RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields\n\t}));\n});\n","import _ from 'underscore';\n\nMeteor.publish('userAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (!_.isObject(selector)) {\n\t\treturn this.ready();\n\t}\n\n\tconst options = {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1\n\t\t},\n\t\tsort: {\n\t\t\tusername: 1\n\t\t},\n\t\tlimit: 10\n\t};\n\n\tconst pub = this;\n\tconst exceptions = selector.exceptions || [];\n\n\tconst cursorHandle = RocketChat.models.Users.findActiveByUsernameOrNameRegexWithExceptions(selector.term, exceptions, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('userChannels', function(userId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByUserId(userId, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tt: 1,\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.publish('userData', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.find(this.userId, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tstatusDefault: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tavatarOrigin: 1,\n\t\t\tutcOffset: 1,\n\t\t\tlanguage: 1,\n\t\t\tsettings: 1,\n\t\t\tenableAutoAway: 1,\n\t\t\tidleTimeLimit: 1,\n\t\t\troles: 1,\n\t\t\tactive: 1,\n\t\t\tdefaultRoom: 1,\n\t\t\tcustomFields: 1,\n\t\t\t'services.github': 1,\n\t\t\t'services.gitlab': 1,\n\t\t\t'services.tokenpass': 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\t'services.password.bcrypt': 1,\n\t\t\t'services.totp.enabled': 1,\n\t\t\tstatusLivechat: 1,\n\t\t\tbanners: 1\n\t\t}\n\t});\n});\n","const msgStream = new Meteor.Streamer('room-messages');\nthis.msgStream = msgStream;\n\nmsgStream.allowWrite('none');\n\nmsgStream.allowRead(function(eventName, args) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', eventName, this.userId, args);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(this.userId, 'preview-c-room') && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nmsgStream.allowRead('__my_messages__', 'all');\n\nmsgStream.allowEmit('__my_messages__', function(eventName, msg, options) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', msg.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\toptions.roomParticipant = room.usernames.indexOf(room.username) > -1;\n\t\toptions.roomType = room.t;\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nMeteor.startup(function() {\n\tfunction publishMessage(type, record) {\n\t\tif (record._hidden !== true && (record.imported == null)) {\n\t\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\t\tif (record.u && record.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(record.u._id);\n\t\t\t\trecord.u.name = user && user.name;\n\t\t\t}\n\n\t\t\tif (record.mentions && record.mentions.length && UI_Use_Real_Name) {\n\t\t\t\trecord.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\tmsgStream.emitWithoutBroadcast('__my_messages__', record, {});\n\t\t\treturn msgStream.emitWithoutBroadcast(record.rid, record);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Messages._db.on('change', function({action, id, data/*, oplog*/}) {\n\t\tswitch (action) {\n\t\t\tcase 'insert':\n\t\t\t\tdata._id = id;\n\t\t\t\tpublishMessage('inserted', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:record':\n\t\t\t\tpublishMessage('updated', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:diff':\n\t\t\t\tpublishMessage('updated', RocketChat.models.Messages.findOne({\n\t\t\t\t\t_id: id\n\t\t\t\t}));\n\t\t\t\tbreak;\n\t\t}\n\t});\n});\n","/* global InstanceStatus, DDP, LoggerManager */\n\nimport _ from 'underscore';\nimport {DDPCommon} from 'meteor/ddp-common';\n\nprocess.env.PORT = String(process.env.PORT).trim();\nprocess.env.INSTANCE_IP = String(process.env.INSTANCE_IP).trim();\n\nconst connections = {};\nthis.connections = connections;\n\nconst logger = new Logger('StreamBroadcast', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tauth: 'Auth',\n\t\tstream: 'Stream'\n\t}\n});\n\nfunction _authorizeConnection(instance) {\n\tlogger.auth.info(`Authorizing with ${ instance }`);\n\n\treturn connections[instance].call('broadcastAuth', InstanceStatus.id(), connections[instance].instanceId, function(err, ok) {\n\t\tif (err != null) {\n\t\t\treturn logger.auth.error(`broadcastAuth error ${ instance } ${ InstanceStatus.id() } ${ connections[instance].instanceId }`, err);\n\t\t}\n\n\t\tconnections[instance].broadcastAuth = ok;\n\t\treturn logger.auth.info(`broadcastAuth with ${ instance }`, ok);\n\t});\n}\n\nfunction authorizeConnection(instance) {\n\tconst query = {\n\t\t_id: InstanceStatus.id()\n\t};\n\n\tif (!InstanceStatus.getCollection().findOne(query)) {\n\t\treturn Meteor.setTimeout(function() {\n\t\t\treturn authorizeConnection(instance);\n\t\t}, 500);\n\t}\n\n\treturn _authorizeConnection(instance);\n}\n\nfunction startMatrixBroadcast() {\n\tconst query = {\n\t\t'extraInformation.port': {\n\t\t\t$exists: true\n\t\t}\n\t};\n\n\tconst options = {\n\t\tsort: {\n\t\t\t_createdAt: -1\n\t\t}\n\t};\n\n\treturn InstanceStatus.getCollection().find(query, options).observe({\n\t\tadded(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.port === process.env.PORT && record.extraInformation.host === process.env.INSTANCE_IP) {\n\t\t\t\tlogger.auth.info('prevent self connect', instance);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tif (connections[instance] && connections[instance].instanceRecord) {\n\t\t\t\tif (connections[instance].instanceRecord._createdAt < record._createdAt) {\n\t\t\t\t\tconnections[instance].disconnect();\n\t\t\t\t\tdelete connections[instance];\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlogger.connection.info('connecting in', instance);\n\n\t\t\tconnections[instance] = DDP.connect(instance, {\n\t\t\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t\t\t});\n\n\t\t\tconnections[instance].instanceRecord = record;\n\t\t\tconnections[instance].instanceId = record._id;\n\n\t\t\treturn connections[instance].onReconnect = function() {\n\t\t\t\treturn authorizeConnection(instance);\n\t\t\t};\n\t\t},\n\n\t\tremoved(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tconst query = {\n\t\t\t\t'extraInformation.host': record.extraInformation.host,\n\t\t\t\t'extraInformation.port': record.extraInformation.port\n\t\t\t};\n\n\t\t\tif (connections[instance] && !InstanceStatus.getCollection().findOne(query)) {\n\t\t\t\tlogger.connection.info('disconnecting from', instance);\n\t\t\t\tconnections[instance].disconnect();\n\t\t\t\treturn delete connections[instance];\n\t\t\t}\n\t\t}\n\t});\n}\n\nMeteor.methods({\n\tbroadcastAuth(remoteId, selfId) {\n\t\tcheck(selfId, String);\n\t\tcheck(remoteId, String);\n\n\t\tthis.unblock();\n\n\t\tconst query = {\n\t\t\t_id: remoteId\n\t\t};\n\n\t\tif (selfId === InstanceStatus.id() && remoteId !== InstanceStatus.id() && (InstanceStatus.getCollection().findOne(query))) {\n\t\t\tthis.connection.broadcastAuth = true;\n\t\t}\n\n\t\treturn this.connection.broadcastAuth === true;\n\t},\n\n\tstream(streamName, eventName, args) {\n\t\tif (!this.connection) {\n\t\t\treturn 'self-not-authorized';\n\t\t}\n\n\t\tif (this.connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tconst instance = Meteor.StreamerCentral.instances[streamName];\n\t\tif (!instance) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\tif (instance.serverOnly) {\n\t\t\tconst scope = {};\n\t\t\tinstance.emitWithScope(eventName, scope, ...args);\n\t\t} else {\n\t\t\tMeteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t\t}\n\t}\n});\n\nfunction startStreamCastBroadcast(value) {\n\tconst instance = 'StreamCast';\n\n\tlogger.connection.info('connecting in', instance, value);\n\n\tconst connection = DDP.connect(value, {\n\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t});\n\n\tconnections[instance] = connection;\n\tconnection.instanceId = instance;\n\tconnection.onReconnect = function() {\n\t\treturn authorizeConnection(instance);\n\t};\n\n\tconnection._stream.on('message', function(raw_msg) {\n\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\tif (!msg || msg.msg !== 'changed' || !msg.collection || !msg.fields) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {streamName, eventName, args} = msg.fields;\n\n\t\tif (!streamName || !eventName || !args) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\treturn Meteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t});\n\n\treturn connection.subscribe('stream');\n}\n\nfunction startStreamBroadcast() {\n\tif (!process.env.INSTANCE_IP) {\n\t\tprocess.env.INSTANCE_IP = 'localhost';\n\t}\n\n\tlogger.info('startStreamBroadcast');\n\n\tRocketChat.settings.get('Stream_Cast_Address', function(key, value) {\n\t\t// var connection, fn, instance;\n\t\tconst fn = function(instance, connection) {\n\t\t\tconnection.disconnect();\n\t\t\treturn delete connections[instance];\n\t\t};\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\t\t\tfn(instance, connection);\n\t\t}\n\n\t\tif (value && value.trim() !== '') {\n\t\t\treturn startStreamCastBroadcast(value);\n\t\t} else {\n\t\t\treturn startMatrixBroadcast();\n\t\t}\n\t});\n\n\tfunction broadcast(streamName, eventName, args/*, userId*/) {\n\t\tconst fromInstance = `${ process.env.INSTANCE_IP }:${ process.env.PORT }`;\n\t\tconst results = [];\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\n\t\t\tif (connection.status().connected === true) {\n\t\t\t\tconnection.call('stream', streamName, eventName, args, function(error, response) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlogger.error('Stream broadcast error', error);\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (response) {\n\t\t\t\t\t\tcase 'self-not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } to self is not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\tcase 'not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\tlogger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\t\treturn authorizeConnection(instance);\n\t\t\t\t\t\tcase 'stream-not-exists':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } does not exist`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\treturn Meteor.StreamerCentral.on('broadcast', function(streamName, eventName, args) {\n\t\treturn broadcast(streamName, eventName, args);\n\t});\n}\n\nMeteor.startup(function() {\n\treturn startStreamBroadcast();\n});\n\nMeteor.methods({\n\t'instances/get'() {\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-statistics')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'List instances is not allowed', {\n\t\t\t\tmethod: 'instances/get'\n\t\t\t});\n\t\t}\n\n\t\treturn Object.keys(connections).map(address => {\n\t\t\tconst conn = connections[address];\n\t\t\treturn Object.assign({ address, currentStatus: conn._stream.currentStatus }, _.pick(conn, 'instanceRecord', 'broadcastAuth'));\n\t\t});\n\t}\n});\n","import '/imports/startup/server';\n","RegExp.escape = function(s) {\n\treturn s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","this.i18n_status_func = function(key, options) {\n\treturn TAPi18n.__(key, options);\n};\n"]}