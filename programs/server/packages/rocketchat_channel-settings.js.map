{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveReactWhenReadOnly.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomType.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomTopic.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomAnnouncement.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomName.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomReadOnly.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomDescription.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomSystemMessages.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/methods/saveRoomSettings.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/models/Messages.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/models/Rooms.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/startup.js"],"names":["RocketChat","saveReactWhenReadOnly","rid","allowReact","Match","test","String","Meteor","Error","function","models","Rooms","setAllowReactingWhenReadOnlyById","saveRoomType","roomType","user","sendMessage","type","room","findOneById","_id","t","result","setTypeById","Subscriptions","updateTypeByRoomId","message","TAPi18n","__","lng","language","settings","get","Messages","createRoomSettingsChangedWithTypeRoomIdMessageAndUser","s","module","watch","require","default","v","saveRoomTopic","roomTopic","escapeHTML","update","setTopicById","saveRoomAnnouncement","roomAnnouncement","announcementDetails","escapedMessage","updated","setAnnouncementById","saveRoomName","displayName","roomTypes","preventRenaming","name","slugifiedRoomName","getValidRoomName","setNameById","updateNameAndAlertByRoomId","createRoomRenamedWithRoomIdRoomNameAndUser","saveRoomReadOnly","readOnly","setReadOnlyById","saveRoomDescription","roomDescription","escapedRoomDescription","setDescriptionById","saveRoomSystemMessages","systemMessages","setSystemMessagesById","fields","methods","saveRoomSettings","value","userId","method","Object","keys","every","key","includes","authz","hasPermission","action","broadcast","reactWhenReadOnly","forEach","setting","topic","announcement","description","check","tokens","token","balance","saveRoomTokenpass","saveStreamingOptions","ro","sysMes","setJoinCodeById","saveDefaultById","roomId","extraData","createWithTypeRoomIdMessageAndUser","roomName","query","$set","findByRoomId","subscription","_user","muted","push","username","$unset","allowReacting","startup","Permissions","upsert","$setOnInsert","roles"],"mappings":"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","file":"/packages/rocketchat_channel-settings.js","sourcesContent":["RocketChat.saveReactWhenReadOnly = function(rid, allowReact) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', { function: 'RocketChat.saveReactWhenReadOnly' });\n\t}\n\n\treturn RocketChat.models.Rooms.setAllowReactingWhenReadOnlyById(rid, allowReact);\n};\n","\nRocketChat.saveRoomType = function(rid, roomType, user, sendMessage = true) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\t'function': 'RocketChat.saveRoomType'\n\t\t});\n\t}\n\tif (roomType !== 'c' && roomType !== 'p') {\n\t\tthrow new Meteor.Error('error-invalid-room-type', 'error-invalid-room-type', {\n\t\t\t'function': 'RocketChat.saveRoomType',\n\t\t\ttype: roomType\n\t\t});\n\t}\n\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\tif (room == null) {\n\t\tthrow new Meteor.Error('error-invalid-room', 'error-invalid-room', {\n\t\t\t'function': 'RocketChat.saveRoomType',\n\t\t\t_id: rid\n\t\t});\n\t}\n\tif (room.t === 'd') {\n\t\tthrow new Meteor.Error('error-direct-room', 'Can\\'t change type of direct rooms', {\n\t\t\t'function': 'RocketChat.saveRoomType'\n\t\t});\n\t}\n\tconst result = RocketChat.models.Rooms.setTypeById(rid, roomType) && RocketChat.models.Subscriptions.updateTypeByRoomId(rid, roomType);\n\tif (result && sendMessage) {\n\t\tlet message;\n\t\tif (roomType === 'c') {\n\t\t\tmessage = TAPi18n.__('Channel', {\n\t\t\t\tlng: user && user.language || RocketChat.settings.get('language') || 'en'\n\t\t\t});\n\t\t} else {\n\t\t\tmessage = TAPi18n.__('Private_Group', {\n\t\t\t\tlng: user && user.language || RocketChat.settings.get('language') || 'en'\n\t\t\t});\n\t\t}\n\t\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser('room_changed_privacy', rid, message, user);\n\t}\n\treturn result;\n};\n","import s from 'underscore.string';\n\nRocketChat.saveRoomTopic = function(rid, roomTopic, user, sendMessage = true) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\t'function': 'RocketChat.saveRoomTopic'\n\t\t});\n\t}\n\troomTopic = s.escapeHTML(roomTopic);\n\tconst update = RocketChat.models.Rooms.setTopicById(rid, roomTopic);\n\tif (update && sendMessage) {\n\t\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser('room_changed_topic', rid, roomTopic, user);\n\t}\n\treturn update;\n};\n","import s from 'underscore.string';\n\nRocketChat.saveRoomAnnouncement = function(rid, roomAnnouncement, user, sendMessage=true) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', { function: 'RocketChat.saveRoomAnnouncement' });\n\t}\n\n\tlet message;\n\tlet announcementDetails;\n\tif (typeof roomAnnouncement === 'string') {\n\t\tmessage = roomAnnouncement;\n\t} else {\n\t\t({message, ...announcementDetails} = roomAnnouncement);\n\t}\n\n\tconst escapedMessage = s.escapeHTML(message);\n\n\tconst updated = RocketChat.models.Rooms.setAnnouncementById(rid, escapedMessage, announcementDetails);\n\tif (updated && sendMessage) {\n\t\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser('room_changed_announcement', rid, escapedMessage, user);\n\t}\n\n\treturn updated;\n};\n","\nRocketChat.saveRoomName = function(rid, displayName, user, sendMessage = true) {\n\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\tif (RocketChat.roomTypes.roomTypes[room.t].preventRenaming()) {\n\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t'function': 'RocketChat.saveRoomdisplayName'\n\t\t});\n\t}\n\tif (displayName === room.name) {\n\t\treturn;\n\t}\n\n\tconst slugifiedRoomName = RocketChat.getValidRoomName(displayName, rid);\n\n\tconst update = RocketChat.models.Rooms.setNameById(rid, slugifiedRoomName, displayName) && RocketChat.models.Subscriptions.updateNameAndAlertByRoomId(rid, slugifiedRoomName, displayName);\n\n\tif (update && sendMessage) {\n\t\tRocketChat.models.Messages.createRoomRenamedWithRoomIdRoomNameAndUser(rid, displayName, user);\n\t}\n\treturn displayName;\n};\n","RocketChat.saveRoomReadOnly = function(rid, readOnly) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\t'function': 'RocketChat.saveRoomReadOnly'\n\t\t});\n\t}\n\treturn RocketChat.models.Rooms.setReadOnlyById(rid, readOnly);\n};\n","import s from 'underscore.string';\n\nRocketChat.saveRoomDescription = function(rid, roomDescription, user) {\n\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\t'function': 'RocketChat.saveRoomDescription'\n\t\t});\n\t}\n\tconst escapedRoomDescription = s.escapeHTML(roomDescription);\n\tconst update = RocketChat.models.Rooms.setDescriptionById(rid, escapedRoomDescription);\n\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser('room_changed_description', rid, escapedRoomDescription, user);\n\treturn update;\n};\n","RocketChat.saveRoomSystemMessages = function(rid, systemMessages) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\t'function': 'RocketChat.saveRoomSystemMessages'\n\t\t});\n\t}\n\treturn RocketChat.models.Rooms.setSystemMessagesById(rid, systemMessages);\n};\n","const fields = ['roomName', 'roomTopic', 'roomAnnouncement', 'roomDescription', 'roomType', 'readOnly', 'reactWhenReadOnly', 'systemMessages', 'default', 'joinCode', 'tokenpass', 'streamingOptions'];\nMeteor.methods({\n\tsaveRoomSettings(rid, settings, value) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t'function': 'RocketChat.saveRoomName'\n\t\t\t});\n\t\t}\n\t\tif (!Match.test(rid, String)) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'saveRoomSettings'\n\t\t\t});\n\t\t}\n\n\t\tif (typeof settings !== 'object') {\n\t\t\tsettings = {\n\t\t\t\t[settings] : value\n\t\t\t};\n\t\t}\n\n\t\tif (!Object.keys(settings).every(key => fields.includes(key))) {\n\t\t\tthrow new Meteor.Error('error-invalid-settings', 'Invalid settings provided', {\n\t\t\t\tmethod: 'saveRoomSettings'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'edit-room', rid)) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing room is not allowed', {\n\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\taction: 'Editing_room'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (room.broadcast && (settings.readOnly || settings.reactWhenReadOnly)) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing readOnly/reactWhenReadOnly are not allowed for broadcast rooms', {\n\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\taction: 'Editing_room'\n\t\t\t});\n\t\t}\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'saveRoomSettings'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tObject.keys(settings).forEach(setting => {\n\t\t\tconst value = settings[setting];\n\t\t\tif (settings === 'default' && !RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Viewing room administration is not allowed', {\n\t\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\t\taction: 'Viewing_room_administration'\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (setting === 'roomType' && value !== room.t && value === 'c' && !RocketChat.authz.hasPermission(this.userId, 'create-c')) {\n\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Changing a private group to a public channel is not allowed', {\n\t\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\t\taction: 'Change_Room_Type'\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (setting === 'roomType' && value !== room.t && value === 'p' && !RocketChat.authz.hasPermission(this.userId, 'create-p')) {\n\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Changing a public channel to a private room is not allowed', {\n\t\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\t\taction: 'Change_Room_Type'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tObject.keys(settings).forEach(setting => {\n\t\t\tconst value = settings[setting];\n\t\t\tswitch (setting) {\n\t\t\t\tcase 'roomName':\n\t\t\t\t\tRocketChat.saveRoomName(rid, value, user);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roomTopic':\n\t\t\t\t\tif (value !== room.topic) {\n\t\t\t\t\t\tRocketChat.saveRoomTopic(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roomAnnouncement':\n\t\t\t\t\tif (value !== room.announcement) {\n\t\t\t\t\t\tRocketChat.saveRoomAnnouncement(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roomDescription':\n\t\t\t\t\tif (value !== room.description) {\n\t\t\t\t\t\tRocketChat.saveRoomDescription(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roomType':\n\t\t\t\t\tif (value !== room.t) {\n\t\t\t\t\t\tRocketChat.saveRoomType(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'tokenpass':\n\t\t\t\t\tcheck(value, {\n\t\t\t\t\t\trequire: String,\n\t\t\t\t\t\ttokens: [{\n\t\t\t\t\t\t\ttoken: String,\n\t\t\t\t\t\t\tbalance: String\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t\tRocketChat.saveRoomTokenpass(rid, value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'streamingOptions':\n\t\t\t\t\tRocketChat.saveStreamingOptions(rid, value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'readOnly':\n\t\t\t\t\tif (value !== room.ro) {\n\t\t\t\t\t\tRocketChat.saveRoomReadOnly(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'reactWhenReadOnly':\n\t\t\t\t\tif (value !== room.reactWhenReadOnly) {\n\t\t\t\t\t\tRocketChat.saveReactWhenReadOnly(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'systemMessages':\n\t\t\t\t\tif (value !== room.sysMes) {\n\t\t\t\t\t\tRocketChat.saveRoomSystemMessages(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'joinCode':\n\t\t\t\t\tRocketChat.models.Rooms.setJoinCodeById(rid, String(value));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'default':\n\t\t\t\t\tRocketChat.models.Rooms.saveDefaultById(rid, value);\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tresult: true,\n\t\t\trid: room._id\n\t\t};\n\t}\n});\n","RocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser = function(type, roomId, message, user, extraData) {\n\treturn this.createWithTypeRoomIdMessageAndUser(type, roomId, message, user, extraData);\n};\n\nRocketChat.models.Messages.createRoomRenamedWithRoomIdRoomNameAndUser = function(roomId, roomName, user, extraData) {\n\treturn this.createWithTypeRoomIdMessageAndUser('r', roomId, roomName, user, extraData);\n};\n","RocketChat.models.Rooms.setDescriptionById = function(_id, description) {\n\tconst query = {\n\t\t_id\n\t};\n\tconst update = {\n\t\t$set: {\n\t\t\tdescription\n\t\t}\n\t};\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Rooms.setReadOnlyById = function(_id, readOnly) {\n\tconst query = {\n\t\t_id\n\t};\n\tconst update = {\n\t\t$set: {\n\t\t\tro: readOnly\n\t\t}\n\t};\n\tif (readOnly) {\n\t\tRocketChat.models.Subscriptions.findByRoomId(_id).forEach(function(subscription) {\n\t\t\tif (subscription._user == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst user = subscription._user;\n\t\t\tif (RocketChat.authz.hasPermission(user._id, 'post-readonly') === false) {\n\t\t\t\tif (!update.$set.muted) {\n\t\t\t\t\tupdate.$set.muted = [];\n\t\t\t\t}\n\t\t\t\treturn update.$set.muted.push(user.username);\n\t\t\t}\n\t\t});\n\t} else {\n\t\tupdate.$unset = {\n\t\t\tmuted: ''\n\t\t};\n\t}\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Rooms.setAllowReactingWhenReadOnlyById = function(_id, allowReacting) {\n\tconst query = {\n\t\t_id\n\t};\n\tconst update = {\n\t\t$set: {\n\t\t\treactWhenReadOnly: allowReacting\n\t\t}\n\t};\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Rooms.setSystemMessagesById = function(_id, systemMessages) {\n\tconst query = {\n\t\t_id\n\t};\n\tconst update = {\n\t\t$set: {\n\t\t\tsysMes: systemMessages\n\t\t}\n\t};\n\treturn this.update(query, update);\n};\n","Meteor.startup(function() {\n\tRocketChat.models.Permissions.upsert('post-readonly', {$setOnInsert: { roles: ['admin', 'owner', 'moderator'] } });\n\tRocketChat.models.Permissions.upsert('set-readonly', {$setOnInsert: { roles: ['admin', 'owner'] } });\n\tRocketChat.models.Permissions.upsert('set-react-when-readonly', {$setOnInsert: { roles: ['admin', 'owner'] }});\n});\n"]}