{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:graphql/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/api.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/schema.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/subscriptions.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/helpers/authenticated.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/helpers/dateToFloat.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/mocks/accounts/graphql-api.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/accounts/OauthProvider-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/accounts/index.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/accounts/oauthProviders.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/Channel-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/ChannelFilter-input.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/ChannelNameAndDirect-input.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/ChannelSort-enum.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/Privacy-enum.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/channelByName.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/channels.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/channelsByUser.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/createChannel.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/directChannel.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/hideChannel.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/index.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/leaveChannel.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/settings.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/Message-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/MessageIdentifier-input.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/MessagesWithCursor-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/Reaction-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/addReactionToMessage.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/chatMessageAdded.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/deleteMessage.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/editMessage.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/index.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/messages.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/sendMessage.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/users/User-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/users/UserStatus-enum.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/users/index.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/users/setStatus.js"],"names":["RocketChat","settings","addGroup","section","add","type","public","enableQuery","_id","value","graphqlExpress","graphiqlExpress","module","watch","require","v","jsAccountsContext","JSAccountsContext","SubscriptionServer","execute","subscribe","Meteor","WebApp","bodyParser","default","express","cors","executableSchema","subscriptionPort","get","graphQLServer","use","req","res","next","status","send","json","request","schema","context","formatError","e","message","locations","path","debug","isDevelopment","endpointURL","subscriptionsEndpoint","startSubscriptionServer","create","onConnect","connectionParams","authToken","Authorization","port","host","process","env","BIND_IP","console","log","onListening","connectHandlers","export","makeExecutableSchema","mergeTypes","mergeResolvers","channels","messages","accounts","users","resolvers","typeDefs","logger","pubsub","PubSub","authenticated","AccountsServer","_authenticated","resolver","dateToFloat","date","Date","getTime","Accounts","func","root","args","info","Error","userObject","resumeSession","Object","assign","user","createJSAccountsGraphQL","oauthProviders","OauthProviderType","accountsGraphQL","extendWithResolvers","HTTP","isJSON","obj","JSON","parse","Query","result","absoluteUrl","content","providers","data","map","name","property","Channel","id","t","usernames","find","u","username","members","models","Users","findOneByUsername","owners","numberOfMembers","length","numberOfMessages","readOnly","ro","direct","privateChannel","favourite","room","Subscriptions","findOneByRoomIdAndUserId","f","unseenMessages","unread","roomPublicFields","channelByName","query","Rooms","findOne","fields","options","sort","filter","nameFilter","undefined","$regex","RegExp","sortBy","msgs","privacy","$ne","fetch","channelsByUser","userId","findOneById","rooms","findByContainingUsername","Mutation","createChannel","API","validate","key","membersId","channel","directChannel","channelId","$all","hideChannel","sub","open","runAsUser","call","leaveChannel","ChannelType","ChannelSort","ChannelFilter","Privacy","ChannelNameAndDirect","description","announcement","topic","archived","Message","creationTime","ts","author","rid","fromServer","channelRef","$in","c","userRef","mentions","reactions","keys","forEach","icon","push","addReactionToMessage","Promise","resolve","messageId","Messages","CHAT_MESSAGE_SUBSCRIPTION_TOPIC","publishMessage","withFilter","publish","chatMessageAdded","shouldPublish","directTo","Subscription","asyncIterator","payload","callbacks","deleteMessage","msg","editMessage","sendMessage","MessageType","MessagesWithCursorType","MessageIdentifier","ReactionType","messagesQuery","messagesOptions","channelQuery","isPagination","cursor","count","channelName","error","messagesArray","cursorMsg","$lt","searchRegex","limit","excludeServer","$exists","firstMessage","lastId","text","messageReturn","processWebhookMessage","User","toUpperCase","avatar","Avatars","model","rawCollection","url","bindEnvironment","findBySubscriptionUserId","directMessages","findByTypeContainingUsername","setStatus","UserType","UserStatus","update","$set","toLowerCase"],"mappings":"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","file":"/packages/rocketchat_graphql.js","sourcesContent":["RocketChat.settings.addGroup('General', function() {\n\tthis.section('GraphQL API', function() {\n\t\tthis.add('Graphql_Enabled', false, { type: 'boolean', public: false });\n\t\tthis.add('Graphql_CORS', true, { type: 'boolean', public: false, enableQuery: { _id: 'Graphql_Enabled', value: true } });\n\t\tthis.add('Graphql_Subscription_Port', 3100, { type: 'int', public: false, enableQuery: { _id: 'Graphql_Enabled', value: true } });\n\t});\n});\n","import { graphqlExpress, graphiqlExpress } from 'apollo-server-express';\nimport { JSAccountsContext as jsAccountsContext } from '@accounts/graphql-api';\nimport { SubscriptionServer } from 'subscriptions-transport-ws';\nimport { execute, subscribe } from 'graphql';\nimport { Meteor } from 'meteor/meteor';\nimport { WebApp } from 'meteor/webapp';\nimport bodyParser from 'body-parser';\nimport express from 'express';\nimport cors from 'cors';\n\nimport { executableSchema } from './schema';\n\nconst subscriptionPort = RocketChat.settings.get('Graphql_Subscription_Port') || 3100;\n\n// the Meteor GraphQL server is an Express server\nconst graphQLServer = express();\n\nif (RocketChat.settings.get('Graphql_CORS')) {\n\tgraphQLServer.use(cors());\n}\n\ngraphQLServer.use('/api/graphql', (req, res, next) => {\n\tif (RocketChat.settings.get('Graphql_Enabled')) {\n\t\tnext();\n\t} else {\n\t\tres.status(400).send('Graphql is not enabled in this server');\n\t}\n});\n\ngraphQLServer.use(\n\t'/api/graphql',\n\tbodyParser.json(),\n\tgraphqlExpress(request => {\n\t\treturn {\n\t\t\tschema: executableSchema,\n\t\t\tcontext: jsAccountsContext(request),\n\t\t\tformatError: e => ({\n\t\t\t\tmessage: e.message,\n\t\t\t\tlocations: e.locations,\n\t\t\t\tpath: e.path\n\t\t\t}),\n\t\t\tdebug: Meteor.isDevelopment\n\t\t};\n\t})\n);\n\ngraphQLServer.use(\n\t'/graphiql',\n\tgraphiqlExpress({\n\t\tendpointURL: '/api/graphql',\n\t\tsubscriptionsEndpoint: `ws://localhost:${ subscriptionPort }`\n\t})\n);\n\nconst startSubscriptionServer = () => {\n\tif (RocketChat.settings.get('Graphql_Enabled')) {\n\t\tSubscriptionServer.create({\n\t\t\tschema: executableSchema,\n\t\t\texecute,\n\t\t\tsubscribe,\n\t\t\tonConnect: (connectionParams) => ({ authToken: connectionParams.Authorization })\n\t\t},\n\t\t{\n\t\t\tport: subscriptionPort,\n\t\t\thost: process.env.BIND_IP || '0.0.0.0'\n\t\t});\n\n\t\tconsole.log('GraphQL Subscription server runs on port:', subscriptionPort);\n\t}\n};\n\nWebApp.onListening(() => {\n\tstartSubscriptionServer();\n});\n\n// this binds the specified paths to the Express server running Apollo + GraphiQL\nWebApp.connectHandlers.use(graphQLServer);\n","import { makeExecutableSchema } from 'graphql-tools';\nimport { mergeTypes, mergeResolvers } from 'merge-graphql-schemas';\n\nimport * as channels from './resolvers/channels';\nimport * as messages from './resolvers/messages';\nimport * as accounts from './resolvers/accounts';\nimport * as users from './resolvers/users';\n\nconst schema = mergeTypes([\n\tchannels.schema,\n\tmessages.schema,\n\taccounts.schema,\n\tusers.schema\n]);\n\nconst resolvers = mergeResolvers([\n\tchannels.resolvers,\n\tmessages.resolvers,\n\taccounts.resolvers,\n\tusers.resolvers\n]);\n\nexport const executableSchema = makeExecutableSchema({\n\ttypeDefs: [schema],\n\tresolvers,\n\tlogger: {\n\t\tlog: (e) => console.log(e)\n\t}\n});\n","import { PubSub } from 'graphql-subscriptions';\n\nexport const pubsub = new PubSub();\n","import { AccountsServer } from 'meteor/rocketchat:accounts';\n//import { authenticated as _authenticated } from '@accounts/graphql-api';\nimport { authenticated as _authenticated } from '../mocks/accounts/graphql-api';\n\nexport const authenticated = (resolver) => {\n\treturn _authenticated(AccountsServer, resolver);\n};\n","export function dateToFloat(date) {\n\tif (date) {\n\t\treturn new Date(date).getTime();\n\t}\n}\n","// Same as here: https://github.com/js-accounts/graphql/blob/master/packages/graphql-api/src/utils/authenticated-resolver.js\n// except code below works\n// It might be like that because of async/await,\n// maybe Promise is not wrapped with Fiber\n// See: https://github.com/meteor/meteor/blob/a362e20a37547362b581fed52f7171d022e83b62/packages/promise/server.js\n// Opened issue: https://github.com/js-accounts/graphql/issues/16\nexport const authenticated = (Accounts, func) => (async(root, args, context, info) => {\n\tconst authToken = context.authToken;\n\n\tif (!authToken || authToken === '' || authToken === null) {\n\t\tthrow new Error('Unable to find authorization token in request');\n\t}\n\n\tconst userObject = await Accounts.resumeSession(authToken);\n\n\tif (userObject === null) {\n\t\tthrow new Error('Invalid or expired token!');\n\t}\n\n\treturn await func(root, args, Object.assign(context, { user: userObject }), info);\n});\n","import schema from '../../schemas/accounts/OauthProvider-type.graphqls';\n\nexport {\n\tschema\n};\n","import { createJSAccountsGraphQL } from '@accounts/graphql-api';\nimport { AccountsServer } from 'meteor/rocketchat:accounts';\nimport { mergeTypes, mergeResolvers } from 'merge-graphql-schemas';\n\n// queries\nimport * as oauthProviders from './oauthProviders';\n// types\nimport * as OauthProviderType from './OauthProvider-type';\n\nconst accountsGraphQL = createJSAccountsGraphQL(AccountsServer);\n\nexport const schema = mergeTypes([\n\taccountsGraphQL.schema,\n\toauthProviders.schema,\n\tOauthProviderType.schema\n]);\n\nexport const resolvers = mergeResolvers([\n\taccountsGraphQL.extendWithResolvers({}),\n\toauthProviders.resolver\n]);\n","import { HTTP } from 'meteor/http';\nimport { Meteor } from 'meteor/meteor';\n\nimport schema from '../../schemas/accounts/oauthProviders.graphqls';\n\nfunction isJSON(obj) {\n\ttry {\n\t\tJSON.parse(obj);\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\nconst resolver = {\n\tQuery: {\n\t\toauthProviders: async() => {\n\t\t\t// depends on rocketchat:grant package\n\t\t\ttry {\n\t\t\t\tconst result = HTTP.get(Meteor.absoluteUrl('_oauth_apps/providers')).content;\n\n\t\t\t\tif (isJSON(result)) {\n\t\t\t\t\tconst providers = JSON.parse(result).data;\n\n\t\t\t\t\treturn providers.map((name) => ({ name }));\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('Could not parse the result');\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthrow new Error('rocketchat:grant not installed');\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\nimport property from 'lodash.property';\n\nimport schema from '../../schemas/channels/Channel-type.graphqls';\n\nconst resolver = {\n\tChannel: {\n\t\tid: property('_id'),\n\t\tname: (root, args, { user }) => {\n\t\t\tif (root.t === 'd') {\n\t\t\t\treturn root.usernames.find(u => u !== user.username);\n\t\t\t}\n\n\t\t\treturn root.name;\n\t\t},\n\t\tmembers: (root) => {\n\t\t\treturn root.usernames.map(\n\t\t\t\tusername => RocketChat.models.Users.findOneByUsername(username)\n\t\t\t);\n\t\t},\n\t\towners: (root) => {\n\t\t\t// there might be no owner\n\t\t\tif (!root.u) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn [RocketChat.models.Users.findOneByUsername(root.u.username)];\n\t\t},\n\t\tnumberOfMembers: (root) => (root.usernames || []).length,\n\t\tnumberOfMessages: property('msgs'),\n\t\treadOnly: (root) => root.ro === true,\n\t\tdirect: (root) => root.t === 'd',\n\t\tprivateChannel: (root) => root.t === 'p',\n\t\tfavourite: (root, args, { user }) => {\n\t\t\tconst room = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(root._id, user._id);\n\n\t\t\treturn room && room.f === true;\n\t\t},\n\t\tunseenMessages: (root, args, { user }) => {\n\t\t\tconst room = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(root._id, user._id);\n\n\t\t\treturn (room || {}).unread;\n\t\t}\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import schema from '../../schemas/channels/ChannelFilter-input.graphqls';\n\nexport {\n\tschema\n};\n","import schema from '../../schemas/channels/ChannelNameAndDirect-input.graphqls';\n\nexport {\n\tschema\n};\n","import schema from '../../schemas/channels/ChannelSort-enum.graphqls';\n\nexport {\n\tschema\n};\n","import schema from '../../schemas/channels/Privacy-enum.graphqls';\n\nexport {\n\tschema\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport { roomPublicFields } from './settings';\nimport schema from '../../schemas/channels/channelByName.graphqls';\n\nconst resolver = {\n\tQuery: {\n\t\tchannelByName: authenticated((root, { name }) => {\n\t\t\tconst query = {\n\t\t\t\tname,\n\t\t\t\tt: 'c'\n\t\t\t};\n\n\t\t\treturn RocketChat.models.Rooms.findOne(query, {\n\t\t\t\tfields: roomPublicFields\n\t\t\t});\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport { roomPublicFields } from './settings';\nimport schema from '../../schemas/channels/channels.graphqls';\n\nconst resolver = {\n\tQuery: {\n\t\tchannels: authenticated((root, args) => {\n\t\t\tconst query = {};\n\t\t\tconst options = {\n\t\t\t\tsort: {\n\t\t\t\t\tname: 1\n\t\t\t\t},\n\t\t\t\tfields: roomPublicFields\n\t\t\t};\n\n\t\t\t// Filter\n\t\t\tif (typeof args.filter !== 'undefined') {\n\t\t\t\t// nameFilter\n\t\t\t\tif (typeof args.filter.nameFilter !== undefined) {\n\t\t\t\t\tquery.name = {\n\t\t\t\t\t\t$regex: new RegExp(args.filter.nameFilter, 'i')\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// sortBy\n\t\t\t\tif (args.filter.sortBy === 'NUMBER_OF_MESSAGES') {\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// privacy\n\t\t\t\tswitch (args.filter.privacy) {\n\t\t\t\t\tcase 'PRIVATE':\n\t\t\t\t\t\tquery.t = 'p';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'PUBLIC':\n\t\t\t\t\t\tquery.t = {\n\t\t\t\t\t\t\t$ne: 'p'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Rooms.find(query, options).fetch();\n\t\t})\n\t}\n};\n\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport { roomPublicFields } from './settings';\nimport schema from '../../schemas/channels/channelsByUser.graphqls';\n\nconst resolver = {\n\tQuery: {\n\t\tchannelsByUser: authenticated((root, { userId }) => {\n\t\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\t\tif (!user) {\n\t\t\t\tthrow new Error('No user');\n\t\t\t}\n\n\t\t\tconst rooms = RocketChat.models.Rooms.findByContainingUsername(user.username, {\n\t\t\t\tsort: {\n\t\t\t\t\tname: 1\n\t\t\t\t},\n\t\t\t\tfields: roomPublicFields\n\t\t\t}).fetch();\n\n\t\t\treturn rooms;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/channels/createChannel.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\tcreateChannel: authenticated((root, args, { user }) => {\n\t\t\ttry {\n\t\t\t\tRocketChat.API.channels.create.validate({\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tvalue: user._id\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\tvalue: args.name,\n\t\t\t\t\t\tkey: 'name'\n\t\t\t\t\t},\n\t\t\t\t\tmembers: {\n\t\t\t\t\t\tvalue: args.membersId,\n\t\t\t\t\t\tkey: 'membersId'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\tconst { channel } = RocketChat.API.channels.create.execute(user._id, {\n\t\t\t\tname: args.name,\n\t\t\t\tmembers: args.membersId\n\t\t\t});\n\n\t\t\treturn channel;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport { roomPublicFields } from './settings';\nimport schema from '../../schemas/channels/directChannel.graphqls';\n\nconst resolver = {\n\tQuery: {\n\t\tdirectChannel: authenticated((root, { username, channelId }, { user }) => {\n\t\t\tconst query = {\n\t\t\t\tt: 'd',\n\t\t\t\tusernames: user.username\n\t\t\t};\n\n\t\t\tif (typeof username !== 'undefined') {\n\t\t\t\tif (username === user.username) {\n\t\t\t\t\tthrow new Error('You cannot specify your username');\n\t\t\t\t}\n\n\t\t\t\tquery.usernames = { $all: [ user.username, username ] };\n\t\t\t} else if (typeof channelId !== 'undefined') {\n\t\t\t\tquery.id = channelId;\n\t\t\t} else {\n\t\t\t\tthrow new Error('Use one of those fields: username, channelId');\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Rooms.findOne(query, {\n\t\t\t\tfields: roomPublicFields\n\t\t\t});\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/channels/hideChannel.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\thideChannel: authenticated((root, args, { user }) => {\n\t\t\tconst channel = RocketChat.models.Rooms.findOne({\n\t\t\t\t_id: args.channelId,\n\t\t\t\tt: 'c'\n\t\t\t});\n\n\t\t\tif (!channel) {\n\t\t\t\tthrow new Error('error-room-not-found', 'The required \"channelId\" param provided does not match any channel');\n\t\t\t}\n\n\t\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(channel._id, user._id);\n\n\t\t\tif (!sub) {\n\t\t\t\tthrow new Error(`The user/callee is not in the channel \"${ channel.name }.`);\n\t\t\t}\n\n\t\t\tif (!sub.open) {\n\t\t\t\tthrow new Error(`The channel, ${ channel.name }, is already closed to the sender`);\n\t\t\t}\n\n\t\t\tMeteor.runAsUser(user._id, () => {\n\t\t\t\tMeteor.call('hideRoom', channel._id);\n\t\t\t});\n\n\t\t\treturn true;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { mergeTypes, mergeResolvers } from 'merge-graphql-schemas';\n\n// queries\nimport * as channels from './channels';\nimport * as channelByName from './channelByName';\nimport * as directChannel from './directChannel';\nimport * as channelsByUser from './channelsByUser';\n// mutations\nimport * as createChannel from './createChannel';\nimport * as leaveChannel from './leaveChannel';\nimport * as hideChannel from './hideChannel';\n// types\nimport * as ChannelType from './Channel-type';\nimport * as ChannelSort from './ChannelSort-enum';\nimport * as ChannelFilter from './ChannelFilter-input';\nimport * as Privacy from './Privacy-enum';\nimport * as ChannelNameAndDirect from './ChannelNameAndDirect-input';\n\nexport const schema = mergeTypes([\n\t// queries\n\tchannels.schema,\n\tchannelByName.schema,\n\tdirectChannel.schema,\n\tchannelsByUser.schema,\n\t// mutations\n\tcreateChannel.schema,\n\tleaveChannel.schema,\n\thideChannel.schema,\n\t// types\n\tChannelType.schema,\n\tChannelSort.schema,\n\tChannelFilter.schema,\n\tPrivacy.schema,\n\tChannelNameAndDirect.schema\n]);\n\nexport const resolvers = mergeResolvers([\n\t// queries\n\tchannels.resolver,\n\tchannelByName.resolver,\n\tdirectChannel.resolver,\n\tchannelsByUser.resolver,\n\t// mutations\n\tcreateChannel.resolver,\n\tleaveChannel.resolver,\n\thideChannel.resolver,\n\t// types\n\tChannelType.resolver\n]);\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/channels/leaveChannel.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\tleaveChannel: authenticated((root, args, { user }) => {\n\t\t\tconst channel = RocketChat.models.Rooms.findOne({\n\t\t\t\t_id: args.channelId,\n\t\t\t\tt: 'c'\n\t\t\t});\n\n\t\t\tif (!channel) {\n\t\t\t\tthrow new Error('error-room-not-found', 'The required \"channelId\" param provided does not match any channel');\n\t\t\t}\n\n\t\t\tMeteor.runAsUser(user._id, () => {\n\t\t\t\tMeteor.call('leaveRoom', channel._id);\n\t\t\t});\n\n\t\t\treturn true;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","export const roomPublicFields = {\n\tt: 1,\n\tname: 1,\n\tdescription: 1,\n\tannouncement: 1,\n\ttopic: 1,\n\tusernames: 1,\n\tmsgs: 1,\n\tro: 1,\n\tu: 1,\n\tarchived: 1\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\nimport property from 'lodash.property';\n\nimport { dateToFloat } from '../../helpers/dateToFloat';\nimport schema from '../../schemas/messages/Message-type.graphqls';\n\nconst resolver = {\n\tMessage: {\n\t\tid: property('_id'),\n\t\tcontent: property('msg'),\n\t\tcreationTime: (root) => dateToFloat(root.ts),\n\t\tauthor: (root) => {\n\t\t\tconst user = RocketChat.models.Users.findOne(root.u._id);\n\n\t\t\treturn user || root.u;\n\t\t},\n\t\tchannel: (root) => {\n\t\t\treturn RocketChat.models.Rooms.findOne(root.rid);\n\t\t},\n\t\tfromServer: (root) => typeof root.t !== 'undefined', // on a message sent by user `true` otherwise `false`\n\t\ttype: property('t'),\n\t\tchannelRef: (root) => {\n\t\t\tif (!root.channels) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: root.channels.map(c => c._id)\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tsort: {\n\t\t\t\t\tname: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t},\n\t\tuserRef: (root) => {\n\t\t\tif (!root.mentions) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: root.mentions.map(c => c._id)\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tsort: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t},\n\t\treactions: (root) => {\n\t\t\tif (!root.reactions || Object.keys(root.reactions).length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst reactions = [];\n\n\t\t\tObject.keys(root.reactions).forEach(icon => {\n\t\t\t\troot.reactions[icon].usernames.forEach(username => {\n\t\t\t\t\treactions.push({\n\t\t\t\t\t\ticon,\n\t\t\t\t\t\tusername\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn reactions;\n\t\t}\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import schema from '../../schemas/messages/MessageIdentifier-input.graphqls';\n\nexport {\n\tschema\n};\n","import schema from '../../schemas/messages/MessagesWithCursor-type.graphqls';\n\nexport {\n\tschema\n};\n","import schema from '../../schemas/messages/Reaction-type.graphqls';\n\nexport {\n\tschema\n};\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/addReactionToMessage.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\taddReactionToMessage: authenticated((root, { id, icon }, { user }) => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tMeteor.runAsUser(user._id, () => {\n\t\t\t\t\tMeteor.call('setReaction', id.messageId, icon, () => {\n\t\t\t\t\t\tresolve(RocketChat.models.Messages.findOne(id.messageId));\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { withFilter } from 'graphql-subscriptions';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { pubsub } from '../../subscriptions';\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/chatMessageAdded.graphqls';\n\nexport const CHAT_MESSAGE_SUBSCRIPTION_TOPIC = 'CHAT_MESSAGE_ADDED';\n\nexport function publishMessage(message) {\n\tpubsub.publish(CHAT_MESSAGE_SUBSCRIPTION_TOPIC, { chatMessageAdded: message });\n}\n\nfunction shouldPublish(message, { id, directTo }, username) {\n\tif (id) {\n\t\treturn message.rid === id;\n\t} else if (directTo) {\n\t\tconst room = RocketChat.models.Rooms.findOne({\n\t\t\tusernames: { $all: [directTo, username] },\n\t\t\tt: 'd'\n\t\t});\n\n\t\treturn room && room._id === message.rid;\n\t}\n\n\treturn false;\n}\n\nconst resolver = {\n\tSubscription: {\n\t\tchatMessageAdded: {\n\t\t\tsubscribe: withFilter(() => pubsub.asyncIterator(CHAT_MESSAGE_SUBSCRIPTION_TOPIC), authenticated((payload, args, { user }) => {\n\t\t\t\tconst channel = {\n\t\t\t\t\tid: args.channelId,\n\t\t\t\t\tdirectTo: args.directTo\n\t\t\t\t};\n\n\t\t\t\treturn shouldPublish(payload.chatMessageAdded, channel, user.username);\n\t\t\t}))\n\t\t}\n\t}\n};\n\nRocketChat.callbacks.add('afterSaveMessage', (message) => {\n\tpublishMessage(message);\n}, null, 'chatMessageAddedSubscription');\n\nexport {\n\tschema,\n\tresolver\n};\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/deleteMessage.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\tdeleteMessage: authenticated((root, { id }, { user }) => {\n\t\t\tconst msg = RocketChat.models.Messages.findOneById(id.messageId, { fields: { u: 1, rid: 1 }});\n\n\t\t\tif (!msg) {\n\t\t\t\tthrow new Error(`No message found with the id of \"${ id.messageId }\".`);\n\t\t\t}\n\n\t\t\tif (id.channelId !== msg.rid) {\n\t\t\t\tthrow new Error('The room id provided does not match where the message is from.');\n\t\t\t}\n\n\t\t\tMeteor.runAsUser(user._id, () => {\n\t\t\t\tMeteor.call('deleteMessage', { _id: msg._id });\n\t\t\t});\n\n\t\t\treturn msg;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/editMessage.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\teditMessage: authenticated((root, { id, content }, { user }) => {\n\t\t\tconst msg = RocketChat.models.Messages.findOneById(id.messageId);\n\n\t\t\t//Ensure the message exists\n\t\t\tif (!msg) {\n\t\t\t\tthrow new Error(`No message found with the id of \"${ id.messageId }\".`);\n\t\t\t}\n\n\t\t\tif (id.channelId !== msg.rid) {\n\t\t\t\tthrow new Error('The channel id provided does not match where the message is from.');\n\t\t\t}\n\n\t\t\t//Permission checks are already done in the updateMessage method, so no need to duplicate them\n\t\t\tMeteor.runAsUser(user._id, () => {\n\t\t\t\tMeteor.call('updateMessage', { _id: msg._id, msg: content, rid: msg.rid });\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Messages.findOneById(msg._id);\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { mergeTypes, mergeResolvers } from 'merge-graphql-schemas';\n\n// queries\nimport * as messages from './messages';\n// mutations\nimport * as sendMessage from './sendMessage';\nimport * as editMessage from './editMessage';\nimport * as deleteMessage from './deleteMessage';\nimport * as addReactionToMessage from './addReactionToMessage';\n// subscriptions\nimport * as chatMessageAdded from './chatMessageAdded';\n// types\nimport * as MessageType from './Message-type';\nimport * as MessagesWithCursorType from './MessagesWithCursor-type';\nimport * as MessageIdentifier from './MessageIdentifier-input';\nimport * as ReactionType from './Reaction-type';\n\nexport const schema = mergeTypes([\n\t// queries\n\tmessages.schema,\n\t// mutations\n\tsendMessage.schema,\n\teditMessage.schema,\n\tdeleteMessage.schema,\n\taddReactionToMessage.schema,\n\t// subscriptions\n\tchatMessageAdded.schema,\n\t// types\n\tMessageType.schema,\n\tMessagesWithCursorType.schema,\n\tMessageIdentifier.schema,\n\tReactionType.schema\n]);\n\nexport const resolvers = mergeResolvers([\n\t// queries\n\tmessages.resolver,\n\t// mutations\n\tsendMessage.resolver,\n\teditMessage.resolver,\n\tdeleteMessage.resolver,\n\taddReactionToMessage.resolver,\n\t// subscriptions\n\tchatMessageAdded.resolver,\n\t// types\n\tMessageType.resolver\n]);\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/messages.graphqls';\n\nconst resolver = {\n\tQuery: {\n\t\tmessages: authenticated((root, args, { user }) => {\n\t\t\tconst messagesQuery = {};\n\t\t\tconst messagesOptions = {\n\t\t\t\tsort: { ts: -1 }\n\t\t\t};\n\t\t\tconst channelQuery = {};\n\t\t\tconst isPagination = !!args.cursor || args.count > 0;\n\t\t\tlet cursor;\n\n\t\t\tif (args.channelId) {\n\t\t\t\t// channelId\n\t\t\t\tchannelQuery._id = args.channelId;\n\t\t\t} else if (args.directTo) {\n\t\t\t\t// direct message where directTo is a user id\n\t\t\t\tchannelQuery.t = 'd';\n\t\t\t\tchannelQuery.usernames = { $all: [args.directTo, user.username] };\n\t\t\t} else if (args.channelName) {\n\t\t\t\t// non-direct channel\n\t\t\t\tchannelQuery.t = { $ne: 'd' };\n\t\t\t\tchannelQuery.name = args.channelName;\n\t\t\t} else {\n\t\t\t\tconsole.error('messages query must be called with channelId or directTo');\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst channel = RocketChat.models.Rooms.findOne(channelQuery);\n\n\t\t\tlet messagesArray = [];\n\n\t\t\tif (channel) {\n\t\t\t\t// cursor\n\t\t\t\tif (isPagination && args.cursor) {\n\t\t\t\t\tconst cursorMsg = RocketChat.models.Messages.findOne(args.cursor, { fields: { ts: 1 } });\n\t\t\t\t\tmessagesQuery.ts = { $lt: cursorMsg.ts };\n\t\t\t\t}\n\n\t\t\t\t// search\n\t\t\t\tif (typeof args.searchRegex === 'string') {\n\t\t\t\t\tmessagesQuery.msg = {\n\t\t\t\t\t\t$regex: new RegExp(args.searchRegex, 'i')\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// count\n\t\t\t\tif (isPagination && args.count) {\n\t\t\t\t\tmessagesOptions.limit = args.count;\n\t\t\t\t}\n\n\t\t\t\t// exclude messages generated by server\n\t\t\t\tif (args.excludeServer === true) {\n\t\t\t\t\tmessagesQuery.t = { $exists: false };\n\t\t\t\t}\n\n\t\t\t\t// look for messages that belongs to specific channel\n\t\t\t\tmessagesQuery.rid = channel._id;\n\n\t\t\t\tconst messages = RocketChat.models.Messages.find(messagesQuery, messagesOptions);\n\n\t\t\t\tmessagesArray = messages.fetch();\n\n\t\t\t\tif (isPagination) {\n\t\t\t\t\t// oldest first (because of findOne)\n\t\t\t\t\tmessagesOptions.sort.ts = 1;\n\n\t\t\t\t\tconst firstMessage = RocketChat.models.Messages.findOne(messagesQuery, messagesOptions);\n\t\t\t\t\tconst lastId = (messagesArray[messagesArray.length - 1] || {})._id;\n\n\t\t\t\t\tcursor = !lastId || lastId === firstMessage._id ? null : lastId;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tcursor,\n\t\t\t\tchannel,\n\t\t\t\tmessagesArray\n\t\t\t};\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","/* global processWebhookMessage */\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/sendMessage.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\tsendMessage: authenticated((root, { channelId, directTo, content }, { user }) => {\n\t\t\tconst options = {\n\t\t\t\ttext: content,\n\t\t\t\tchannel: channelId || directTo\n\t\t\t};\n\n\t\t\tconst messageReturn = processWebhookMessage(options, user)[0];\n\n\t\t\tif (!messageReturn) {\n\t\t\t\tthrow new Error('Unknown error');\n\t\t\t}\n\n\t\t\treturn messageReturn.message;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\nimport property from 'lodash.property';\n\nimport schema from '../../schemas/users/User-type.graphqls';\n\nconst resolver = {\n\tUser: {\n\t\tid: property('_id'),\n\t\tstatus: ({status}) => status.toUpperCase(),\n\t\tavatar: async({ _id }) => {\n\t\t\t// XXX js-accounts/graphql#16\n\t\t\tconst avatar = await RocketChat.models.Avatars.model.rawCollection().findOne({\n\t\t\t\tuserId: _id\n\t\t\t}, { fields: { url: 1 }});\n\n\t\t\tif (avatar) {\n\t\t\t\treturn avatar.url;\n\t\t\t}\n\t\t},\n\t\tchannels: Meteor.bindEnvironment(async({ _id }) => {\n\t\t\treturn await RocketChat.models.Rooms.findBySubscriptionUserId(_id).fetch();\n\t\t}),\n\t\tdirectMessages: ({ username }) => {\n\t\t\treturn RocketChat.models.Rooms.findByTypeContainingUsername('d', username).fetch();\n\t\t}\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import schema from '../../schemas/users/UserStatus-enum.graphqls';\n\nexport {\n\tschema\n};\n","import { mergeTypes, mergeResolvers } from 'merge-graphql-schemas';\n\n// mutations\nimport * as setStatus from './setStatus';\n// types\nimport * as UserType from './User-type';\nimport * as UserStatus from './UserStatus-enum';\n\nexport const schema = mergeTypes([\n\t// mutations\n\tsetStatus.schema,\n\t// types\n\tUserType.schema,\n\tUserStatus.schema\n]);\n\nexport const resolvers = mergeResolvers([\n\t// mutations\n\tsetStatus.resolver,\n\t// types\n\tUserType.resolver\n]);\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/users/setStatus.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\tsetStatus: authenticated((root, { status }, { user }) => {\n\t\t\tRocketChat.models.Users.update(user._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tstatus: status.toLowerCase()\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Users.findOne(user._id);\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n"]}