{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:slashcommands-invite/server/server.js"],"names":["Invite","command","params","item","Match","test","String","usernames","replace","split","filter","a","length","users","Meteor","find","username","$in","currentUser","findOne","userId","count","RocketChat","Notifications","notifyUser","_id","Random","id","rid","ts","Date","msg","TAPi18n","__","postProcess","sprintf","join","language","models","Rooms","findOneByIdContainingUsername","forEach","user","call","error","slashCommands","add","description"],"mappings":"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","file":"/packages/rocketchat_slashcommands-invite.js","sourcesContent":["\n/*\n* Invite is a named function that will replace /invite commands\n* @param {Object} message - The message object\n*/\n\n\nfunction Invite(command, params, item) {\n\n\tif (command !== 'invite' || !Match.test(params, String)) {\n\t\treturn;\n\t}\n\tlet usernames = params.replace(/@/g, '').split(/[\\s,]/).filter((a) => a !== '');\n\tif (usernames.length === 0) {\n\t\treturn;\n\t}\n\tconst users = Meteor.users.find({\n\t\tusername: {\n\t\t\t$in: usernames\n\t\t}\n\t});\n\tconst currentUser = Meteor.users.findOne(Meteor.userId());\n\tif (users.count() === 0) {\n\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date,\n\t\t\tmsg: TAPi18n.__('User_doesnt_exist', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [usernames.join(' @')]\n\t\t\t}, currentUser.language)\n\t\t});\n\t\treturn;\n\t}\n\tusernames = usernames.filter(function(username) {\n\t\tif (RocketChat.models.Rooms.findOneByIdContainingUsername(item.rid, username) == null) {\n\t\t\treturn true;\n\t\t}\n\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date,\n\t\t\tmsg: TAPi18n.__('Username_is_already_in_here', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [username]\n\t\t\t}, currentUser.language)\n\t\t});\n\t\treturn false;\n\t});\n\tif (usernames.length === 0) {\n\t\treturn;\n\t}\n\tusers.forEach(function(user) {\n\n\t\ttry {\n\t\t\treturn Meteor.call('addUserToRoom', {\n\t\t\t\trid: item.rid,\n\t\t\t\tusername: user.username\n\t\t\t});\n\t\t} catch ({error}) {\n\t\t\tif (error === 'cant-invite-for-direct-room') {\n\t\t\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\trid: item.rid,\n\t\t\t\t\tts: new Date,\n\t\t\t\t\tmsg: TAPi18n.__('Cannot_invite_users_to_direct_rooms', null, currentUser.language)\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\trid: item.rid,\n\t\t\t\t\tts: new Date,\n\t\t\t\t\tmsg: TAPi18n.__(error, null, currentUser.language)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n}\n\nRocketChat.slashCommands.add('invite', Invite, {\n\tdescription: 'Invite_user_to_join_channel',\n\tparams: '@username'\n});\n"]}